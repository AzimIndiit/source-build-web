import{r as e,j as u,ah as H,a1 as T}from"./index-BiCr9dd_.js";import{M as q,i as A,u as F,P as B,a as D,b as K,L as O,m as k}from"./proxy-16hbtkMy.js";class U extends e.Component{getSnapshotBeforeUpdate(f){const t=this.props.childRef.current;if(t&&f.isPresent&&!this.props.isPresent){const r=t.offsetParent,C=A(r)&&r.offsetWidth||0,n=this.props.sizeRef.current;n.height=t.offsetHeight||0,n.width=t.offsetWidth||0,n.top=t.offsetTop,n.left=t.offsetLeft,n.right=C-n.width-n.left}return null}componentDidUpdate(){}render(){return this.props.children}}function G({children:s,isPresent:f,anchorX:t,root:r}){const C=e.useId(),n=e.useRef(null),h=e.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:y}=e.useContext(q);return e.useInsertionEffect(()=>{const{width:v,height:a,top:w,left:i,right:d}=h.current;if(f||!n.current||!v||!a)return;const c=t==="left"?`left: ${i}`:`right: ${d}`;n.current.dataset.motionPopId=C;const l=document.createElement("style");y&&(l.nonce=y);const p=r??document.head;return p.appendChild(l),l.sheet&&l.sheet.insertRule(`
          [data-motion-pop-id="${C}"] {
            position: absolute !important;
            width: ${v}px !important;
            height: ${a}px !important;
            ${c}px !important;
            top: ${w}px !important;
          }
        `),()=>{p.contains(l)&&p.removeChild(l)}},[f]),u.jsx(U,{isPresent:f,childRef:n,sizeRef:h,children:e.cloneElement(s,{ref:n})})}const X=({children:s,initial:f,isPresent:t,onExitComplete:r,custom:C,presenceAffectsLayout:n,mode:h,anchorX:y,root:v})=>{const a=F(_),w=e.useId();let i=!0,d=e.useMemo(()=>(i=!1,{id:w,initial:f,isPresent:t,custom:C,onExitComplete:c=>{a.set(c,!0);for(const l of a.values())if(!l)return;r&&r()},register:c=>(a.set(c,!1),()=>a.delete(c))}),[t,a,r]);return n&&i&&(d={...d}),e.useMemo(()=>{a.forEach((c,l)=>a.set(l,!1))},[t]),e.useEffect(()=>{!t&&!a.size&&r&&r()},[t]),h==="popLayout"&&(s=u.jsx(G,{isPresent:t,anchorX:y,root:v,children:s})),u.jsx(B.Provider,{value:d,children:s})};function _(){return new Map}const N=s=>s.key||"";function W(s){const f=[];return e.Children.forEach(s,t=>{e.isValidElement(t)&&f.push(t)}),f}const J=({children:s,custom:f,initial:t=!0,onExitComplete:r,presenceAffectsLayout:C=!0,mode:n="sync",propagate:h=!1,anchorX:y="left",root:v})=>{const[a,w]=D(h),i=e.useMemo(()=>W(s),[s]),d=h&&!a?[]:i.map(N),c=e.useRef(!0),l=e.useRef(i),p=F(()=>new Map),[R,$]=e.useState(i),[m,E]=e.useState(i);K(()=>{c.current=!1,l.current=i;for(let x=0;x<m.length;x++){const o=N(m[x]);d.includes(o)?p.delete(o):p.get(o)!==!0&&p.set(o,!1)}},[m,d.length,d.join("-")]);const b=[];if(i!==R){let x=[...i];for(let o=0;o<m.length;o++){const j=m[o],L=N(j);d.includes(L)||(x.splice(o,0,j),b.push(j))}return n==="wait"&&b.length&&(x=b),E(W(x)),$(i),null}const{forceRender:I}=e.useContext(O);return u.jsx(u.Fragment,{children:m.map(x=>{const o=N(x),j=h&&!a?!1:i===m||d.includes(o),L=()=>{if(p.has(o))p.set(o,!0);else return;let M=!0;p.forEach(z=>{z||(M=!1)}),M&&(I?.(),E(l.current),h&&w?.(),r&&r())};return u.jsx(X,{isPresent:j,initial:!c.current||t?void 0:!1,custom:f,presenceAffectsLayout:C,mode:n,root:v,onExitComplete:j?void 0:L,anchorX:y,children:x},o)})})},Q=({src:s,alt:f,fallbackSrc:t="https://placehold.co/400x300/e2e8f0/94a3b8?text=Image",placeholderSrc:r,className:C,wrapperClassName:n,onLoad:h,onError:y,showSkeleton:v=!0,aspectRatio:a="auto",objectFit:w="cover",rootMargin:i="50px",threshold:d=.01,fadeInDuration:c=.3,blurPlaceholder:l=!0,...p})=>{const[R,$]=e.useState(!1),[m,E]=e.useState(!1),[b,I]=e.useState(!1),[x,o]=e.useState(r||""),j=e.useRef(null),L=e.useRef(null);e.useEffect(()=>{const g=new IntersectionObserver(V=>{V.forEach(S=>{S.isIntersecting&&!R&&($(!0),g.disconnect())})},{rootMargin:i,threshold:d}),P=j.current;return P&&g.observe(P),()=>{P&&g.unobserve(P),g.disconnect()}},[R,i,d]),e.useEffect(()=>{if(!R||b)return;const g=new Image;return g.onload=()=>{o(s),E(!0),I(!1),h?.()},g.onerror=()=>{I(!0),o(t),E(!0),y?.()},g.src=s,()=>{g.onload=null,g.onerror=null}},[R,s,t,b,h,y]);const M=()=>{switch(a){case"square":return"aspect-square";case"16/9":return"aspect-video";case"4/3":return"aspect-4/3";default:return""}},z=()=>{switch(w){case"contain":return"object-contain";case"fill":return"object-fill";case"none":return"object-none";case"scale-down":return"object-scale-down";default:return"object-cover"}};return u.jsx("div",{ref:j,className:H("relative overflow-hidden",M(),n),children:u.jsxs(J,{mode:"wait",children:[!m&&v&&u.jsx(k.div,{initial:{opacity:1},exit:{opacity:0},transition:{duration:c},className:"absolute inset-0 bg-gray-200 animate-pulse"},"skeleton"),!m&&r&&l&&u.jsx(k.img,{src:r,alt:"",className:H("absolute inset-0 w-full h-full filter blur-sm",z()),initial:{opacity:1},exit:{opacity:0},transition:{duration:c}},"placeholder"),R&&u.jsx(k.img,{ref:L,src:x||t,alt:f,className:H("w-full h-full",z(),C,!m&&"invisible"),initial:{opacity:0},animate:{opacity:m?1:0},transition:{duration:c},loading:"lazy",...(()=>{const{onDrag:g,onDragStart:P,onDragEnd:V,...S}=p;return S})()},"main-image"),b&&u.jsxs(k.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:c},className:"absolute inset-0 flex flex-col items-center justify-center bg-gray-100",children:[u.jsx("svg",{className:"w-12 h-12 text-gray-400 mb-2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",viewBox:"0 0 24 24",stroke:"currentColor",children:u.jsx("path",{d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),u.jsx("span",{className:"text-sm text-gray-500",children:"Failed to load image"})]},"error")]})})};T.memo(Q);export{Q as L};
