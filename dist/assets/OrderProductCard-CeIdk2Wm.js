import{g as R,r as j,j as e,af as O,ag as P,aE as B,B as c,aK as v,u as A,Z as w}from"./index-CUSVstqU.js";import{S as N}from"./StarRating-sEf5bhyI.js";import{o as z}from"./useOrderMutations-CL6oNQvb.js";import{B as M}from"./badge-c_xwgsXg.js";import{f as C}from"./date-utils-CIparGJB.js";import{g as I}from"./orderUtils-DR-jD4b-.js";import{g as L}from"./colorUtils-BjIcJb6R.js";const V=({order:s,isOpen:y,onClose:f,orderId:o,onSubmit:d,onSuccess:x})=>{const{user:g}=R();console.log("order",s);const n={buyerRating:s?.customer?.rating||0,buyerComment:s?.customer?.review||"",driverRating:s?.driver?.rating||0,driverComment:s?.driver?.review||"",sellerRating:s?.seller?.rating||0,sellerComment:s?.seller?.review||""},[t,p]=j.useState(n),[h,u]=j.useState(!1),l=(r,m)=>{p(b=>({...b,[r]:m}))},a=async()=>{if(!o){if(d){const{buyerRating:r,buyerComment:m,driverRating:b,driverComment:k,sellerRating:S,sellerComment:D}=t;d(r,m,b,k,S,D)}i();return}u(!0);try{const r={};if(t.buyerRating>0){if(t.buyerComment==="")return v.error("Please enter a comment ");r.customer={rating:t.buyerRating,review:t.buyerComment||""}}if(t.driverRating>0){if(t.driverComment==="")return v.error("Please enter a comment ");r.driver={rating:t.driverRating,review:t.driverComment||""}}if(t.sellerRating>0){if(t.sellerComment==="")return v.error("Please enter a comment ");r.seller={rating:t.sellerRating,review:t.sellerComment||""}}await z.addOrderReview(o,r),x?.(),i()}catch(r){console.error("Failed to submit review:",r);const m=r?.response?.data?.message||"Failed to submit review. Please try again.";v.error(m)}finally{u(!1)}},i=()=>{p(n),f()};return e.jsx(O,{open:y,onOpenChange:i,children:e.jsxs(P,{className:"w-full max-w-[95vw] sm:max-w-xl md:max-w-2xl bg-white p-4 sm:p-6 max-h-[90vh] overflow-y-auto rounded-sm",children:[e.jsx(B,{className:"text-lg sm:text-xl font-semibold",children:"Add Review & Rating"}),e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[g?.role==="seller"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm sm:text-base font-medium text-gray-600",children:"Rating"}),e.jsx(N,{size:"w-6 h-6 sm:w-7 sm:h-7 md:w-8 md:h-8",rating:t.sellerRating,onRatingChange:r=>l("sellerRating",r)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm sm:text-base font-medium text-gray-600",children:"Comment"}),e.jsx("textarea",{placeholder:"Share your experience with the seller...",className:"w-full min-h-[100px] sm:min-h-[120px] md:min-h-[150px] p-2 sm:p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary resize-none text-sm sm:text-base",value:t.sellerComment,maxLength:500,onChange:r=>l("sellerComment",r.target.value),rows:3})]})]}),g?.role==="driver"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm sm:text-base font-medium text-gray-600",children:"Rating"}),e.jsx(N,{size:"w-6 h-6 sm:w-7 sm:h-7 md:w-8 md:h-8",rating:t.driverRating,onRatingChange:r=>l("driverRating",r)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm sm:text-base font-medium text-gray-600",children:"Comment"}),e.jsx("textarea",{placeholder:"Share your experience with the driver...",className:"w-full min-h-[100px] sm:min-h-[120px] md:min-h-[150px] p-2 sm:p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary resize-none text-sm sm:text-base",value:t.driverComment,maxLength:500,onChange:r=>l("driverComment",r.target.value),rows:3})]})]}),e.jsxs("div",{className:"flex flex-row justify-center sm:justify-end gap-2 sm:gap-3 pt-4",children:[e.jsx(c,{variant:"outline",onClick:i,className:"w-[224px]  px-6 sm:px-8 py-2 sm:py-2.5 border-gray-300 text-gray-600 hover:bg-gray-100 hover:text-gray-600 text-sm sm:text-base h-[53px]",children:"Cancel"}),e.jsx(c,{type:"button",disabled:h||t.buyerRating===0&&t.driverRating===0&&t.sellerRating===0,onClick:a,className:"  bg-primary hover:bg-primary/80 text-white px-6 sm:px-8 py-2 sm:py-2.5 w-[220px] text-sm sm:text-base h-[53px]",children:h?"Submitting...":"Add Review"})]})]})]})})},$=({order:s,onViewItem:y,onWriteReview:f,onBuyAgain:o,viewOrderDetailes:d})=>{const{user:x}=R(),g=A(),[n,t]=j.useState(!1),p=s.id,h=s.products?.reduce((a,i)=>a+(i.quantity||1),0)||1,u=s.products?.reduce((a,i)=>a+(i.price||0),0)||s.amount||0,l=a=>{g(`/buying/${a}`)};return s.products&&s.products.length>0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-4 sm:px-6 py-3  border-b border-gray-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-0",children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3 sm:gap-4 lg:gap-6 flex-1",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:"Order Placed"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:C(s.date)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:"Total"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:w(u)})]}),e.jsxs("div",{className:"hidden sm:block",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:"Quantity"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:h})]}),e.jsxs("div",{className:"col-span-2 sm:col-span-1 lg:col-span-1",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:"Status"}),e.jsx(M,{className:`px-2 lg:px-3 py-1 rounded-full font-medium text-xs ${I(s.status)}`,children:s.status})]}),e.jsxs("div",{className:"hidden lg:block",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider mb-1",children:"Payment"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Paid"})]})]}),e.jsxs("div",{className:"sm:ml-4 lg:ml-6 text-left sm:text-right space-y-1",children:[e.jsxs("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:["Order # ",p]}),d&&e.jsx("button",{onClick:()=>l(s.id),className:"text-primary hover:text-primary text-sm font-medium underline block cursor-pointer",children:"View Order Details"}),s.status==="Delivered"&&e.jsx("div",{className:"flex-shrink-0 self-start",children:e.jsx(c,{type:"button",onClick:()=>t(!0),className:"bg-primary  hover:bg-primary/80 text-white rounded-lg px-6 py-3 h-auto font-medium text-base whitespace-nowrap",children:"Write a Review"})})]})]})}),e.jsx("div",{className:"divide-y divide-gray-200",children:s.products.map((a,i)=>e.jsx("div",{className:"px-4 sm:px-6 py-4 sm:py-5",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-4 sm:gap-6",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:a.image||"https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=128&h=96&fit=crop",alt:a.title,className:"w-full sm:w-32 h-32 sm:h-24 object-cover rounded-lg"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-2",children:a.title}),e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Price:"})," ",w(a.price||0)]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Qty:"})," ",a.quantity||1]}),a.color&&e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Color:"})," ",e.jsx("span",{className:"capitalize",children:L(a.color).name})]})]}),e.jsxs("p",{className:"text-sm text-gray-500 mb-3 sm:mb-4",children:["Delivery on ",C(a.deliveryDate||"12 October 2024")]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[x?.role==="seller"&&e.jsx(c,{variant:"outline",onClick:()=>{y?.({slug:a.productRef?.slug||""}),console.log("Viewing item:",a.title)},className:"border-primary text-primary hover:bg-blue-50 rounded-lg px-6 py-2 h-auto font-medium",children:"View your item"}),x?.role==="buyer"&&i===0&&(s.status==="Delivered"||s.status==="Cancelled")&&e.jsxs(c,{variant:"outline",onClick:()=>o?.(a.id||""),className:"border-blue-600 text-blue-600 hover:bg-blue-50 rounded-lg px-6 py-2 h-auto font-medium inline-flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Buy It Again"]})]})]})},a.id||i))}),n&&e.jsx(V,{isOpen:n,onClose:()=>t(!1),orderId:s?._id,order:s,onSuccess:()=>{f?.()}})]}):e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:e.jsx("p",{children:"No products found for this order"})})};export{$ as O};
