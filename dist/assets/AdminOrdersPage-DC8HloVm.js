import{r as l,ae as B,j as e,B as x,a6 as H,a7 as Y,a8 as U,a9 as z,aa as _,am as de,K as q,N as ce,ab as me,u as xe}from"./index-CUSVstqU.js";import{u as ge,f as Q,g as he,a as ue,b as pe}from"./index-7rtZR-0h.js";import{T as Ne,a as je,b as W,c as fe,d as ye,e as be}from"./table-DneWR9W7.js";import{B as J}from"./badge-c_xwgsXg.js";import{g as X}from"./orderUtils-DR-jD4b-.js";import{S as ee}from"./SortDropdown-BZ2QEsue.js";import{O as se,t as we}from"./orderTransformers-DSlKWA6p.js";import{f as Z}from"./date-utils-CIparGJB.js";import{E as te}from"./EmptyState-CH6fPGhV.js";import{O as ae}from"./orderEmptyState-Bba5zfCx.js";import{A as N}from"./arrow-up-down-BPvpXmMH.js";import{P as ve}from"./pagination-wrapper-Caj-HnEp.js";import{b as Se}from"./useOrderMutations-CL6oNQvb.js";import{S as Ce}from"./SellerOrdersPageSkeleton--K0ktxCX.js";import{S as Fe}from"./SearchInput-CIs23NSy.js";import"./en-US-CPLesiGp.js";import"./isSameDay-CeY-boyx.js";import"./format-Byp0gi1d.js";import"./endOfMonth-B0jjArdg.js";const De=({orders:A,onViewAll:h,onViewDetails:g,title:w,showFilter:u=!0,showSort:I=!0,showSearch:O=!0,totalOrders:K,selectedSort:c,onSortChange:v,filters:n,onFilterChange:S,searchValue:j,onSearchChange:G,isLoading:C=!1})=>{const[f,T]=l.useState([]),[P,R]=l.useState([]),[V,L]=l.useState({}),[$,E]=l.useState({}),[b,y]=l.useState(""),[F,r]=l.useState("recent"),[m,i]=l.useState({orderStatus:"",pricing:""}),D=c!==void 0?c:F,o=n!==void 0?n:m;B.useEffect(()=>{j!==void 0&&y(j)},[j]);const k=B.useMemo(()=>[{id:"serialNumber",header:()=>e.jsx("div",{className:"text-center",children:"Sr.No."}),cell:s=>e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"text-primary font-medium text-xs lg:text-sm",children:s.row.index+1})}),enableSorting:!1,enableColumnFilter:!1},{accessorKey:"id",header:({column:s})=>e.jsxs(x,{variant:"ghost",className:"p-0 hover:bg-transparent font-semibold text-gray-700 text-xs lg:text-sm",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["Order ID",e.jsx(N,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>e.jsxs("span",{className:"text-primary font-medium text-xs lg:text-sm",children:["#",s.getValue("id")]})},{id:"customer",accessorFn:s=>s.customer?.displayName,header:({column:s})=>e.jsxs(x,{variant:"ghost",className:"p-0 hover:bg-transparent font-semibold text-gray-700 text-xs lg:text-sm",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["Buyer",e.jsx(N,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>{const t=s.original.customer;return e.jsxs("div",{className:"flex items-center gap-2 lg:gap-3 py-1",children:[e.jsxs(H,{className:"w-8 h-8 lg:w-10 lg:h-10 border-2 border-white shadow-sm",children:[t?.avatar?e.jsx(Y,{src:t.avatar,alt:t?.displayName||"Customer",className:"object-cover"}):null,e.jsx(U,{className:"bg-gray-200 text-gray-700 font-medium text-xs uppercase",children:t?.displayName?z(t.displayName):"NA"})]}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-xs lg:text-sm text-gray-900 capitalize",children:t?.displayName||"Unknown"}),e.jsx("div",{className:"text-xs text-gray-500",children:t?.email||"No email"})]})]})},filterFn:(s,t,a)=>a===void 0||a===""?!0:s.getValue(t)?.toLowerCase().includes(a.toLowerCase())},{id:"seller",accessorFn:s=>s.seller?.displayName,header:({column:s})=>e.jsxs(x,{variant:"ghost",className:"p-0 hover:bg-transparent font-semibold text-gray-700 text-xs lg:text-sm",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["Seller",e.jsx(N,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>{const t=s.original.seller;return e.jsxs("div",{className:"flex items-center gap-2 lg:gap-3 py-1",children:[e.jsxs(H,{className:"w-8 h-8 lg:w-10 lg:h-10 border-2 border-white shadow-sm",children:[t?.avatar?e.jsx(Y,{src:t.avatar,alt:t?.displayName||"Seller",className:"object-cover"}):null,e.jsx(U,{className:"bg-gray-200 text-gray-700 font-medium text-xs uppercase",children:t?.displayName?z(t.displayName):"NA"})]}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-xs lg:text-sm text-gray-900 capitalize",children:t?.displayName||"Unknown"}),e.jsx("div",{className:"text-xs text-gray-500",children:t?.email||"No email"})]})]})},filterFn:(s,t,a)=>a===void 0||a===""?!0:s.getValue(t)?.toLowerCase().includes(a.toLowerCase())},{id:"driver",accessorFn:s=>s.driver?.displayName,header:({column:s})=>e.jsxs(x,{variant:"ghost",className:"p-0 hover:bg-transparent font-semibold text-gray-700 text-xs lg:text-sm",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["Driver",e.jsx(N,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>{const t=s.original.driver;return t?e.jsxs("div",{className:"flex items-center gap-2 lg:gap-3 py-1",children:[e.jsxs(H,{className:"w-8 h-8 lg:w-10 lg:h-10 border-2 border-white shadow-sm",children:[t?.avatar?e.jsx(Y,{src:t.avatar,alt:t?.displayName||"Driver",className:"object-cover"}):null,e.jsx(U,{className:"bg-gray-200 text-gray-700 font-medium text-xs uppercase",children:t?.displayName?z(t.displayName):"NA"})]}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-xs lg:text-sm text-gray-900 capitalize",children:t?.displayName||"Unknown"}),e.jsx("div",{className:"text-xs text-gray-500",children:t?.email||"No email"})]})]}):e.jsx("span",{className:"text-gray-500 text-xs lg:text-sm",children:"Not Assigned"})},filterFn:(s,t,a)=>a===void 0||a===""?!0:s.getValue(t)?.toLowerCase().includes(a.toLowerCase())},{accessorKey:"date",header:({column:s})=>e.jsxs(x,{variant:"ghost",className:"p-0 hover:bg-transparent font-semibold text-gray-700 text-xs lg:text-sm",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["Date",e.jsx(N,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>e.jsx("span",{className:"text-gray-700 text-xs lg:text-sm",children:Z(s.getValue("date"))}),sortingFn:"datetime"},{accessorKey:"amount",header:({column:s})=>e.jsxs(x,{variant:"ghost",className:"p-0 hover:bg-transparent font-semibold text-gray-700 text-xs lg:text-sm",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["Amount",e.jsx(N,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>e.jsx("span",{className:"text-gray-900 font-semibold text-xs lg:text-sm",children:_(s.getValue("amount"))})},{accessorKey:"status",header:({column:s})=>e.jsxs(x,{variant:"ghost",className:"p-0 hover:bg-transparent font-semibold text-gray-700 text-xs lg:text-sm",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["Status",e.jsx(N,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>{const t=s.getValue("status");return e.jsx(J,{className:`px-2 lg:px-3 py-1 rounded-full font-medium text-xs capitalize ${X(t)}`,children:t})},filterFn:(s,t,a)=>a===void 0||a===""?!0:s.getValue(t)?.toLowerCase()===a.toLowerCase()},{id:"actions",header:()=>e.jsx("div",{className:"text-center",children:"Actions"}),cell:({row:s})=>{const t=s.original;return e.jsx("div",{className:"text-center",children:e.jsxs(x,{variant:"link",className:"text-primary font-semibold text-xs lg:text-sm p-0 underline",onClick:()=>g?.(t.id),children:[e.jsx(de,{className:"mr-1 h-4 w-4"}),"View"]})})},enableSorting:!1,enableColumnFilter:!1}],[g]),d=ge({data:A,columns:k,onSortingChange:T,onColumnFiltersChange:R,getCoreRowModel:pe(),getSortedRowModel:ue(),getFilteredRowModel:he(),onColumnVisibilityChange:L,onRowSelectionChange:E,globalFilterFn:"includesString",state:{sorting:f,columnFilters:P,columnVisibility:V,rowSelection:$,globalFilter:b},onGlobalFilterChange:y,enableRowSelection:!0,getRowId:(s,t)=>s.id||String(t)}),p=s=>{v?v(s):r(s)},M=s=>{S?S(s):i(s)};return B.useEffect(()=>{o?.orderStatus?d.getColumn("status")?.setFilterValue(o.orderStatus.toLowerCase()):d.getColumn("status")?.setFilterValue("")},[o,d]),C?e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"h-8 w-40 bg-gray-200 rounded animate-pulse"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-10 w-32 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-10 w-24 bg-gray-200 rounded animate-pulse"})]})]}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200",children:Array.from({length:5}).map((s,t)=>e.jsx("div",{className:"p-4 border-b last:border-b-0 animate-pulse",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-full"})},t))})]}):e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-4",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-gray-900",children:w})}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[h&&e.jsx(x,{variant:"link",className:"text-primary font-semibold text-xs md:text-sm p-0 underline",onClick:h,children:"View All Orders"}),I&&e.jsx(ee,{selectedSort:D,onSortChange:p}),u&&e.jsx(se,{filters:o,onFilterChange:M})]})]}),d.getFilteredRowModel().rows.length===0&&e.jsx(te,{title:"No orders found",description:b?`No results found for "${b}". Try adjusting your search.`:o?.orderStatus||o?.pricing?"No orders match your current filters. Try adjusting your filters.":"You don't have any orders yet.",icon:e.jsx("img",{src:ae,className:"w-64 h-56",alt:"No orders"}),className:"min-h-[400px]"}),d.getFilteredRowModel().rows.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"block md:hidden space-y-3",children:d.getFilteredRowModel().rows.map((s,t)=>{const a=s.original;return e.jsx(q,{className:"bg-white shadow-sm border-gray-200",children:e.jsxs(ce,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Order ID"}),e.jsxs("p",{className:"text-sm font-medium text-primary",children:["#",a.id]})]}),e.jsx(J,{className:`px-2 py-1 rounded-full font-medium text-xs ${X(a.status)}`,children:a.status})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Buyer:"}),e.jsx("span",{className:"text-xs font-medium",children:a.customer?.displayName||"Unknown"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Seller:"}),e.jsx("span",{className:"text-xs font-medium",children:a.seller?.displayName||"Unknown"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Driver:"}),e.jsx("span",{className:"text-xs font-medium",children:a.driver?.displayName||"Not Assigned"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Date:"}),e.jsx("span",{className:"text-xs font-medium",children:Z(a.date)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Amount:"}),e.jsx("span",{className:"text-xs font-semibold text-primary",children:_(a.amount)})]})]}),e.jsx("div",{className:"flex justify-end pt-3 border-t",children:e.jsxs(x,{variant:"ghost",size:"sm",className:"text-primary font-semibold text-xs",onClick:()=>g?.(a.id),children:["View Details",e.jsx(me,{className:"w-4 h-4 ml-1"})]})})]})},a.id||t)})}),e.jsx(q,{className:"hidden md:block bg-white shadow-sm border-gray-50 rounded-3xl p-0 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Ne,{children:[e.jsx(je,{children:d.getHeaderGroups().map(s=>e.jsx(W,{className:"bg-gray-50/50 hover:bg-gray-50/50",children:s.headers.map(t=>e.jsx(fe,{children:t.isPlaceholder?null:Q(t.column.columnDef.header,t.getContext())},t.id))},s.id))}),e.jsx(ye,{children:d.getRowModel().rows.map(s=>e.jsx(W,{"data-state":s.getIsSelected()&&"selected",className:"hover:bg-gray-50/30 border-b",children:s.getVisibleCells().map(t=>e.jsx(be,{className:"py-3 lg:py-4",children:Q(t.column.columnDef.cell,t.getContext())},t.id))},s.id))})]})})})]})]})},_e=()=>{const A=xe(),[h,g]=l.useState(1),[w]=l.useState(10),[u,I]=l.useState("recent"),[O,K]=l.useState(),[c,v]=l.useState(""),[n,S]=l.useState({orderStatus:"",pricing:""}),j=l.useCallback((r,m,i)=>{const D=new Date;let o,k,d="-createdAt";if(m)switch(m){case"high-to-low":d="-amount";break;case"low-to-high":d="amount";break}else switch(r){case"custom":if(i){const a=i.from.getFullYear(),re=String(i.from.getMonth()+1).padStart(2,"0"),le=String(i.from.getDate()).padStart(2,"0");o=`${a}-${re}-${le}`;const oe=i.to.getFullYear(),ne=String(i.to.getMonth()+1).padStart(2,"0"),ie=String(i.to.getDate()).padStart(2,"0");k=`${oe}-${ne}-${ie}`}break;case"this-week":const p=new Date;p.setDate(p.getDate()-p.getDay()),p.setHours(0,0,0,0),o=p.toISOString().split("T")[0];break;case"this-month":const M=new Date(D.getFullYear(),D.getMonth(),1);M.setHours(0,0,0,0),o=M.toISOString().split("T")[0];break;case"last-3-months":const s=new Date;s.setMonth(s.getMonth()-3),s.setHours(0,0,0,0),o=s.toISOString().split("T")[0];break;case"last-6-months":const t=new Date;t.setMonth(t.getMonth()-6),t.setHours(0,0,0,0),o=t.toISOString().split("T")[0];break}return{startDate:o,endDate:k,sort:d}},[]),G=l.useMemo(()=>{const{startDate:r,endDate:m,sort:i}=j(u,n.pricing,O);return{page:h,limit:w,...r&&{startDate:r},...m&&{endDate:m},...i&&{sort:i},...n.orderStatus&&{status:n.orderStatus},...c&&{search:c}}},[h,w,u,n,O,c,j]),{data:C,isLoading:f,isError:T,error:P}=Se(G),R=r=>{A(`/admin/orders/${r}`)},V=r=>{g(r)},L=(r,m)=>{I(r),K(m),g(1)},$=r=>{S(r),g(1)},E=r=>{v(r),r!==c&&g(1)};if(f&&!c&&!n.orderStatus&&!n.pricing&&u==="recent"&&h===1)return e.jsx(Ce,{});if(T)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] text-center",children:[e.jsx("p",{className:"text-red-600 font-semibold mb-2",children:"Error loading orders"}),e.jsx("p",{className:"text-gray-600 text-sm",children:P?.response?.data?.message||"Failed to fetch orders. Please try again."})]});const b=C?.data||[],y=we(b),F=C?.meta?.pagination?.totalPages||1;return e.jsxs("div",{className:"py-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-gray-900",children:"Orders"}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[e.jsx(Fe,{value:c,onChange:E,placeholder:"Search by order no, buyer, seller, driver...",className:"w-64"}),e.jsx(ee,{selectedSort:u,onSortChange:L}),e.jsx(se,{filters:n,onFilterChange:$})]})]}),f&&e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-4 p-4 bg-gray-50 border-b border-gray-200",children:[e.jsx("div",{className:"h-4 w-20 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-4 w-24 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-4 w-20 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-4 w-16 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-4 w-18 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-4 w-16 bg-gray-200 rounded animate-pulse"})]}),Array.from({length:5}).map((r,m)=>e.jsxs("div",{className:"grid grid-cols-6 gap-4 p-4 border-b border-gray-100",children:[e.jsx("div",{className:"h-4 w-16 bg-gray-200 rounded animate-pulse"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 animate-pulse"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"h-3 w-20 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-3 w-24 bg-gray-200 rounded animate-pulse"})]})]}),e.jsx("div",{className:"h-4 w-20 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-4 w-16 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-6 w-20 rounded-full bg-gray-200 animate-pulse"}),e.jsx("div",{className:"h-8 w-16 rounded bg-gray-200 animate-pulse"})]},m))]}),!f&&!y.length&&e.jsx(te,{title:"No orders found",description:c?`No orders found for "${c}". Try a different search term.`:n.orderStatus||n.pricing||u!=="recent"?"No orders match your current filters. Try adjusting your filters.":"You don't have any orders yet.",icon:e.jsx("img",{src:ae,className:"w-64 h-56",alt:"No orders"}),className:"min-h-[400px]"}),!f&&y.length>0&&e.jsx(De,{orders:y,onViewDetails:R,showSort:!1,showFilter:!1}),F>1&&e.jsx(ve,{currentPage:h,totalPages:F,onPageChange:V})]})};export{_e as default};
