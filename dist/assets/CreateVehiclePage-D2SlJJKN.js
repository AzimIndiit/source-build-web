import{c as K,r as o,d as X,e as q,z as c,j as e,F as G,f as Q,X as k,B as W,w as Y}from"./index-BiCr9dd_.js";import{v as Z}from"./vehicleSchemas-CjdoQspT.js";import{F as V}from"./FormSelect-B-UjWW9p.js";import{u as J,V as ee}from"./useVehicleMutations-Cs-QPN7I.js";import{U as x}from"./upload-BsZw_j0x.js";import"./index-BdQq_4o_.js";import"./badge-gylWw4eT.js";import"./vehicleService-B4kj4K-z.js";const h=5,m=2,ae=5*1024*1024,le=[{value:"sedan",label:"Sedan"},{value:"suv",label:"SUV"},{value:"truck",label:"Truck"},{value:"van",label:"Van"},{value:"pickup",label:"Pickup"},{value:"minivan",label:"Minivan"},{value:"other",label:"Other"}],re=[{value:"toyota",label:"Toyota"},{value:"honda",label:"Honda"},{value:"ford",label:"Ford"},{value:"chevrolet",label:"Chevrolet"},{value:"nissan",label:"Nissan"},{value:"hyundai",label:"Hyundai"},{value:"kia",label:"Kia"},{value:"mazda",label:"Mazda"},{value:"volkswagen",label:"Volkswagen"},{value:"mercedes",label:"Mercedes-Benz"},{value:"bmw",label:"BMW"},{value:"audi",label:"Audi"},{value:"tesla",label:"Tesla"},{value:"other",label:"Other"}],O={toyota:[{value:"camry",label:"Camry"},{value:"corolla",label:"Corolla"},{value:"rav4",label:"RAV4"},{value:"highlander",label:"Highlander"},{value:"tacoma",label:"Tacoma"},{value:"sienna",label:"Sienna"}],honda:[{value:"accord",label:"Accord"},{value:"civic",label:"Civic"},{value:"crv",label:"CR-V"},{value:"pilot",label:"Pilot"},{value:"odyssey",label:"Odyssey"}],ford:[{value:"f150",label:"F-150"},{value:"f250",label:"F-250"},{value:"explorer",label:"Explorer"},{value:"escape",label:"Escape"},{value:"transit",label:"Transit"}],chevrolet:[{value:"silverado",label:"Silverado"},{value:"tahoe",label:"Tahoe"},{value:"suburban",label:"Suburban"},{value:"express",label:"Express"}],other:[{value:"other",label:"Other"}]};function he(){const R=K(),[d,b]=o.useState([]),[u,y]=o.useState([]),[I,j]=o.useState(!1),[$,N]=o.useState(!1),[M,w]=o.useState(!1),[D,S]=o.useState(!1),g=J(),F=X({resolver:q(Z),defaultValues:{vehicleType:"",vehicleRegistrationNumber:"",vehicleManufacturer:"",vehicleModel:""}}),{handleSubmit:z,watch:L}=F,E=L("vehicleManufacturer"),B=E?O[E]||O.other:[],f=a=>a.type.startsWith("image/")?a.size>ae?{valid:!1,error:"Maximum size is 5MB allowed"}:{valid:!0}:{valid:!1,error:`"${a.name}" is not an image file`},p=o.useCallback(a=>{a.preventDefault(),a.stopPropagation(),a.type==="dragenter"||a.type==="dragover"?j(!0):a.type==="dragleave"&&j(!1)},[]),C=o.useCallback(a=>{if(a.preventDefault(),a.stopPropagation(),j(!1),a.dataTransfer.files&&a.dataTransfer.files[0]){const r=Array.from(a.dataTransfer.files);if(d.length>=h){c.error(`Maximum ${h} images allowed`);return}const t=h-d.length,s=[],i=[];for(let l=0;l<Math.min(r.length,t);l++){const n=f(r[l]);n.valid?s.push(r[l]):n.error&&i.push(n.error)}r.length>t&&i.push(`Only ${t} more image(s) can be added (max ${h} total)`),s.length>0&&(b(l=>[...l,...s]),w(!1)),i.forEach(l=>c.error(l))}},[d]),A=a=>{if(a.target.files){const r=Array.from(a.target.files);if(d.length>=h){c.error(`Maximum ${h} images allowed`),a.target.value="";return}const t=h-d.length,s=[],i=[];for(let l=0;l<Math.min(r.length,t);l++){const n=f(r[l]);n.valid?s.push(r[l]):n.error&&i.push(n.error)}r.length>t&&i.push(`Only ${t} more image(s) can be added (max ${h} total)`),s.length>0&&(b(l=>[...l,...s]),w(!1)),i.forEach(l=>c.error(l)),a.target.value=""}},v=o.useCallback(a=>{a.preventDefault(),a.stopPropagation(),a.type==="dragenter"||a.type==="dragover"?N(!0):a.type==="dragleave"&&N(!1)},[]),T=o.useCallback(a=>{if(a.preventDefault(),a.stopPropagation(),N(!1),a.dataTransfer.files&&a.dataTransfer.files[0]){const r=Array.from(a.dataTransfer.files);if(u.length>=m){c.error(`Maximum ${m} images allowed`);return}const t=m-u.length,s=[],i=[];for(let l=0;l<Math.min(r.length,t);l++){const n=f(r[l]);n.valid?s.push(r[l]):n.error&&i.push(n.error)}r.length>t&&i.push(`Only ${t} more image(s) can be added (max ${m} total)`),s.length>0&&(y(l=>[...l,...s]),S(!1)),i.forEach(l=>c.error(l))}},[u]),P=a=>{if(a.target.files){const r=Array.from(a.target.files);if(u.length>=m){c.error(`Maximum ${m} images allowed`),a.target.value="";return}const t=m-u.length,s=[],i=[];for(let l=0;l<Math.min(r.length,t);l++){const n=f(r[l]);n.valid?s.push(r[l]):n.error&&i.push(n.error)}r.length>t&&i.push(`Only ${t} more image(s) can be added (max ${m} total)`),s.length>0&&(y(l=>[...l,...s]),S(!1)),i.forEach(l=>c.error(l)),a.target.value=""}},_=a=>{b(r=>r.filter((t,s)=>s!==a))},U=a=>{y(r=>r.filter((t,s)=>s!==a))},H=async a=>{if(d.length===0){w(!0),c.error("Please upload at least one vehicle image"),window.scrollTo({top:0,behavior:"smooth"});return}if(u.length===0){S(!0),c.error("Please upload at least one insurance image"),window.scrollTo({top:0,behavior:"smooth"});return}try{(await g.mutateAsync({vehicleType:a.vehicleType,vehicleManufacturer:a.vehicleManufacturer,vehicleModel:a.vehicleModel,vehicleRegistrationNumber:a.vehicleRegistrationNumber,vehicleImageFiles:d,insuranceImageFiles:u}))?.status==="success"&&(Y.invalidateQueries({queryKey:ee}),R("/driver/vehicles"))}catch(r){console.error("Failed to submit vehicle information:",r)}};return e.jsxs("div",{className:"py-4 md:p-4 space-y-4 md:space-y-6 ",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-gray-900",children:"Add New Vehicle"})}),e.jsx(G,{...F,children:e.jsxs("form",{onSubmit:z(H),className:"space-y-4 flex flex-col justify-between  sm:min-h-[calc(100vh-10px)] lg:min-h-[calc(100vh-260px)] ",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6 ",children:[e.jsx(V,{name:"vehicleType",label:"Vehicle Type",disabled:g.isPending,placeholder:"Select Vehicle type",className:"bg-white",options:le}),e.jsx(Q,{name:"vehicleRegistrationNumber",label:"Vehicle Registration Number",type:"text",className:"bg-white",disabled:g.isPending,placeholder:"Vehicle registration number e.g., KA01AB1234"}),e.jsx(V,{className:"bg-white",name:"vehicleManufacturer",label:"Vehicle Manufacturer",disabled:g.isPending,placeholder:"Select Manufacturer",options:re}),e.jsx(V,{className:"bg-white",name:"vehicleModel",label:"Vehicle Model",disabled:g.isPending||!E,placeholder:"Select Model",options:B}),e.jsxs("div",{className:"space-y-4",children:[d.length===0?e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-4 text-center bg-gray-50 h-50 flex justify-center items-center ${I?"border-primary bg-blue-50":"border-gray-300"} ${M?"border-red-500":""}`,onDragEnter:p,onDragLeave:p,onDragOver:p,onDrop:C,children:[e.jsx("input",{type:"file",id:"vehicle-photo-upload",className:"hidden",multiple:!0,accept:"image/*",onChange:A}),e.jsxs("label",{htmlFor:"vehicle-photo-upload",className:"cursor-pointer inline-flex flex-col items-center",children:[e.jsx(x,{className:"h-8 w-8 text-gray-400 mb-2"}),e.jsxs("span",{className:"text-xs text-gray-600",children:["Drag & drop media or"," ",e.jsx("span",{className:"text-primary underline",children:"click here"})]}),e.jsx("span",{className:"text-xs text-red-600",children:"Max file size is 5MB"})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-3 text-center bg-gray-50  h-30 flex flex-col justify-center items-center  ${I?"border-primary bg-blue-50":"border-gray-300"} ${M?"border-red-500":""}`,onDragEnter:p,onDragLeave:p,onDragOver:p,onDrop:C,children:[e.jsx("input",{type:"file",id:"vehicle-photo-upload-more",className:"hidden",multiple:!0,accept:"image/*",onChange:A}),e.jsxs("label",{htmlFor:"vehicle-photo-upload-more",className:"cursor-pointer inline-flex items-center gap-2",children:[e.jsx(x,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{className:"text-xs text-gray-600",children:["Drag & drop media or"," ",e.jsx("span",{className:"text-primary underline",children:"click here"})]})]}),e.jsx("div",{className:"text-xs text-red-600",children:"Max file size is 5MB"})]}),e.jsx("div",{className:"grid grid-cols-3 lg:grid-cols-5 gap-2",children:d.map((a,r)=>e.jsxs("div",{className:"relative group border border-gray-200 rounded-sm shadow-sm",children:[e.jsx("img",{src:URL.createObjectURL(a),alt:`Vehicle ${r+1}`,className:"w-full sm:h-24 h-20 lg:h-28 object-cover rounded-sm"}),e.jsx("button",{type:"button",onClick:()=>_(r),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-0.5 cursor-pointer",children:e.jsx(k,{className:"h-3 w-3"})})]},`vehicle-${r}`))})]}),M&&e.jsx("p",{className:"text-sm text-red-600 text-left",children:"Please upload at least one vehicle image"})]}),e.jsxs("div",{className:"space-y-2",children:[u.length===0?e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-4 text-center bg-gray-50 h-50 flex justify-center items-center ${$?"border-primary bg-blue-50":"border-gray-300"} ${D?"border-red-500":""}`,onDragEnter:v,onDragLeave:v,onDragOver:v,onDrop:T,children:[e.jsx("input",{type:"file",id:"insurance-photo-upload",className:"hidden",multiple:!0,accept:"image/*",onChange:P}),e.jsxs("label",{htmlFor:"insurance-photo-upload",className:"cursor-pointer inline-flex flex-col items-center",children:[e.jsx(x,{className:"h-8 w-8 text-gray-400 mb-2"}),e.jsxs("span",{className:"text-xs text-gray-600",children:["Drag & drop insurance documents or"," ",e.jsx("span",{className:"text-primary underline",children:"click here"})]}),e.jsx("span",{className:"text-xs text-red-600",children:"Max file size is 5MB"})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-3 text-center bg-gray-50  h-30 flex flex-col justify-center items-center  ${$?"border-primary bg-blue-50":"border-gray-300"} ${D?"border-red-500":""}`,onDragEnter:v,onDragLeave:v,onDragOver:v,onDrop:T,children:[e.jsx("input",{type:"file",id:"insurance-photo-upload-more",className:"hidden",multiple:!0,accept:"image/*",onChange:P}),e.jsxs("label",{htmlFor:"insurance-photo-upload-more",className:"cursor-pointer inline-flex items-center gap-2",children:[e.jsx(x,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{className:"text-xs text-gray-600",children:["Add more insurance documents"," ",e.jsx("span",{className:"text-primary underline",children:"click here"})]})]}),e.jsx("div",{className:"text-xs text-red-600",children:"Max file size is 5MB"})]}),e.jsx("div",{className:"grid grid-cols-3 lg:grid-cols-5 gap-2",children:u.map((a,r)=>e.jsxs("div",{className:"relative group border border-gray-200 rounded-sm shadow-sm",children:[e.jsx("img",{src:URL.createObjectURL(a),alt:`Insurance ${r+1}`,className:"w-full sm:h-24  h-20 lg:h-28 object-cover rounded-sm"}),e.jsx("button",{type:"button",onClick:()=>U(r),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-0.5 cursor-pointer",children:e.jsx(k,{className:"h-3 w-3"})})]},`insurance-${r}`))})]}),D&&e.jsx("p",{className:"text-sm text-red-600 text-left",children:"Please upload at least one insurance image"})]})]}),e.jsx("div",{className:"flex justify-end pt-6 ",children:e.jsx(W,{type:"submit",className:"w-full sm:w-[224px] bg-primary hover:bg-primary/80 text-white",disabled:g.isPending,loading:g.isPending,children:"Submit"})})]})})]})}export{he as default};
