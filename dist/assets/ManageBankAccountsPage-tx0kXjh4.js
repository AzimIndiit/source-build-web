import{r as b,j as e,K as S,X as _,N as F,q as E,aN as z,B,h as L,i as Y,$ as I,ae as Z,af as G,ag as J,aD as V,aE as ee,F as ae,k as w,p as te,aM as se,ap as H,ao as ne,a2 as j,n as h,a3 as ce,E as D,z as m,G as y,aJ as oe,aO as re,f as le}from"./index-CUSVstqU.js";import{T as ue}from"./trash-2-BLdsFbCa.js";import{F as de}from"./FormSelect-DiVd6t5g.js";import{M as ie}from"./ManageBankAccountsSkeleton-BiarPRW9.js";import{E as me}from"./EmptyState-CH6fPGhV.js";import"./index-BdQq_4o_.js";import"./badge-c_xwgsXg.js";const xe=({id:t,accountHolder:a,accountNumber:n,bankName:s,onEdit:r,onDelete:l,onToggleDefault:o,className:d,isDefault:x,totalBankAccount:N})=>{const[g,f]=b.useState(!1),p=async i=>{if(!g&&i&&o){f(!0);try{await o(t,i)}catch(k){console.error("Failed to update default status:",k)}finally{f(!1)}}};return console.log("isDefault && totalBankAccount ",x,N),e.jsx(S,{className:_("bg-gray-50 border-gray-200 shadow-sm hover:shadow-md transition-shadow relative h-[180px] flex flex-col ",d),children:e.jsxs(F,{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-base sm:text-lg line-clamp-1",children:a}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{htmlFor:`default-${n}`,className:"text-xs text-gray-600",children:"Default"}),e.jsx(z,{id:`default-${n}`,checked:x,onCheckedChange:p,className:`h-6 w-12  transition-all duration-200 ${g?"data-[state=checked]:bg-green-500":x&&N?"data-[state=checked]:bg-gray-500 opacity-50 cursor-not-allowed":"data-[state=checked]:bg-green-500"}`})]})]}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("p",{className:"text-gray-600 text-sm font-mono tracking-wider",children:n}),e.jsx("p",{className:"text-gray-700 text-sm",children:s})]}),e.jsx("div",{className:"flex gap-2 justify-end mt-auto pt-3",children:e.jsx(B,{title:"Delete",variant:"ghost",size:"icon",onClick:l,className:"w-8 h-8 hover:bg-red-50 text-red-600 hover:text-red-700 rounded-md",children:e.jsx(ue,{className:"w-4 h-4"})})})]})})},v=[{label:"Checking",value:"checking"},{label:"Savings",value:"savings"},{label:"Current",value:"current"}],ge=I({accountHolderName:j().trim().min(1,"Account holder name is required").min(2,"Account holder name must be at least 2 characters").max(70,"Account holder name must not exceed 70 characters"),bankName:j().trim().min(1,"Bank name is required").min(2,"Bank name must be at least 2 characters").max(100,"Bank name must not exceed 100 characters"),accountNumber:j().trim().min(1,"Account number is required").regex(/^[0-9]+$/,"Account number must contain only digits").min(8,"Account number must be at least 8 digits").max(20,"Account number must not exceed 20 digits"),routingNumber:j().trim().min(1,"Routing number is required").regex(/^[0-9]+$/,"Routing number must contain only digits").min(9,"Routing number must be 9 digits").max(9,"Routing number must be 9 digits"),swiftCode:j().trim().min(1,"SWIFT/BIC code is required").regex(/^[A-Z]{6}[A-Z0-9]{2}([A-Z0-9]{3})?$/,"Invalid SWIFT/BIC code format").max(11,"SWIFT/BIC code must not exceed 11 characters"),accountType:ne(["checking","savings","current"]),isDefault:H().optional()}),fe=I({isDefault:H().optional()}),pe=({isOpen:t,onClose:a,onSubmit:n,initialData:s,isEdit:r=!1,totalBankAccount:l,isSubmitting:o=!1})=>{const d=L({resolver:Y(r?fe:ge),defaultValues:s?{accountHolderName:s.accountHolderName||"",bankName:s.bankName||"",accountNumber:s.accountNumber||"",routingNumber:s.routingNumber||"",swiftCode:s.swiftCode||"",accountType:s.accountType||v[0].value,isDefault:s.isDefault??!1}:{accountHolderName:"",bankName:"",accountNumber:"",routingNumber:"",swiftCode:"",accountType:v[0].value,isDefault:!l}});Z.useEffect(()=>{t?s&&d.reset({accountHolderName:s.accountHolderName||"",bankName:s.bankName||"",accountNumber:s.accountNumber||"",routingNumber:s.routingNumber||"",swiftCode:s.swiftCode||"",accountType:s.accountType||v[0].value,isDefault:s.isDefault??!1}):d.reset({accountHolderName:"",bankName:"",accountNumber:"",routingNumber:"",swiftCode:"",accountType:v[0].value,isDefault:!l})},[s,t,d,l]);const{handleSubmit:x,reset:N,control:g}=d,f=async i=>{await n(i)},p=()=>{o||N(),a()};return e.jsx(G,{open:t,onOpenChange:p,children:e.jsxs(J,{className:" sm:max-w-[600px] md:max-w-[700px] p-0 bg-white max-h-[90vh] overflow-y-auto",children:[e.jsx(V,{className:"px-4 pt-4 sm:px-6 pb-0 mb-0",children:e.jsx(ee,{className:"text-lg sm:text-xl font-semibold",children:r?"Manage Account":"Add New Account"})}),e.jsx(ae,{...d,children:e.jsxs("form",{onSubmit:x(f),className:"p-4 sm:p-6 space-y-4 sm:space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4",children:[e.jsx(w,{disabled:r||o,name:"accountHolderName",label:"Account Holder Name",placeholder:"Enter Account Holder Name"}),e.jsx(w,{name:"bankName",label:"Bank Name",disabled:r||o,placeholder:"Enter Bank Name"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4",children:[e.jsx(w,{disabled:r||o,name:"accountNumber",label:"Bank Account Number",placeholder:"Enter Bank Account Number"}),e.jsx(w,{disabled:r||o,name:"routingNumber",label:"Routing Number",placeholder:"Enter Routing Number"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4",children:[e.jsx(w,{disabled:r||o,name:"swiftCode",label:"SWIFT/BIC Code",placeholder:"Enter SWIFT Code"}),e.jsx(de,{disabled:r||o,name:"accountType",label:"Account Type",options:v})]}),l&&e.jsx(te,{name:"isDefault",control:g,render:({field:i})=>e.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[e.jsx(se,{id:"isDefault",checked:i.value,disabled:o,onCheckedChange:i.onChange,className:"border-gray-300"}),e.jsx(E,{htmlFor:"isDefault",className:"text-sm font-normal text-gray-600 cursor-pointer",children:"Save as default"})]})}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row gap-2 sm:gap-3 pt-3 sm:pt-4 sm:justify-end",children:[e.jsx(B,{type:"button",variant:"outline",onClick:p,className:"w-full sm:w-[200px] md:w-[224px] border-gray-300 text-gray-700 hover:bg-gray-50 text-sm sm:text-base",disabled:o,children:"Cancel"}),e.jsx(B,{type:"submit",className:"w-full sm:w-[200px] md:w-[224px] bg-primary text-white hover:bg-primary/90 text-sm sm:text-base",disabled:o,children:o?"Saving...":r?"Update Account":"Add Account"})]})]})})]})})};class he{async getBankAccounts(){return(await h.get("/bank-accounts")).data}async getBankAccount(a){return(await h.get(`/bank-accounts/${a}`)).data}async createBankAccount(a){console.log("Creating bank account with data:",a);const n=await h.post("/bank-accounts",a);return console.log("Bank account created successfully:",n.data),n.data}async updateBankAccount(a,n){return(await h.patch(`/bank-accounts/${a}/set-default`,n)).data}async deleteBankAccount(a){return(await h.delete(`/bank-accounts/${a}`)).data}async setDefaultBankAccount(a){return(await h.patch(`/bank-accounts/${a}/set-default`)).data}}const C=new he,u=["bankAccounts"];function be(){return ce({queryKey:u,queryFn:()=>C.getBankAccounts(),staleTime:300*1e3,gcTime:600*1e3})}function ye(){return D({mutationFn:t=>C.createBankAccount(t),onSuccess:async t=>{await y.invalidateQueries({queryKey:u}),await y.refetchQueries({queryKey:u}),m.success(t.message||"Bank account added successfully")},onError:t=>{const a=t.response?.data?.message||"Failed to add bank account";m.error(a),console.error("Create bank account error:",t)}})}function Ne(){return D({mutationFn:({id:t,data:a})=>C.updateBankAccount(t,a),onSuccess:async t=>{await y.invalidateQueries({queryKey:u}),await y.refetchQueries({queryKey:u}),m.success(t.message||"Bank account updated successfully")},onError:t=>{const a=t.response?.data?.message||"Failed to update bank account";m.error(a),console.error("Update bank account error:",t)}})}function ke(){return D({mutationFn:t=>C.deleteBankAccount(t),onSuccess:async t=>{await y.invalidateQueries({queryKey:u}),await y.refetchQueries({queryKey:u}),m.success(t.message||"Bank account deleted successfully")},onError:t=>{const a=t.response?.data?.message||"Failed to delete bank account";m.error(a),console.error("Delete bank account error:",t)}})}function Ae(){const t=oe();return D({mutationFn:a=>C.setDefaultBankAccount(a),onMutate:async a=>{await t.cancelQueries({queryKey:u});const n=t.getQueryData(u);return t.setQueryData(u,s=>{if(!s?.data)return s;const r=s.data.map(l=>({...l,isDefault:l.id===a}));return{...s,data:r}}),{previousAccounts:n}},onError:(a,n,s)=>{t.setQueryData(u,s?.previousAccounts);const r=a.response?.data?.message||"Failed to set default bank account";m.error(r),console.error("Set default bank account error:",a)},onSettled:async()=>{await t.invalidateQueries({queryKey:u})},onSuccess:a=>{m.success(a.message||"Default bank account updated")}})}const we="/assets/bankAccountEmptyState-gHdfQKOE.svg",Fe=()=>{const[t,a]=b.useState(!1),[n,s]=b.useState(null),[r,l]=b.useState(!1),[o,d]=b.useState(null),[x,N]=b.useState(null),{data:g,isLoading:f,error:p}=be(),i=ye(),k=Ne(),M=ke(),Q=Ae(),A=g?.data||[],K=async(c,T)=>{if(T)await Q.mutateAsync(c);else{const q=A.find(W=>W.id===c);q&&await k.mutateAsync({id:c,data:{...q,isDefault:!1}})}},X=async c=>{try{n?await k.mutateAsync({id:n.id,data:c}):await i.mutateAsync(c),a(!1),s(null)}catch(T){console.error("Failed to save bank account:",T)}},$=c=>{s(c),a(!0)},O=c=>{d(c),l(!0)},R=()=>{o&&M.mutate(o.id,{onSuccess:()=>{l(!1),d(null)}})},P=()=>{l(!1),d(null)},U=()=>{a(!1),s(null)};return f?e.jsx(ie,{}):p?e.jsx(S,{className:"bg-white border-gray-200 shadow-none h-[calc(100vh-200px)] justify-center items-center",children:e.jsx(F,{className:"px-4 sm:px-6",children:e.jsx("div",{className:"text-center py-12 text-red-500",children:"Failed to load bank accounts. Please try again."})})}):e.jsx(S,{className:"bg-white border-gray-200 shadow-none min-h-[calc(100vh-200px)] flex flex-col",children:e.jsxs(F,{className:"px-4 sm:px-6 flex flex-col flex-1",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 sm:gap-4 mb-4 sm:mb-6",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-semibold",children:"Manage Bank Accounts"}),e.jsxs(B,{onClick:()=>a(!0),className:"w-full sm:w-auto min-w-full sm:min-w-[180px] h-10 sm:h-11 bg-primary hover:bg-primary/90 text-white px-3 sm:px-5 rounded-lg flex items-center justify-center gap-2 text-sm sm:text-base font-medium",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{children:"Add Bank Account"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 sm:gap-6 ",children:A.length>0?A.map(c=>e.jsx(xe,{id:c.id,totalBankAccount:A.length===1,accountHolder:c.accountHolderName,accountNumber:`XXXX XXXX XXXX ${c.accountNumber.slice(-4)}`,bankName:c.bankName,onEdit:()=>$(c),onDelete:()=>O(c),onToggleDefault:K,isDefault:c.isDefault},c.id)):e.jsx("div",{className:"col-span-full",children:e.jsx(me,{title:"No bank accounts added yet",description:"Add your bank account to start receiving payments",icon:e.jsx("img",{src:we,className:"w-64 h-56"}),className:"min-h-[400px]"})})}),e.jsx(pe,{isOpen:t,isSubmitting:i.isPending||k?.isPending,onClose:U,onSubmit:X,totalBankAccount:A.length>0,initialData:n?{accountHolderName:n.accountHolderName,bankName:n.bankName,isDefault:n.isDefault,accountNumber:n.accountNumber,routingNumber:n.routingNumber,swiftCode:n.swiftCode,accountType:n.accountType}:void 0,isEdit:!!n}),r&&e.jsx(le,{isOpen:r,onClose:P,onConfirm:R,title:"Delete Bank Account?",description:e.jsxs(e.Fragment,{children:["Are you sure you want to delete the bank account ending in"," ",e.jsx("strong",{className:"font-semibold",children:o?.accountNumber}),"? This action cannot be undone."]}),confirmText:"Yes, I'm Sure",cancelText:"Cancel",isLoading:M.isPending})]})})};export{Fe as default};
