import{V as oe,r as S,ae as y,u as ce,j as e,a6 as P,a7 as K,a8 as q,B as x,D as H,b as Y,c as G,e as C,bc as de,aO as me,K as X,N as ge,ab as xe,f as he,h as pe,i as ue,$ as ye,af as be,ag as je,aD as fe,aE as Ne,F as ve,k as we,q as J,ac as Q,aN as Ce,ap as Se,by as Ae,a2 as B,z,a5 as De}from"./index-CUSVstqU.js";import{u as Ie,f as W,g as Fe,a as ke,b as Me}from"./index-7rtZR-0h.js";import{T as Te,a as Re,b as Z,c as Ee,d as $e,e as Le}from"./table-DneWR9W7.js";import{B as ee}from"./badge-c_xwgsXg.js";import{f as ae}from"./date-utils-CIparGJB.js";import{E as Oe}from"./EmptyState-CH6fPGhV.js";import{S as _e}from"./SearchInput-CIs23NSy.js";import{S as Ue}from"./SortDropdown-BZ2QEsue.js";import{U as Ve}from"./UserTableSkeleton-Dw2BkS24.js";import{B as Be}from"./buyingEmptyState-C5ryqnDV.js";import{A as se}from"./arrow-up-down-BPvpXmMH.js";import{E as te}from"./ellipsis-vertical-CPx5VAQW.js";import{L as ze}from"./layers-DUzS6LzX.js";import{T as re}from"./trash-2-BLdsFbCa.js";import{a as Pe}from"./imageValidation-BOnAwXS7.js";import{U as ie}from"./upload-BVTc7vsb.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],le=oe("image",Ke);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]],ne=oe("power",qe),ca=({categories:b,title:n,onEdit:A,onDelete:o,onToggleStatus:E,isLoading:D=!1,actionLoading:j=!1,searchValue:c,onSearchChange:h,showSearch:m=!0,showSort:p=!0,showFilter:$=!0,selectedSort:I,onSortChange:d,onAddCategory:T})=>{const[i,F]=S.useState({isOpen:!1,type:null,categoryId:null,categoryName:null}),[f,N]=y.useState([]),[L,O]=y.useState([]),[k,M]=y.useState({}),[g,R]=y.useState({}),[u,v]=y.useState(""),_=ce();y.useEffect(()=>{c!==void 0&&v(c)},[c]);const U=a=>{v(a),h?.(a)},V=()=>{if(i.categoryId){switch(i.type){case"delete":o?.(i.categoryId);break;case"toggle":E?.(i.categoryId);break}F({isOpen:!1,type:null,categoryId:null,categoryName:null})}},w=(a,s,r)=>{F({isOpen:!0,type:a,categoryId:s,categoryName:r})},t=y.useMemo(()=>[{id:"serialNumber",header:()=>e.jsx("div",{className:"text-center",children:"Sr.No."}),cell:a=>e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"text-primary font-medium text-xs lg:text-sm",children:a.row.index+1})}),enableSorting:!1,enableColumnFilter:!1},{accessorKey:"image",header:"Image",cell:({row:a})=>{const s=a.original;return e.jsx("div",{className:"flex items-center gap-2 lg:gap-3 py-1",children:e.jsx(P,{className:"w-10 h-10 lg:w-12 lg:h-12 border-2 border-white shadow-sm",children:s.image?e.jsx(K,{src:s.image,alt:s.name,className:"object-cover"}):e.jsx(q,{className:"bg-gray-200",children:e.jsx(le,{className:"w-5 h-5 text-gray-500"})})})})}},{accessorKey:"name",header:({column:a})=>e.jsxs(x,{variant:"ghost",className:"p-0 hover:bg-transparent font-semibold text-gray-700 text-xs lg:text-sm",onClick:()=>a.toggleSorting(a.getIsSorted()==="asc"),children:["Category",e.jsx(se,{className:"ml-2 h-4 w-4"})]}),cell:({row:a})=>{const s=a.original;return e.jsx("div",{className:"flex items-center gap-2 lg:gap-3 py-1",children:e.jsx("div",{className:"text-left",children:e.jsx("div",{className:"font-medium text-xs lg:text-sm text-gray-900",children:s.name})})})},filterFn:(a,s,r)=>r===void 0||r===""?!0:a.getValue(s)?.toLowerCase().includes(r.toLowerCase())},{accessorKey:"createdAt",header:({column:a})=>e.jsxs(x,{variant:"ghost",className:"p-0 hover:bg-transparent font-semibold text-gray-700 text-xs lg:text-sm",onClick:()=>a.toggleSorting(a.getIsSorted()==="asc"),children:["Created On",e.jsx(se,{className:"ml-2 h-4 w-4"})]}),cell:({row:a})=>e.jsx("span",{className:"text-gray-900 text-xs lg:text-sm",children:ae(a.getValue("createdAt"))}),sortingFn:"datetime"},{accessorKey:"isActive",header:"Status",cell:({row:a})=>{const s=a.getValue("isActive");return e.jsx(ee,{className:`px-2 lg:px-3 py-1 rounded-full font-medium text-xs capitalize ${s?"bg-green-100 text-green-800 border-green-200":"bg-gray-100 text-gray-800 border-gray-200"}`,children:s?"Active":"Inactive"})}},{id:"actions",header:()=>e.jsx("div",{className:"text-center",children:"Actions"}),cell:({row:a})=>{const s=a.original;return e.jsx("div",{className:"text-center",children:e.jsxs(H,{children:[e.jsx(Y,{asChild:!0,children:e.jsxs(x,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(te,{className:"h-4 w-4"})]})}),e.jsxs(G,{align:"end",children:[n==="Categories"&&e.jsxs(C,{onClick:()=>_(`/admin/categories/${s._id}/subcategories`),className:"cursor-pointer text-blue-600",children:[e.jsx(ze,{className:"mr-2 h-4 w-4"}),"View Subcategories"]}),e.jsxs(C,{onClick:()=>A?.(s),className:"cursor-pointer text-primary",children:[e.jsx(de,{className:"mr-2 h-4 w-4"}),"Edit ",n==="Categories"?"Category":"Subcategory"]}),e.jsxs(C,{onClick:()=>w("toggle",s._id,s.name),className:"cursor-pointer",children:[e.jsx(ne,{className:"mr-2 h-4 w-4"}),s.isActive?"Deactivate":"Activate"]}),e.jsxs(C,{onClick:()=>w("delete",s._id,s.name),className:"cursor-pointer text-red-600 hover:text-red-700",children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),"Delete ",n==="Categories"?"Category":"Subcategory"]})]})]})})},enableSorting:!1,enableColumnFilter:!1}],[A,o,E]),l=Ie({data:b,columns:t,onSortingChange:N,onColumnFiltersChange:O,getCoreRowModel:Me(),getSortedRowModel:ke(),getFilteredRowModel:Fe(),onColumnVisibilityChange:M,onRowSelectionChange:R,globalFilterFn:"includesString",state:{sorting:f,columnFilters:L,columnVisibility:k,rowSelection:g,globalFilter:u},onGlobalFilterChange:v});return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex  flex-col justify-between items-end flex-end gap-4 mb-4",children:[e.jsxs("div",{className:"justify-between items-centre flex w-full border-b border-gray-200 pb-4",children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-gray-900",children:n}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(x,{onClick:()=>T?.(),className:"bg-primary text-white hover:bg-primary/90 h-10",children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Add ",n==="Categories"?"Category":"Subcategory"]})})]}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[m&&e.jsx(_e,{value:u??"",onChange:U,placeholder:`Search ${n?.toLowerCase()}...`,className:"w-64"}),p&&e.jsx(Ue,{selectedSort:I,onSortChange:d})]})]}),D&&e.jsx(Ve,{}),!D&&l.getFilteredRowModel().rows.length===0&&e.jsx(Oe,{title:`No ${n||`${n?.toLowerCase()}`} found`,description:u?`No results found for "${u}". Try adjusting your search.`:`You don't have any ${n?.toLowerCase()||`${n?.toLowerCase()}`} yet.`,icon:e.jsx("img",{src:Be,className:"w-64 h-56",alt:"No categories"}),className:"min-h-[400px]"}),!D&&l.getFilteredRowModel().rows.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"block md:hidden space-y-3",children:l.getFilteredRowModel().rows.map((a,s)=>{const r=a.original;return e.jsx(X,{className:"bg-white shadow-sm border-gray-200",children:e.jsxs(ge,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(P,{className:"w-10 h-10 border-2 border-white shadow-sm",children:r.image?e.jsx(K,{src:r.image,alt:r.name,className:"object-cover"}):e.jsx(q,{className:"bg-gray-200",children:e.jsx(le,{className:"w-5 h-5 text-gray-500"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:r.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:["#",s+1]})]})]}),e.jsx(ee,{className:`px-2 py-1 rounded-full font-medium text-xs capitalize ${r.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:r.isActive?"Active":"Inactive"})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsx("p",{className:"text-xs text-gray-600 line-clamp-2",children:r.description||"No description"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsxs("span",{children:["Order: ",r.order||0]}),e.jsx("span",{children:ae(r.createdAt)})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t",children:[e.jsxs(x,{variant:"ghost",size:"sm",className:"text-primary font-semibold text-xs",onClick:()=>A?.(r),children:["Edit",e.jsx(xe,{className:"w-4 h-4 ml-1"})]}),e.jsxs(H,{children:[e.jsx(Y,{asChild:!0,children:e.jsx(x,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(te,{className:"h-4 w-4"})})}),e.jsxs(G,{align:"end",children:[e.jsxs(C,{onClick:()=>w("toggle",r._id,r.name),className:"cursor-pointer",children:[e.jsx(ne,{className:"mr-2 h-4 w-4"}),r.isActive?"Deactivate":"Activate"]}),e.jsxs(C,{onClick:()=>w("delete",r._id,r.name),className:"cursor-pointer text-red-600",children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]})]})},r._id)})}),e.jsx(X,{className:"hidden md:block bg-white shadow-sm border-gray-50 rounded-3xl p-0 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Te,{children:[e.jsx(Re,{children:l.getHeaderGroups().map(a=>e.jsx(Z,{className:"bg-gray-50/50 hover:bg-gray-50/50",children:a.headers.map(s=>e.jsx(Ee,{children:s.isPlaceholder?null:W(s.column.columnDef.header,s.getContext())},s.id))},a.id))}),e.jsx($e,{children:l.getRowModel().rows.map((a,s)=>e.jsx(Z,{"data-state":a.getIsSelected()&&"selected",className:"hover:bg-gray-50/30 border-b",children:a.getVisibleCells().map(r=>e.jsx(Le,{className:"py-3 lg:py-4",children:r.column.id==="serialNumber"?e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"text-primary font-medium text-xs lg:text-sm",children:s+1})}):W(r.column.columnDef.cell,r.getContext())},r.id))},a.id))})]})})})]}),e.jsx(he,{isOpen:i.isOpen,onClose:()=>F({isOpen:!1,type:null,categoryId:null,categoryName:null}),onConfirm:V,title:i.type==="delete"?"Delete Category?":i.type==="toggle"?`${b.find(a=>a._id===i.categoryId)?.isActive?"Deactivate":"Activate"} Category?`:"",description:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-medium text-gray-900",children:i.categoryName}),e.jsx("div",{className:"text-sm text-gray-700 mt-3",children:i.type==="delete"?"This action cannot be undone. All subcategories under this category will also be affected.":i.type==="toggle"?`This will ${b.find(a=>a._id===i.categoryId)?.isActive?"deactivate":"activate"} the category and affect its visibility.`:""})]}),isLoading:j,confirmText:i.type==="delete"?"Yes, Delete":i.type==="toggle"?`Yes, ${b.find(a=>a._id===i.categoryId)?.isActive?"Deactivate":"Activate"} `:""})]})},He=ye({name:B().trim().min(1,"Category name is required").max(100,"Category name must not exceed 100 characters"),description:B().trim().optional(),image:B().trim().min(1,"Category image is required"),order:Ae().min(0,"Order must be at least 0").optional(),isActive:Se().optional()}),da=({isOpen:b,onClose:n,onSubmit:A,category:o,isLoading:E=!1,edit:D=!1,categoryId:j})=>{const[c,h]=S.useState(null),[m,p]=S.useState(null),[$,I]=S.useState(!1),[d,T]=S.useState(!1),i=pe({resolver:ue(He),defaultValues:{name:"",description:"",image:"",order:0,isActive:!0},mode:"onChange"}),{handleSubmit:F,reset:f,setValue:N,watch:L,clearErrors:O,formState:{errors:k}}=i,M=L("isActive");S.useEffect(()=>{o?(f({name:o.name,description:o.description||"",image:o.image||"existing",order:o.order||0,isActive:o.isActive}),p(o.image||null),h(null)):(f({name:"",description:"",image:"",order:0,isActive:!0}),p(null),h(null))},[o,f]);const g=t=>{t.preventDefault(),t.stopPropagation(),t.type==="dragenter"||t.type==="dragover"?I(!0):t.type==="dragleave"&&I(!1)},R=t=>{t.preventDefault(),t.stopPropagation(),I(!1),t.dataTransfer.files&&t.dataTransfer.files[0]&&u(t.dataTransfer.files[0])},u=async t=>{if(!t)return;const l=await Pe(t);if(!l.valid){z.error(l.error||"Invalid image file");return}O("image"),N("image","uploaded"),h(t),p(null)},v=t=>{t.target.files&&t.target.files[0]&&u(t.target.files[0])},_=()=>{h(null),N("image","")},U=()=>{p(null),N("image","")},V=async t=>{try{return(await De.uploadFile(t)).data.url}catch(l){throw z.error(l?.response?.data?.message||"Failed to upload image"),l}},w=async t=>{try{if(!c&&!m){z.error("Please upload a category image");return}T(!0);let l=t.image;c?l=await V(c):m&&(l=m);const a={...t,image:l};j&&(a.category=j),await A(a),f(),h(null),p(null),n()}catch{}finally{T(!1)}};return e.jsx(be,{open:b,onOpenChange:n,children:e.jsxs(je,{className:"sm:max-w-[500px] bg-white",children:[e.jsx(fe,{children:e.jsx(Ne,{children:o?j?"Edit Subcategory":"Edit Category":j?"Create New Subcategory":"Create New Category"})}),e.jsx(ve,{...i,children:e.jsxs("form",{onSubmit:F(w),className:"space-y-4",children:[e.jsx(we,{name:"name",label:"Category Name",placeholder:"Enter category name",disabled:d,type:"text"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(J,{className:"text-sm font-medium text-gray-900",children:["Category Image",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),!m&&!c?e.jsxs("div",{className:`border-2 border-dashed rounded-xl p-6 text-center ${$?"border-primary bg-blue-50":k.image?"border-red-300 bg-red-50":"border-gray-300 bg-gray-50"}`,onDragEnter:g,onDragLeave:g,onDragOver:g,onDrop:R,children:[e.jsx("input",{type:"file",id:"category-image-upload",className:"hidden",accept:"image/*",onChange:v,disabled:d}),e.jsxs("label",{htmlFor:"category-image-upload",className:"cursor-pointer inline-flex flex-col items-center",children:[e.jsx(ie,{className:"h-10 w-10 text-gray-400 mb-3"}),e.jsxs("span",{className:"text-sm  text-gray-400 font-medium",children:["Drag & drop media or"," ",e.jsx("span",{className:"text-primary underline",children:"click here"})]}),e.jsx("span",{className:"text-xs text-red-600 mt-1",children:"Max file size is 5MB"})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:`border-2 border-dashed rounded-xl p-4 text-center bg-gray-50 ${$?"border-primary bg-blue-50":"border-gray-300"}`,onDragEnter:g,onDragLeave:g,onDragOver:g,onDrop:R,children:[e.jsx("input",{type:"file",id:"category-image-upload-more",className:"hidden",accept:"image/*",onChange:v,disabled:d}),e.jsxs("label",{htmlFor:"category-image-upload-more",className:"cursor-pointer inline-flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5 text-gray-400"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Drag & drop media or"," ",e.jsx("span",{className:"text-primary underline",children:"click here"})]})]}),e.jsx("div",{className:"text-xs text-red-600",children:"Max file size is 5MB"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[m&&e.jsxs("div",{className:"relative group border border-gray-200 rounded-sm shadow-sm",children:[e.jsx("img",{src:m,alt:"Category",className:"w-full h-32 object-cover rounded-sm"}),e.jsx("button",{type:"button",onClick:U,className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-0.5 cursor-pointer",disabled:d,children:e.jsx(Q,{className:"h-3 w-3"})})]}),c&&e.jsxs("div",{className:"relative group border border-gray-200 rounded-sm shadow-sm",children:[e.jsx("img",{src:URL.createObjectURL(c),alt:"Upload preview",className:"w-full h-32 object-cover rounded-sm"}),e.jsx("button",{type:"button",onClick:_,className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-0.5 cursor-pointer",disabled:d,children:e.jsx(Q,{className:"h-3 w-3"})})]})]})]}),k.image&&e.jsx("p",{className:"text-sm text-red-600",children:k.image.message})]}),D?e.jsxs("div",{className:"flex items-center justify-between rounded-lg p-4",children:[e.jsx("div",{className:"space-y-0.5",children:e.jsx(J,{htmlFor:"isActive",className:"text-base font-medium",children:"Status"})}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("p",{className:`${M?"text-green-500":"text-red-500"}`,children:M?"Active":"Inactive"}),e.jsx(Ce,{id:"isActive",checked:M,onCheckedChange:t=>N("isActive",t),disabled:d})]})]}):null,e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(x,{variant:"outline",onClick:n,className:"px-6 w-[220px] border-gray-200 text-gray-600 ",children:"Cancel"}),e.jsx(x,{type:"submit",disabled:d,className:"bg-primary hover:bg-primary/90 text-white px-6 w-[220px]",children:d?"Submitting...":"Submit"})]})]})})]})})};export{ca as C,da as a};
