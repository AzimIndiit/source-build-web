import{u as ae,ad as le,r as o,h as re,i as se,z as c,j as e,B as K,F as te,k as ie,ac as w,G as ne}from"./index-CUSVstqU.js";import{v as oe}from"./vehicleSchemas-BBX33FG9.js";import{F as A}from"./FormSelect-DiVd6t5g.js";import{a as ce,b as de,V as he}from"./useVehicleMutations-BPmVrHVS.js";import{U as I}from"./upload-BVTc7vsb.js";import"./index-BdQq_4o_.js";import"./badge-c_xwgsXg.js";import"./vehicleService-DvBLmtkJ.js";const u=5,m=2,ue=5*1024*1024,me=[{value:"sedan",label:"Sedan"},{value:"suv",label:"SUV"},{value:"truck",label:"Truck"},{value:"van",label:"Van"},{value:"pickup",label:"Pickup"},{value:"minivan",label:"Minivan"},{value:"other",label:"Other"}],ge=[{value:"toyota",label:"Toyota"},{value:"honda",label:"Honda"},{value:"ford",label:"Ford"},{value:"chevrolet",label:"Chevrolet"},{value:"nissan",label:"Nissan"},{value:"hyundai",label:"Hyundai"},{value:"kia",label:"Kia"},{value:"mazda",label:"Mazda"},{value:"volkswagen",label:"Volkswagen"},{value:"mercedes",label:"Mercedes-Benz"},{value:"bmw",label:"BMW"},{value:"audi",label:"Audi"},{value:"tesla",label:"Tesla"},{value:"other",label:"Other"}],X={toyota:[{value:"camry",label:"Camry"},{value:"corolla",label:"Corolla"},{value:"rav4",label:"RAV4"},{value:"highlander",label:"Highlander"},{value:"tacoma",label:"Tacoma"},{value:"sienna",label:"Sienna"}],honda:[{value:"accord",label:"Accord"},{value:"civic",label:"Civic"},{value:"crv",label:"CR-V"},{value:"pilot",label:"Pilot"},{value:"odyssey",label:"Odyssey"}],ford:[{value:"f150",label:"F-150"},{value:"f250",label:"F-250"},{value:"explorer",label:"Explorer"},{value:"escape",label:"Escape"},{value:"transit",label:"Transit"}],chevrolet:[{value:"silverado",label:"Silverado"},{value:"tahoe",label:"Tahoe"},{value:"suburban",label:"Suburban"},{value:"express",label:"Express"}],other:[{value:"other",label:"Other"}]};function Me(){const P=ae(),{vehicleId:f}=le(),[d,E]=o.useState([]),[h,V]=o.useState([]),[b,R]=o.useState([]),[y,O]=o.useState([]),[L,D]=o.useState(!1),[_,S]=o.useState(!1),[$,C]=o.useState(!1),[F,k]=o.useState(!1);console.log("vehicleId",f);const{data:j,isLoading:p}=ce(f||""),g=de(),N=re({resolver:se(oe),defaultValues:{vehicleType:"",vehicleRegistrationNumber:"",vehicleManufacturer:"",vehicleModel:""}});o.useEffect(()=>{if(j?.data){const a=j.data;N.reset({vehicleType:a.vehicleType||"",vehicleRegistrationNumber:a.vehicleRegistrationNumber||"",vehicleManufacturer:a.vehicleManufacturer||"",vehicleModel:a.vehicleModel||""}),a.vehicleImages&&a.vehicleImages.length>0&&R(a.vehicleImages),a.insuranceImages&&a.insuranceImages.length>0&&O(a.insuranceImages)}},[j,N]);const{handleSubmit:G,watch:Q}=N,T=Q("vehicleManufacturer"),q=T?X[T]||X.other:[],M=a=>a.type.startsWith("image/")?a.size>ue?{valid:!1,error:"Maximum size is 5MB allowed"}:{valid:!0}:{valid:!1,error:`"${a.name}" is not an image file`},v=o.useCallback(a=>{a.preventDefault(),a.stopPropagation(),a.type==="dragenter"||a.type==="dragover"?D(!0):a.type==="dragleave"&&D(!1)},[]),z=o.useCallback(a=>{if(a.preventDefault(),a.stopPropagation(),D(!1),a.dataTransfer.files&&a.dataTransfer.files[0]){const l=Array.from(a.dataTransfer.files);if(d.length>=u){c.error(`Maximum ${u} images allowed`);return}const t=u-d.length,s=[],i=[];for(let r=0;r<Math.min(l.length,t);r++){const n=M(l[r]);n.valid?s.push(l[r]):n.error&&i.push(n.error)}l.length>t&&i.push(`Only ${t} more image(s) can be added (max ${u} total)`),s.length>0&&(E(r=>[...r,...s]),C(!1)),i.forEach(r=>c.error(r))}},[d]),B=a=>{if(a.target.files){const l=Array.from(a.target.files);if(d.length>=u){c.error(`Maximum ${u} images allowed`),a.target.value="";return}const t=u-d.length,s=[],i=[];for(let r=0;r<Math.min(l.length,t);r++){const n=M(l[r]);n.valid?s.push(l[r]):n.error&&i.push(n.error)}l.length>t&&i.push(`Only ${t} more image(s) can be added (max ${u} total)`),s.length>0&&(E(r=>[...r,...s]),C(!1)),i.forEach(r=>c.error(r)),a.target.value=""}},x=o.useCallback(a=>{a.preventDefault(),a.stopPropagation(),a.type==="dragenter"||a.type==="dragover"?S(!0):a.type==="dragleave"&&S(!1)},[]),U=o.useCallback(a=>{if(a.preventDefault(),a.stopPropagation(),S(!1),a.dataTransfer.files&&a.dataTransfer.files[0]){const l=Array.from(a.dataTransfer.files);if(h.length>=m){c.error(`Maximum ${m} images allowed`);return}const t=m-h.length,s=[],i=[];for(let r=0;r<Math.min(l.length,t);r++){const n=M(l[r]);n.valid?s.push(l[r]):n.error&&i.push(n.error)}l.length>t&&i.push(`Only ${t} more image(s) can be added (max ${m} total)`),s.length>0&&(V(r=>[...r,...s]),k(!1)),i.forEach(r=>c.error(r))}},[h]),H=a=>{if(a.target.files){const l=Array.from(a.target.files);if(h.length>=m){c.error(`Maximum ${m} images allowed`),a.target.value="";return}const t=m-h.length,s=[],i=[];for(let r=0;r<Math.min(l.length,t);r++){const n=M(l[r]);n.valid?s.push(l[r]):n.error&&i.push(n.error)}l.length>t&&i.push(`Only ${t} more image(s) can be added (max ${m} total)`),s.length>0&&(V(r=>[...r,...s]),k(!1)),i.forEach(r=>c.error(r)),a.target.value=""}},W=a=>{E(l=>l.filter((t,s)=>s!==a))},Y=a=>{R(l=>l.filter((t,s)=>s!==a))},Z=a=>{V(l=>l.filter((t,s)=>s!==a))},J=a=>{O(l=>l.filter((t,s)=>s!==a))},ee=async a=>{if(d.length===0&&b.length===0){C(!0),c.error("Please upload at least one vehicle image"),window.scrollTo({top:0,behavior:"smooth"});return}if(h.length===0&&y.length===0){k(!0),c.error("Please upload at least one insurance image"),window.scrollTo({top:0,behavior:"smooth"});return}if(!f){c.error("Vehicle ID not found");return}try{(await g.mutateAsync({id:f,vehicleType:a.vehicleType,vehicleManufacturer:a.vehicleManufacturer,vehicleModel:a.vehicleModel,vehicleRegistrationNumber:a.vehicleRegistrationNumber,vehicleImageFiles:d,insuranceImageFiles:h,existingVehicleImages:b,existingInsuranceImages:y}))?.status==="success"&&(ne.invalidateQueries({queryKey:he}),P("/driver/vehicles"))}catch(l){console.error("Failed to update vehicle information:",l)}};return p?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading vehicle data..."})]})}):j?.data?e.jsxs("div",{className:"py-4 md:p-4 space-y-4 md:space-y-6 ",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-gray-900",children:"Edit Vehicle"})}),e.jsx(te,{...N,children:e.jsxs("form",{onSubmit:G(ee),className:"space-y-4 flex flex-col justify-between  sm:min-h-[calc(100vh-10px)] lg:min-h-[calc(100vh-260px)] ",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6 ",children:[e.jsx(A,{name:"vehicleType",label:"Vehicle Type",disabled:g.isPending||p,placeholder:"Select Vehicle type",className:"bg-white",options:me}),e.jsx(ie,{name:"vehicleRegistrationNumber",label:"Vehicle Registration Number",type:"text",className:"bg-white",disabled:g.isPending||p,placeholder:"Vehicle registration number e.g., KA01AB1234"}),e.jsx(A,{className:"bg-white",name:"vehicleManufacturer",label:"Vehicle Manufacturer",disabled:g.isPending||p,placeholder:"Select Manufacturer",options:ge}),e.jsx(A,{className:"bg-white",name:"vehicleModel",label:"Vehicle Model",disabled:g.isPending||p||!T,placeholder:"Select Model",options:q}),e.jsxs("div",{className:"space-y-4",children:[d.length===0&&b.length===0?e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-4 text-center bg-gray-50 h-50 flex justify-center items-center ${L?"border-primary bg-blue-50":"border-gray-300"} ${$?"border-red-500":""}`,onDragEnter:v,onDragLeave:v,onDragOver:v,onDrop:z,children:[e.jsx("input",{type:"file",id:"vehicle-photo-upload",className:"hidden",multiple:!0,accept:"image/*",onChange:B}),e.jsxs("label",{htmlFor:"vehicle-photo-upload",className:"cursor-pointer inline-flex flex-col items-center",children:[e.jsx(I,{className:"h-8 w-8 text-gray-400 mb-2"}),e.jsxs("span",{className:"text-xs text-gray-600",children:["Drag & drop media or"," ",e.jsx("span",{className:"text-primary underline",children:"click here"})]}),e.jsx("span",{className:"text-xs text-red-600",children:"Max file size is 5MB"})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-3 text-center bg-gray-50  h-30 flex flex-col justify-center items-center  ${L?"border-primary bg-blue-50":"border-gray-300"} ${$?"border-red-500":""}`,onDragEnter:v,onDragLeave:v,onDragOver:v,onDrop:z,children:[e.jsx("input",{type:"file",id:"vehicle-photo-upload-more",className:"hidden",multiple:!0,accept:"image/*",onChange:B}),e.jsxs("label",{htmlFor:"vehicle-photo-upload-more",className:"cursor-pointer inline-flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{className:"text-xs text-gray-600",children:["Drag & drop media or"," ",e.jsx("span",{className:"text-primary underline",children:"click here"})]})]}),e.jsx("div",{className:"text-xs text-red-600",children:"Max file size is 5MB"})]}),e.jsxs("div",{className:"grid grid-cols-3 lg:grid-cols-5 gap-2",children:[b.map((a,l)=>e.jsxs("div",{className:"relative group border border-gray-200 rounded-sm shadow-sm",children:[e.jsx("img",{src:a,alt:`Vehicle ${l+1}`,className:"w-full sm:h-24 h-20 lg:h-28 object-cover rounded-sm"}),e.jsx("button",{type:"button",onClick:()=>Y(l),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-0.5 cursor-pointer",children:e.jsx(w,{className:"h-3 w-3"})})]},`existing-vehicle-${l}`)),d.map((a,l)=>e.jsxs("div",{className:"relative group border border-gray-200 rounded-sm shadow-sm",children:[e.jsx("img",{src:URL.createObjectURL(a),alt:`Vehicle ${l+1}`,className:"w-full sm:h-24 h-20 lg:h-28 object-cover rounded-sm"}),e.jsx("button",{type:"button",onClick:()=>W(l),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-0.5 cursor-pointer",children:e.jsx(w,{className:"h-3 w-3"})})]},`vehicle-${l}`))]})]}),$&&e.jsx("p",{className:"text-sm text-red-600 text-left",children:"Please upload at least one vehicle image"})]}),e.jsxs("div",{className:"space-y-2",children:[h.length===0&&y.length===0?e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-4 text-center bg-gray-50 h-50 flex justify-center items-center ${_?"border-primary bg-blue-50":"border-gray-300"} ${F?"border-red-500":""}`,onDragEnter:x,onDragLeave:x,onDragOver:x,onDrop:U,children:[e.jsx("input",{type:"file",id:"insurance-photo-upload",className:"hidden",multiple:!0,accept:"image/*",onChange:H}),e.jsxs("label",{htmlFor:"insurance-photo-upload",className:"cursor-pointer inline-flex flex-col items-center",children:[e.jsx(I,{className:"h-8 w-8 text-gray-400 mb-2"}),e.jsxs("span",{className:"text-xs text-gray-600",children:["Drag & drop insurance documents or"," ",e.jsx("span",{className:"text-primary underline",children:"click here"})]}),e.jsx("span",{className:"text-xs text-red-600",children:"Max file size is 5MB"})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-3 text-center bg-gray-50  h-30 flex flex-col justify-center items-center  ${_?"border-primary bg-blue-50":"border-gray-300"} ${F?"border-red-500":""}`,onDragEnter:x,onDragLeave:x,onDragOver:x,onDrop:U,children:[e.jsx("input",{type:"file",id:"insurance-photo-upload-more",className:"hidden",multiple:!0,accept:"image/*",onChange:H}),e.jsxs("label",{htmlFor:"insurance-photo-upload-more",className:"cursor-pointer inline-flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{className:"text-xs text-gray-600",children:["Add more insurance documents"," ",e.jsx("span",{className:"text-primary underline",children:"click here"})]})]}),e.jsx("div",{className:"text-xs text-red-600",children:"Max file size is 5MB"})]}),e.jsxs("div",{className:"grid grid-cols-3 lg:grid-cols-5 gap-2",children:[y.map((a,l)=>e.jsxs("div",{className:"relative group border border-gray-200 rounded-sm shadow-sm",children:[e.jsx("img",{src:a,alt:`Insurance ${l+1}`,className:"w-full sm:h-24  h-20 lg:h-28 object-cover rounded-sm"}),e.jsx("button",{type:"button",onClick:()=>J(l),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-0.5 cursor-pointer",children:e.jsx(w,{className:"h-3 w-3"})})]},`existing-insurance-${l}`)),h.map((a,l)=>e.jsxs("div",{className:"relative group border border-gray-200 rounded-sm shadow-sm",children:[e.jsx("img",{src:URL.createObjectURL(a),alt:`Insurance ${l+1}`,className:"w-full sm:h-24  h-20 lg:h-28 object-cover rounded-sm"}),e.jsx("button",{type:"button",onClick:()=>Z(l),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-0.5 cursor-pointer",children:e.jsx(w,{className:"h-3 w-3"})})]},`insurance-${l}`))]})]}),F&&e.jsx("p",{className:"text-sm text-red-600 text-left",children:"Please upload at least one insurance image"})]})]}),e.jsx("div",{className:"flex justify-end pt-6 ",children:e.jsx(K,{type:"submit",className:"w-full sm:w-[224px] bg-primary hover:bg-primary/80 text-white",disabled:g.isPending||p,loading:g.isPending,children:"Update"})})]})})]}):e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600",children:"Vehicle not found"}),e.jsx(K,{onClick:()=>P("/driver/vehicles"),className:"mt-4",children:"Back to Vehicles"})]})})}export{Me as default};
