import{K as u,aE as b,t as W,aF as p,u as S,r as x,j as t,C as N,ah as f,aG as E,b as k,ag as K,z as _}from"./index-BiCr9dd_.js";import{B as v}from"./badge-gylWw4eT.js";import{L as q}from"./LazyImage-B7kMTuiL.js";import{m as I}from"./proxy-16hbtkMy.js";class F{async getWishlist(){return(await u.get("/wishlists")).data}async addToWishlist(s){return(await u.post("/wishlists/add",s)).data}async removeFromWishlist(s){return(await u.post("/wishlists/remove",s)).data}async updateWishlistItem(s){return(await u.patch("/wishlists/update",s)).data}async clearWishlist(){return(await u.delete("/wishlists/clear")).data}async checkProductInWishlist(s){return(await u.get(`/wishlists/check/${s}`)).data}async getWishlistCount(){return(await u.get("/wishlists/count")).data}async getPopularWishlistItems(s){return(await u.get("/wishlists/popular",{params:{limit:s}})).data}async batchCheckProducts(s){return(await u.post("/wishlists/batch-check",{productIds:s})).data}}const Q=new F,o=["wishlist"],l=["wishlist","count"],h=e=>["wishlist","check",e],P=()=>{const e=b();return W({mutationFn:Q.addToWishlist,onMutate:async s=>{await e.cancelQueries({queryKey:o}),await e.cancelQueries({queryKey:l}),await e.cancelQueries({queryKey:h(s.productId)});const a=e.getQueryData(o),i=e.getQueryData(l),r={product:{id:s.productId,_id:s.productId,title:"",price:0,images:[],slug:""},addedAt:new Date().toISOString(),notificationEnabled:s.notificationEnabled,priceAlert:s.priceAlert};return e.setQueryData(o,n=>n?{...n,items:[...n.items,r],itemCount:n.itemCount+1}:{id:"",_id:"",user:"",items:[r],itemCount:1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),e.setQueryData(l,n=>(n||0)+1),e.setQueryData(h(s.productId),!0),{previousWishlist:a,previousCount:i}},onError:(s,a,i)=>{i?.previousWishlist&&e.setQueryData(o,i.previousWishlist),i?.previousCount!==void 0&&e.setQueryData(l,i.previousCount),e.setQueryData(h(a.productId),!1),p.error("Failed to add to wishlist")},onSuccess:s=>{e.setQueryData(o,s.data),e.invalidateQueries({queryKey:l}),p.success("Product added to wishlist")}})},L=()=>{const e=b();return W({mutationFn:Q.removeFromWishlist,onMutate:async s=>{await e.cancelQueries({queryKey:o}),await e.cancelQueries({queryKey:l}),await e.cancelQueries({queryKey:h(s.productId)});const a=e.getQueryData(o),i=e.getQueryData(l);return e.setQueryData(o,r=>r&&{...r,items:r.items.filter(n=>n.product._id!==s.productId),itemCount:Math.max(0,r.itemCount-1)}),e.setQueryData(l,r=>Math.max(0,(r||0)-1)),e.setQueryData(h(s.productId),!1),{previousWishlist:a,previousCount:i}},onError:(s,a,i)=>{i?.previousWishlist&&e.setQueryData(o,i.previousWishlist),i?.previousCount!==void 0&&e.setQueryData(l,i.previousCount),e.setQueryData(h(a.productId),!0),p.error("Failed to remove from wishlist")},onSuccess:s=>{e.setQueryData(o,s.data),e.invalidateQueries({queryKey:l}),p.success("Product removed from wishlist")}})},T=e=>{switch(Number(e?.readyByDays)){case 0:return t.jsx(v,{className:" absolute bottom-2 left-2 bg-primary/80 text-white rounded px-2 py-1 text-[11px]",children:"Same Day Delivery"});case 1:return t.jsx(v,{className:"absolute bottom-2 left-2 bg-gray-200 text-gray-800 rounded px-2 py-1 text-[11px]",children:"Next Day Delivery"});default:return null}},R=({product:e,onProductClick:s})=>{const{isAuthenticated:a}=S(),i=e.id||e._id||"",r=P(),n=L(),[y,m]=x.useState(e.isInWishlist||!1),w=r.isPending||n.isPending;x.useEffect(()=>{m(e.isInWishlist||!1)},[e.isInWishlist]);const C=c=>{if(c.stopPropagation(),!a){_.error("Please login to add to wishlist");return}if(!w){const d=!y;m(d),d?r.mutate({productId:i},{onError:()=>{m(!1)}}):n.mutate({productId:i},{onError:()=>{m(!0)}})}},D=c=>{if(c.locationIds&&c.locationIds.length>0){const d=c.locationIds[0];if(typeof d=="object"&&d.city){const g=`${d.city}, ${d.state||""}`.trim();return g.length>30?g.slice(0,30)+"...":g}}return"Location not specified"},j=c=>c.images&&c.images.length>0?c.images[0]:"https://placehold.co/300x200.png";return t.jsx(t.Fragment,{children:t.jsxs(N,{className:f("overflow-hidden border-none shadow-none bg-transparent p-0 cursor-pointer group gap-0"),onClick:()=>s(e.slug,e.status),children:[t.jsxs("div",{className:"relative",children:[t.jsx(q,{src:j(e),alt:e.title,className:"rounded-xl",wrapperClassName:"w-full h-44 bg-gray-100 rounded-xl",fallbackSrc:"https://placehold.co/300x200.png",objectFit:"cover",showSkeleton:!0,fadeInDuration:.3,rootMargin:"100px"}),t.jsx(I.button,{className:"absolute top-2 right-2 rounded-full bg-black/20 backdrop-blur-sm p-2 transition-all duration-200 hover:bg-black/30",onClick:C,whileHover:{scale:1.1},whileTap:{scale:.95},initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.2},children:t.jsx(I.div,{animate:{scale:y?[1,1.2,1]:1},transition:{duration:.3},children:t.jsx(E,{className:f("h-5 w-5 transition-colors duration-200 cursor-pointer",y?"text-red-500 fill-red-500":"text-white hover:text-red-400",w&&"opacity-50")})})}),T(e)]}),t.jsxs(k,{className:"p-3 space-y-2",children:[t.jsx("div",{className:"flex justify-between items-center gap-2",children:t.jsxs("div",{className:"text-[16px] font-semibold mb-1",children:[K(e.price)," / sq ft"]})}),t.jsx("p",{className:"text-[12px] text-gray-500 line-clamp-1 capitalize",children:e.category}),t.jsxs("p",{className:"text-[14px] text-gray-700 leading-snug line-clamp-1 mb-1 capitalize",children:[e.title," ",e.dimensions?`- ${e.dimensions.length} L x ${e.dimensions.width} W x ${e.dimensions.height} H `:""," "]}),t.jsxs("div",{className:"flex justify-between text-[12px] text-gray-500",children:[t.jsx("span",{className:"capitalize",children:D(e)}),t.jsx("span",{className:"text-primary capitalize",children:e.seller?.profile?.businessName})]})]})]})})};export{R as P,L as a,T as g,P as u};
