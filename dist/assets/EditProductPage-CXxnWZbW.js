import{j as s,S as o,c as Ae,D as Oe,r as m,a2 as qe,a3 as Ee,d as Be,e as Me,z as b,F as $e,X as He,B as ie,a4 as Le,a5 as _e,a6 as Re,ap as Ge,E as V,H as p,a7 as ne,a8 as F,G as W}from"./index-BiCr9dd_.js";import{v as X,P as oe,a as Qe}from"./imageValidation-DWwGoYeQ.js";import{e as ze,f as We,a as Xe}from"./useProductMutations-u5jL6sZ4.js";import{f as re}from"./format-Byp0gi1d.js";import"./FormSelect-B-UjWW9p.js";import"./index-BdQq_4o_.js";import"./badge-gylWw4eT.js";import"./PickupHoursSelector-CukVc2JL.js";import"./colorUtils-Cg0F6a_m.js";import"./upload-BsZw_j0x.js";import"./trash-2-BSx2CMeK.js";import"./productService-DV0qzB1U.js";import"./en-US-CPLesiGp.js";const Ke=()=>s.jsxs("div",{className:"h-screen bg-gray-50 fixed top-0 w-full z-50 left-0 flex flex-col",children:[s.jsx("div",{className:"bg-primary px-4 py-3",children:s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[s.jsx(o,{className:"h-6 w-6 rounded bg-white/20"}),s.jsxs("div",{children:[s.jsx(o,{className:"h-3 w-20 mb-1 bg-white/20"}),s.jsx(o,{className:"h-4 w-24 bg-white/20"})]})]})})}),s.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row gap-4 p-4 mx-auto overflow-hidden min-h-0 w-full",children:[s.jsx("div",{className:"w-full lg:max-w-[450px] h-full",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 h-full overflow-y-auto space-y-6",children:[s.jsxs("div",{className:"space-y-3",children:[s.jsx(o,{className:"h-5 w-20"}),s.jsx(o,{className:"w-full h-48 rounded-lg border-2 border-dashed"}),s.jsx("div",{className:"flex gap-2",children:Array.from({length:3}).map((a,n)=>s.jsx(o,{className:"w-16 h-16 rounded"},n))})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{className:"h-4 w-16"}),s.jsx(o,{className:"h-10 w-full rounded"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{className:"h-4 w-12"}),s.jsx(o,{className:"h-10 w-full rounded"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{className:"h-4 w-20"}),s.jsx(o,{className:"h-24 w-full rounded"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{className:"h-4 w-16"}),s.jsx(o,{className:"h-10 w-full rounded"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{className:"h-4 w-20"}),s.jsx(o,{className:"h-10 w-full rounded"})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{className:"h-4 w-16"}),s.jsx(o,{className:"h-10 w-full rounded"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{className:"h-4 w-12"}),s.jsx(o,{className:"h-10 w-full rounded"})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{className:"h-4 w-12"}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(o,{className:"h-10 w-20 rounded"}),s.jsx(o,{className:"w-10 h-10 rounded-full"})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{className:"h-4 w-16"}),s.jsx(o,{className:"h-10 w-full rounded"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{className:"h-4 w-16"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:Array.from({length:4}).map((a,n)=>s.jsx(o,{className:"h-6 w-16 rounded-full"},n))})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx(o,{className:"h-4 w-32"}),s.jsx("div",{className:"space-y-2",children:Array.from({length:3}).map((a,n)=>s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(o,{className:"w-4 h-4 rounded"}),s.jsx(o,{className:"h-4 w-20"})]},n))})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{className:"h-4 w-20"}),s.jsx(o,{className:"h-10 w-full rounded"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{className:"h-4 w-16"}),s.jsx(o,{className:"h-10 w-full rounded"})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx(o,{className:"h-4 w-16"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(o,{className:"h-10 w-full rounded"}),s.jsx(o,{className:"h-10 w-full rounded"})]})]}),s.jsx("div",{className:"pt-4",children:s.jsx(o,{className:"h-12 w-full rounded"})})]})]})}),s.jsx("div",{className:"w-full lg:flex-1 hidden lg:block h-full",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 h-full overflow-y-auto",children:[s.jsx(o,{className:"h-6 w-32 mb-6"}),s.jsx(o,{className:"w-full h-64 rounded-lg mb-6"}),s.jsxs("div",{className:"space-y-4",children:[s.jsx(o,{className:"h-8 w-full"}),s.jsx(o,{className:"h-6 w-32"}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{className:"h-4 w-full"}),s.jsx(o,{className:"h-4 w-3/4"}),s.jsx(o,{className:"h-4 w-1/2"})]}),s.jsx("div",{className:"flex gap-2",children:Array.from({length:3}).map((a,n)=>s.jsx(o,{className:"h-6 w-16 rounded-full"},n))})]})]})})]})]}),Ue=V({color:p().trim().min(1,"Color is required").regex(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,"Please enter a valid HEX color code"),quantity:p().trim().refine(a=>a.length>0,"Quantity is required").regex(/^(0|[1-9]\d*)$/,"Quantity must be a whole number").refine(a=>{const n=parseInt(a);return!isNaN(n)&&n>=0},"Quantity must be at least 0"),outOfStock:F().optional(),price:p().trim().min(1,"Price is required").regex(/^\d+(\.\d{1,2})?$/,"Price must be a valid number").refine(a=>parseFloat(a)>0,"Price must be greater than 0"),discount:V({discountType:ne(["none","flat","percentage"]),discountValue:p().optional()}).refine(a=>a.discountType!=="none"?a.discountValue&&a.discountValue.trim().length>0:!0,{message:"Discount value is required when discount type is selected",path:["discountValue"]}).refine(a=>{if(a.discountType==="percentage"&&a.discountValue){const n=parseFloat(a.discountValue);return!isNaN(n)&&n>=0&&n<=100}return!0},{message:"Percentage discount must be between 0 and 100",path:["discountValue"]}).refine(a=>{if(a.discountType==="flat"&&a.discountValue){const n=parseFloat(a.discountValue);return!isNaN(n)&&n>=0}return!0},{message:"Flat discount must be a positive number",path:["discountValue"]})}),Ze=V({title:p().trim().min(3,"Title must be at least 3 characters").max(100,"Title must not exceed 100 characters"),price:p().trim().min(1,"Price is required").regex(/^\d+(\.\d{1,2})?$/,"Price must be a valid number with up to 2 decimal places").refine(a=>parseFloat(a)>0,"Price must be greater than 0").refine(a=>parseFloat(a)<=999999.99,"Price must not exceed 999,999.99"),description:p().trim().min(10,"Description must be at least 10 characters").max(2e3,"Description must not exceed 2000 characters"),category:p().trim().min(1,"Category is required").max(50,"Category must not exceed 50 characters"),subCategory:p().trim().min(1,"Sub category is required").max(50,"Sub category must not exceed 50 characters"),quantity:p().trim().refine(a=>a.length>0,"Quantity is required").regex(/^(0|[1-9]\d*)$/,"Quantity must be a whole number").refine(a=>{const n=parseInt(a);return!isNaN(n)&&n>=0},"Quantity must be at least 0").refine(a=>{const n=parseInt(a);return!isNaN(n)&&n<=99999},"Quantity must not exceed 99,999"),outOfStock:F().optional(),brand:p().trim().min(2,"Brand must be at least 2 characters").max(50,"Brand must not exceed 50 characters").regex(/^[a-zA-Z0-9\s\-&.]+$/,"Brand can only contain letters, numbers, spaces, hyphens, ampersands, and periods"),color:p().trim().min(1,"Color is required").regex(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,"Please enter a valid HEX color code (e.g., #FF0000)"),locationIds:W(p()).min(1,"At least one location is required").max(10,"Maximum 10 locations allowed"),productTag:W(p().trim().min(2,"Each tag must be at least 2 characters").max(30,"Each tag must not exceed 30 characters").regex(/^[a-zA-Z0-9\s\-#]+$/,"Tags can only contain letters, numbers, spaces, hyphens, and hashtags")).min(1,"At least one product tag is required").max(10,"Maximum 10 tags allowed"),variants:W(Ue).max(5,"Maximum 5 variants allowed").optional(),marketplaceOptions:V({pickup:F().optional(),shipping:F().optional(),delivery:F().optional()}).required().refine(a=>a.pickup||a.shipping||a.delivery,{message:"At least one marketplace option (Pickup, Shipping, or Delivery) must be selected"}),pickupHours:p().trim().optional(),shippingPrice:p().trim().optional(),readyByDays:p().optional(),dimensions:V({width:p().optional(),length:p().optional(),height:p().optional()}).optional(),discount:V({discountType:ne(["none","flat","percentage"]),discountValue:p().optional()}).refine(a=>a.discountType!=="none"?a.discountValue&&a.discountValue.trim().length>0:!0,{message:"Discount value is required when discount type is selected",path:["discountValue"]}).refine(a=>{if(a.discountType==="percentage"&&a.discountValue){const n=parseFloat(a.discountValue);return!isNaN(n)&&n>=0&&n<=100}return!0},{message:"Percentage discount must be between 0 and 100",path:["discountValue"]}).refine(a=>{if(a.discountType==="flat"&&a.discountValue){const n=parseFloat(a.discountValue);return!isNaN(n)&&n>=0}return!0},{message:"Flat discount must be a positive number",path:["discountValue"]})}).refine(a=>!(a.marketplaceOptions?.pickup&&!a.pickupHours?.trim()),{message:"Pickup hours are required when pickup option is selected",path:["pickupHours"]}).refine(a=>!(a.marketplaceOptions?.shipping&&!a.shippingPrice?.trim()),{message:"Shipping price is required when shipping option is selected",path:["shippingPrice"]}).refine(a=>{if(a.marketplaceOptions?.shipping&&a.shippingPrice?.trim()){if(!/^\d+(\.\d{1,2})?$/.test(a.shippingPrice))return!1;const g=parseFloat(a.shippingPrice);if(isNaN(g)||g<0)return!1}return!0},{message:"Shipping price must be a valid positive number",path:["shippingPrice"]}).superRefine((a,n)=>{a.marketplaceOptions?.pickup&&!a.pickupHours?.trim()&&n.addIssue({code:"custom",path:["pickupHours"],message:"Pickup hours are required when pickup option is selected"}),a.marketplaceOptions?.shipping&&(a.shippingPrice?.trim()?/^\d+(\.\d{1,2})?$/.test(a.shippingPrice)?parseFloat(a.shippingPrice)<0&&n.addIssue({code:"custom",path:["shippingPrice"],message:"Shipping price must be greater than or equal to 0"}):n.addIssue({code:"custom",path:["shippingPrice"],message:"Shipping price must be a valid number with up to 2 decimals"}):n.addIssue({code:"custom",path:["shippingPrice"],message:"Shipping price is required when shipping option is selected"}))}),H=[{value:"electronics",label:"Electronics"},{value:"clothing",label:"Clothing"},{value:"home",label:"Home & Garden"},{value:"sports",label:"Sports & Outdoors"},{value:"accessories",label:"Accessories"},{value:"commercial",label:"Commercial"},{value:"commercial doors",label:"Commercial Doors"}],k={electronics:[{value:"phones",label:"Phones"},{value:"laptops",label:"Laptops"},{value:"tablets",label:"Tablets"},{value:"headphones",label:"Headphones"},{value:"cameras",label:"Cameras"},{value:"accessories",label:"Accessories"}],clothing:[{value:"mens",label:"Men's Clothing"},{value:"womens",label:"Women's Clothing"},{value:"kids",label:"Kids' Clothing"},{value:"shoes",label:"Shoes"},{value:"accessories",label:"Accessories"}],home:[{value:"furniture",label:"Furniture"},{value:"decor",label:"Decor"},{value:"kitchen",label:"Kitchen"},{value:"bathroom",label:"Bathroom"},{value:"garden",label:"Garden"}],"home & garden":[{value:"furniture",label:"Furniture"},{value:"decor",label:"Decor"},{value:"kitchen",label:"Kitchen"},{value:"bathroom",label:"Bathroom"},{value:"garden",label:"Garden"}],sports:[{value:"fitness equipment",label:"Fitness Equipment"},{value:"outdoor gear",label:"Outdoor Gear"},{value:"sportswear",label:"Sportswear"},{value:"accessories",label:"Accessories"}],"sports & outdoors":[{value:"fitness equipment",label:"Fitness Equipment"},{value:"outdoor gear",label:"Outdoor Gear"},{value:"sportswear",label:"Sportswear"},{value:"accessories",label:"Accessories"}],accessories:[{value:"jewelry",label:"Jewelry"},{value:"bags",label:"Bags"},{value:"watches",label:"Watches"},{value:"belts",label:"Belts"},{value:"other",label:"Other"}],commercial:[{value:"equipment",label:"Equipment"},{value:"supplies",label:"Supplies"},{value:"furniture",label:"Furniture"},{value:"tools",label:"Tools"}],"commercial doors":[{value:"doors",label:"Doors"},{value:"windows",label:"Windows"},{value:"glass doors",label:"Glass Doors"},{value:"frames",label:"Frames"},{value:"hardware",label:"Hardware"}]},K=[{value:"casing",label:"Casing"},{value:"trim",label:"Trim"},{value:"molding",label:"Molding"},{value:"hardware",label:"Hardware"},{value:"doors",label:"Doors"},{value:"windows",label:"Windows"},{value:"glass",label:"Glass"},{value:"locks",label:"Locks"},{value:"hinges",label:"Hinges"},{value:"frames",label:"Frames"},{value:"panels",label:"Panels"},{value:"handles",label:"Handles"}],U=5;function ds(){const a=Ae(),{id:n}=Oe(),[g,D]=m.useState([]),[x,Z]=m.useState([]),[le,L]=m.useState(!1),[ce,N]=m.useState(!1),[h,C]=m.useState([]),[ue,I]=m.useState(!1),[de,_]=m.useState(null),[A,pe]=m.useState(!1),[O,J]=m.useState(!1),[Y,R]=m.useState(!1),[me,G]=m.useState(!1),{data:q,isLoading:ge}=ze(n||""),{data:E,refetch:he}=qe(),ee=Ee(),B=We(),P=Xe(),M=Array.isArray(E?.data)?E.data:E?.data?[E.data]:[],Q=M.map(e=>({value:e.id||e._id||"",label:`${e.name} , ${e.formattedAddress}`||""})),d=Be({resolver:Me(Ze),mode:"onChange",reValidateMode:"onChange",defaultValues:{title:"",price:"",description:"",category:"",subCategory:"",quantity:"",outOfStock:!1,brand:"",color:"#000000",locationIds:[],productTag:[],variants:[],marketplaceOptions:{pickup:!1,shipping:!1,delivery:!1},pickupHours:"",shippingPrice:"",readyByDays:"0",dimensions:{width:"",length:"",height:""},discount:{discountType:"none",discountValue:""}}}),{handleSubmit:fe,watch:ye,reset:se,setValue:S}=d,y=ye();let j=y.category?[...k[y.category]||k[y.category.toLowerCase()]||[]]:[];const v=y.subCategory;console.log("=== SubCategory Debug ==="),console.log("Current category:",y.category),console.log("Current subCategory value:",v),console.log("SubCategory options before adding current:",j),v&&j.length===0&&y.category?(j.push({value:v,label:v}),console.log("Added subcategory because no options available")):v&&!j.find(e=>e.value.toLowerCase()===v.toLowerCase())&&(j.push({value:v,label:v}),console.log("Added subcategory because not in options list")),console.log("Final subCategory options:",j),console.log("=== End SubCategory Debug ==="),m.useEffect(()=>{A&&v&&(console.log("Forcing subcategory update after initial load:",v),d.setValue("subCategory",v))},[A,v,d]),m.useEffect(()=>{if(A)if(y.category){const e=y.subCategory;!(k[y.category]||k[y.category.toLowerCase()]||[]).some(t=>t.value===e||t.value.toLowerCase()===e?.toLowerCase())&&e&&S("subCategory","")}else S("subCategory","")},[y.category,S,A]),m.useEffect(()=>{if(q?.data){const e=q.data;console.log("Product data:",e),console.log("Product category:",e.category),console.log("Product subCategory:",e.subCategory),e.images&&e.images.length>0&&Z(e.images);let u="",l="";if(e.readyByDate)try{const c=new Date(e.readyByDate);u=re(c,"yyyy-MM-dd"),l=re(c,"HH:mm")}catch(c){console.error("Error parsing date:",c)}let t=e.category||"",i=e.subCategory||"";if(t){const c=H.find(w=>w.value.toLowerCase()===t.toLowerCase());c?t=c.value:console.warn(`Category "${e.category}" not found in predefined options, keeping original value`)}if(t){const c=k[t]||k[t.toLowerCase()]||[];if(console.log(`Subcategory options for category "${t}":`,c),console.log(`Original subcategory value: "${i}"`),i)if(c.length>0){const w=c.find(Ie=>Ie.value.toLowerCase()===i.toLowerCase());w?(console.log(`Found matching subcategory: "${w.value}"`),i=w.value):console.warn(`SubCategory "${e.subCategory}" not found for category "${t}", keeping original value`)}else console.log(`No subcategory options available for category "${t}", keeping value: "${i}"`)}console.log("Final category value:",t),console.log("Final subcategory value:",i);const r={title:e.title||"",price:e.price?.toString()||"",description:e.description||"",category:t,subCategory:i,quantity:e.quantity?.toString()||"",outOfStock:e.outOfStock||!1,brand:e.brand||"",color:e.color||"#000000",locationIds:e.locationIds?.map(c=>typeof c=="string"?c:c._id||c.id)||[],productTag:e.productTag||[],variants:e.variants?.map(c=>({color:c.color,quantity:c.quantity?.toString()||"",price:c.price?.toString()||"",outOfStock:c.outOfStock||!1,discount:{discountType:c.discount?.discountType||"none",discountValue:c.discount?.discountValue?.toString()||""}}))||[],marketplaceOptions:{pickup:e.marketplaceOptions?.pickup||!1,shipping:e.marketplaceOptions?.shipping||!1,delivery:e.marketplaceOptions?.delivery||!1},pickupHours:e.pickupHours||"",shippingPrice:e.shippingPrice?.toString()||"",readyByDate:u,readyByTime:l,readyByDays:e.readyByDays?.toString()||"0",dimensions:{width:e.dimensions?.width?.toString()||"",length:e.dimensions?.length?.toString()||"",height:e.dimensions?.height?.toString()||""},discount:{discountType:e.discount?.discountType||"none",discountValue:e.discount?.discountValue?.toString()||""}};console.log("Form data being set:",r),console.log("Discount data:",r.discount),console.log("Setting subCategory to:",i);const $=(t?k[t]||k[t.toLowerCase()]||[]:[]).find(c=>c.value.toLowerCase()===i.toLowerCase()),T=$?$.value:i;r.subCategory=T,console.log("About to reset form with subCategory:",r.subCategory),se(r);const ae=d.getValues();console.log("Values immediately after reset:",ae),console.log("SubCategory after reset:",ae.subCategory),setTimeout(()=>{console.log("Setting form values after delay - category:",t,"subcategory:",T),console.log("Setting discount after delay:",r.discount),d.setValue("category",t),d.setValue("subCategory",T);const c=d.getValues();console.log("SubCategory after setValue:",c.subCategory),d.setValue("discount.discountType",r.discount.discountType),d.setValue("discount.discountValue",r.discount.discountValue),d.clearErrors(["category","subCategory","discount.discountType","discount.discountValue"]),setTimeout(()=>{d.trigger(["category","subCategory"])},50)},100),e.variants&&e.variants.length>0&&(I(!0),C(e.variants.map((c,w)=>({id:c.id||c._id||`variant-${w}-${Date.now()}`,images:[],existingImages:c.images||[]}))),setTimeout(()=>{e.variants?.forEach((c,w)=>{c.discount?.discountType&&(d.setValue(`variants.${w}.discount.discountType`,c.discount.discountType),d.setValue(`variants.${w}.discount.discountValue`,c.discount.discountValue?.toString()||""))})},150)),setTimeout(()=>{d.clearErrors();const c=d.getValues();console.log("Form values after reset:",c),d.trigger(),pe(!0)},200)}},[q,se,d]);const ve=m.useCallback(e=>{e.preventDefault(),e.stopPropagation(),e.type==="dragenter"||e.type==="dragover"?L(!0):e.type==="dragleave"&&L(!1)},[]),be=m.useCallback(async e=>{if(e.preventDefault(),e.stopPropagation(),L(!1),e.dataTransfer.files&&e.dataTransfer.files[0]){const u=Array.from(e.dataTransfer.files),l=x.length+g.length,{validFiles:t,errors:i}=await X(u,U,l);t.length>0&&(D(r=>[...r,...t]),N(!1)),i.forEach(r=>b.error(r))}},[g,x]),xe=async e=>{if(e.target.files){const u=Array.from(e.target.files),l=x.length+g.length,{validFiles:t,errors:i}=await X(u,U,l);t.length>0&&(D(r=>[...r,...t]),N(!1)),i.forEach(r=>b.error(r)),e.target.value=""}},we=e=>{D(u=>u.filter((l,t)=>t!==e))},je=e=>{Z(u=>u.filter((l,t)=>t!==e))},Ne=async e=>{if(x.length+g.length<2){N(!0),b.error("Please keep at least 2 product images"),window.scrollTo({top:0,behavior:"smooth"});return}N(!1);const l=h.map((i,r)=>({variant:i,originalIndex:r})).filter(({variant:i})=>i.images.length>0).map(({variant:i,originalIndex:r})=>({variantId:i.id,variantIndex:r,files:i.images})),t={title:e.title,price:parseFloat(e.price),description:e.description,category:e.category,subCategory:e.subCategory,quantity:parseInt(e.quantity),outOfStock:e.outOfStock,brand:e.brand,color:e.color,locationIds:e.locationIds,productTag:e.productTag,marketplaceOptions:e.marketplaceOptions,pickupHours:e.pickupHours,shippingPrice:e.shippingPrice?parseFloat(e.shippingPrice):void 0,readyByDays:e.readyByDays?parseInt(e.readyByDays):void 0,dimensions:e.dimensions&&(e.dimensions.width||e.dimensions.length||e.dimensions.height)?{width:e.dimensions.width?parseFloat(e.dimensions.width):void 0,length:e.dimensions.length?parseFloat(e.dimensions.length):void 0,height:e.dimensions.height?parseFloat(e.dimensions.height):void 0}:void 0,discount:{discountType:e.discount.discountType,discountValue:e.discount.discountValue?parseFloat(e.discount.discountValue):void 0},variants:e.variants?.map((i,r)=>{const f=h[r];return{color:i.color,quantity:parseInt(i.quantity),price:parseFloat(i.price),outOfStock:i.outOfStock,discount:{discountType:i.discount.discountType,discountValue:i.discount.discountValue?parseFloat(i.discount.discountValue):void 0},images:f?.existingImages||[]}}),imageFiles:g.length>0?g:void 0,existingImages:x,variantFiles:l.length>0?l:void 0};try{await B.mutateAsync({id:n,data:t}),a("/seller/products")}catch(i){console.error("Failed to update product:",i)}},te=async()=>{const e=d.getValues();if(!e.title||e.title.trim().length===0){b.error("Title is required to save as draft"),d.setFocus("title"),d.setError("title",{message:"Title is required to save as draft"});return}if(!e.category||e.category.trim().length===0){b.error("Category is required to save as draft"),d.setFocus("category"),d.setError("category",{message:"Category is required to save as draft"});return}if(!e.price||e.price.trim().length===0){b.error("Price is required to save as draft"),d.setFocus("price"),d.setError("price",{message:"Price is required to save as draft"});return}if(x.length+g.length<2){N(!0),b.error("At least 2 images are required to save as draft"),window.scrollTo({top:0,behavior:"smooth"});return}N(!1);const l=h.map((i,r)=>({variant:i,index:r})).filter(({variant:i})=>i.images.length>0).map(({variant:i,index:r})=>({variantId:i.id,variantIndex:r,files:i.images})),t={id:n,title:e.title,imageFiles:g.length>0?g:void 0,existingImages:x};e.price&&e.price.trim()&&(t.price=e.price),e.description&&e.description.trim()&&(t.description=e.description),e.category&&e.category.trim()&&(t.category=e.category),e.subCategory&&e.subCategory.trim()&&(t.subCategory=e.subCategory),e.quantity&&e.quantity.trim()&&(t.quantity=e.quantity),e.brand&&e.brand.trim()&&(t.brand=e.brand),e.color&&e.color.trim()&&(t.color=e.color),e.locationIds&&e.locationIds.length>0&&(t.locationIds=e.locationIds),e.productTag&&e.productTag.length>0&&(t.productTag=e.productTag),e.marketplaceOptions&&(e.marketplaceOptions.pickup||e.marketplaceOptions.shipping||e.marketplaceOptions.delivery)&&(t.marketplaceOptions=e.marketplaceOptions),e.pickupHours&&e.pickupHours.trim()&&(t.pickupHours=e.pickupHours),e.shippingPrice&&e.shippingPrice.trim()&&(t.shippingPrice=e.shippingPrice),e.readyByDays&&e.readyByDays.trim()&&(t.readyByDays=parseInt(e.readyByDays)),e.dimensions&&(e.dimensions.width||e.dimensions.length||e.dimensions.height)&&(t.dimensions={width:e.dimensions.width||"",length:e.dimensions.length||"",height:e.dimensions.height||""}),e.discount&&e.discount.discountType!=="none"&&e.discount.discountValue&&e.discount.discountValue.trim()&&(t.discount={discountType:e.discount.discountType,discountValue:e.discount.discountValue}),e.outOfStock!==void 0&&(t.outOfStock=e.outOfStock),e.variants&&e.variants.length>0&&(t.variants=e.variants.map(i=>({...i,outOfStock:i.outOfStock,discount:i.discount.discountType!=="none"&&i.discount.discountValue&&i.discount.discountValue.trim()?{discountType:i.discount.discountType,discountValue:i.discount.discountValue}:{discountType:"none",discountValue:""}}))),l.length>0&&(t.variantFiles=l);try{if(console.log("draftData",t),n){const i={...t,status:"draft",price:t.price?parseFloat(t.price):void 0,quantity:t.quantity?parseInt(t.quantity):void 0,outOfStock:t.outOfStock,shippingPrice:t.shippingPrice?parseFloat(t.shippingPrice):void 0,dimensions:t.dimensions?{width:t.dimensions.width?parseFloat(t.dimensions.width):void 0,length:t.dimensions.length?parseFloat(t.dimensions.length):void 0,height:t.dimensions.height?parseFloat(t.dimensions.height):void 0}:void 0,discount:t.discount?{discountType:t.discount.discountType,discountValue:t.discount.discountValue?parseFloat(t.discount.discountValue):void 0}:void 0,variants:t.variants?.map(r=>({color:r.color,quantity:parseInt(r.quantity||"0"),price:parseFloat(r.price||"0"),outOfStock:r.outOfStock,discount:{discountType:r.discount.discountType,discountValue:r.discount.discountValue?parseFloat(r.discount.discountValue):void 0}}))};delete i.id,await P.mutateAsync({id:n,...i})}else await P.mutateAsync(t);a("/seller/products")}catch(i){console.error("Failed to save draft:",i)}},Se=e=>{if(console.log("Form errors:",e),x.length+g.length<2){N(!0),b.error("Please keep at least 2 product images"),setTimeout(()=>{const t=document.getElementById("photos");if(t){const i=t.closest(".overflow-y-auto");if(i){const r=t.getBoundingClientRect(),f=i.getBoundingClientRect();i.scrollTop+=r.top-f.top-100}else t.scrollIntoView({behavior:"smooth",block:"start"})}},100);return}const l=Object.keys(e)[0];if(l){const t=e[l];t?.message&&b.error(t.message),setTimeout(()=>{const i=document.querySelector(`[name="${l}"]`);if(i){const r=i.closest(".overflow-y-auto");if(r){const f=i.getBoundingClientRect(),$=r.getBoundingClientRect(),T=r.scrollTop+f.top-$.top-100;r.scrollTo({top:T,behavior:"smooth"}),setTimeout(()=>{i.focus()},500)}else i.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{i.focus()},500)}},100)}},ke=async e=>{try{await ee.mutateAsync(e),await he(),R(!1)}catch(u){console.error("Failed to add address:",u),b.error("Failed to add address")}},Ce=()=>{if(h.length>=5){b.error("Maximum 5 variants allowed");return}const e={id:Date.now().toString(),images:[],existingImages:[]};C([...h,e]),I(!0);const u=h.length;S(`variants.${u}.color`,"#000000"),S(`variants.${u}.discount.discountType`,"none"),S(`variants.${u}.quantity`,""),S(`variants.${u}.price`,""),S(`variants.${u}.discount.discountValue`,"")},Ve=e=>{const u=h.findIndex(l=>l.id===e);C(h.filter(l=>l.id!==e)),u!==-1&&d.clearErrors(`variants.${u}`),h.length<=1&&I(!1)},z=m.useCallback(async(e,u)=>{const l=h.find(f=>f.id===e);if(!l)return;const t=5,{validFiles:i,errors:r}=await X(u,t,l.images.length);i.length>0&&C(h.map(f=>f.id===e?{...f,images:[...f.images,...i]}:f)),r.forEach(f=>b.error(f))},[h]),Pe=(e,u)=>{C(h.map(l=>l.id===e?{...l,images:l.images.filter((t,i)=>i!==u)}:l))},Te=(e,u)=>{C(h.map(l=>l.id===e?{...l,existingImages:l.existingImages?.filter((t,i)=>i!==u)||[]}:l))},Fe=m.useCallback((e,u)=>{e.preventDefault(),e.stopPropagation(),e.type==="dragenter"||e.type==="dragover"?_(u):e.type==="dragleave"&&_(null)},[]),De=m.useCallback((e,u)=>{if(e.preventDefault(),e.stopPropagation(),_(null),e.dataTransfer.files&&e.dataTransfer.files[0]){const l=Array.from(e.dataTransfer.files);z(u,l)}},[z]);return ge?s.jsx(Ke,{}):s.jsxs($e,{...d,children:[s.jsxs("div",{className:"h-screen bg-gray-50 fixed top-0 w-full z-50 left-0 flex flex-col",children:[s.jsx("div",{className:"bg-primary px-4 py-3",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[s.jsx("button",{onClick:()=>a(-1),className:"text-white hover:bg-white  hover:text-black p-1 rounded cursor-pointer",children:s.jsx(He,{className:"h-5 w-5 sm:h-6 sm:w-6"})}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-blue-100",children:"Marketplace"}),s.jsx("div",{className:"text-white text-sm sm:text-base font-medium",children:"Edit Product"})]})]}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsx(ie,{type:"button",onClick:()=>{q?.data?.status==="draft"?te():G(!0)},variant:"ghost",className:"text-white hover:bg-white border border-white h-[40px] sm:h-[48px] text-sm sm:text-base hover:text-primary px-3 sm:px-4",disabled:B.isPending||P.isPending,children:B.isPending||P.isPending?"Saving...":"Save Draft"})})]})}),s.jsx("div",{className:"lg:hidden fixed bottom-4 right-4 z-50",children:!O&&s.jsx(ie,{type:"button",onClick:()=>J(!O),className:"bg-primary text-white p-3 shadow-sm hover:bg-primary/90 rounded-sm flex gap-3 w-fit h-10",children:O?s.jsxs(s.Fragment,{children:[s.jsx("span",{children:"Hide Preview "})," ",s.jsx(Le,{className:"h-6 w-6"})]}):s.jsxs(s.Fragment,{children:[s.jsx("span",{children:"Show Preview "})," ",s.jsx(_e,{className:"h-6 w-6"})]})})}),O&&s.jsx("div",{className:"lg:hidden fixed inset-0 z-[100] bg-white overflow-y-auto",children:s.jsx("div",{className:"min-h-screen",children:s.jsx(oe,{handleBackClick:()=>J(!1),formValues:y,uploadedPhotos:g,existingImages:x,addressOptions:Q,savedAddresses:M,variants:h,categoryOptions:H,subCategoryOptions:j,tagOptions:K})})}),s.jsxs("form",{id:"product-form",onSubmit:fe(Ne,Se),className:"flex-1 flex flex-col lg:flex-row gap-4 p-4 mx-auto overflow-hidden min-h-0 w-full",children:[s.jsx("div",{className:"w-full lg:max-w-[450px] h-full",children:s.jsx(Qe,{methods:d,uploadedPhotos:g,setUploadedPhotos:D,existingImages:x,removeExistingImage:je,imageError:ce,setImageError:N,addressOptions:Q,showAddAddressModal:Y,setShowAddAddressModal:R,variants:h,showVariants:ue,setShowVariants:I,handleDrag:ve,handleDrop:be,handleFileChange:xe,removePhoto:we,addVariant:Ce,removeVariant:Ve,handleVariantImageUpload:z,removeVariantImage:Pe,removeExistingVariantImage:Te,handleVariantDrag:Fe,handleVariantDrop:De,dragActive:le,variantDragActive:de,MAX_IMAGES:U,categoryOptions:H,subCategoryOptions:j,tagOptions:K,isLoading:B.isPending})}),s.jsx("div",{className:"w-full lg:flex-1 hidden lg:block h-full",children:s.jsx(oe,{formValues:y,uploadedPhotos:g,existingImages:x,addressOptions:Q,savedAddresses:M,variants:h,categoryOptions:H,subCategoryOptions:j,tagOptions:K})})]})]}),s.jsx(Re,{isOpen:Y,onClose:()=>R(!1),onSubmit:ke,isSubmitting:ee.isPending,totalAddress:M.length!==0}),s.jsx(Ge,{isOpen:me,onClose:()=>G(!1),onConfirm:()=>{G(!1),te()},title:"Save as Draft?",description:s.jsxs("div",{className:"text-gray-600",children:[s.jsx("p",{className:"mb-2",children:"Saving this product as a draft will:"}),s.jsxs("ul",{className:"text-left list-disc list-inside space-y-1 text-sm",children:[s.jsx("li",{children:"Remove it from your active listings"}),s.jsx("li",{children:"Make it invisible to buyers"}),s.jsx("li",{children:"Allow you to edit and publish it later"})]}),s.jsx("p",{className:"mt-3 font-medium",children:"Are you sure you want to continue?"})]}),confirmText:"Yes, Save as Draft",cancelText:"Cancel",isLoading:P.isPending})]})}export{ds as default};
