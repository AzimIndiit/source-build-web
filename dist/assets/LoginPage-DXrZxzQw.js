import{u as U,n as B,r as o,o as q,p as M,j as e,D as G,q as O,s as H,t as K,v as $,F as _,w as C,x as u,y as R,R as J,z as V,B as S,A as b,E,_ as Q,G as W,H as k,I as D,J as F,K as Y,m as X,L as Z,N as ee}from"./index-BCiIUrXb.js";import{A as se}from"./AuthWrapper-zmeuqRTi.js";import{F as ae}from"./FormSelect-prL940lU.js";import"./index-BdQq_4o_.js";import"./badge-C6OOTzUs.js";const le=m=>{const i={role:b().min(1,"Account type is required")};return m==="driver"?E({...i,phone:F}):m==="seller"?E({...i,businessName:b().min(2,"Business name must be at least 2 characters").max(70).trim(),businessAddress:b().min(2,"Business address must be at least 2 characters").max(255).trim(),phone:F,cellPhone:F,einNumber:b().min(1,"EIN number is required"),salesTaxId:b().min(1,"Sales Tax ID is required"),localDelivery:Q(["yes","no"])}):E(i)};function re({isOpen:m,userId:i}){const n=U(),{setUser:I,setIsAuthenticated:g,checkAuth:A}=B(),[l,f]=o.useState(!1),[c,P]=o.useState(""),[y,h]=o.useState("no"),v=q({resolver:M(le(c)),defaultValues:{role:"",businessName:"",businessAddress:"",phone:"",cellPhone:"",einNumber:"",localDelivery:"no",salesTaxId:""}}),{handleSubmit:L,watch:p,setValue:d,reset:r}=v,N=p("role");o.useEffect(()=>{N&&(P(N),r({role:N,businessName:"",businessAddress:"",phone:"",cellPhone:"",einNumber:"",localDelivery:"no",salesTaxId:""}))},[N,r]),o.useEffect(()=>{const s=p(t=>{t.localDelivery&&h(t.localDelivery)});return()=>s.unsubscribe()},[p]);const z=async s=>{f(!0);try{let t={userId:i,role:s.role};s.role==="driver"?t.phone=s.phone.replace(/\D/g,""):s.role==="seller"&&(t={...t,businessName:s.businessName,businessAddress:s.businessAddress,phone:s.phone.replace(/\D/g,""),cellPhone:s.cellPhone?.replace(/\D/g,"")||"",einNumber:s.einNumber,localDelivery:s.localDelivery==="yes",salesTaxId:s.salesTaxId||""});const T=await W.post("/auth/complete-google-signup",t);if(T.data.status==="success"){const{tokens:x,user:a}=T.data.data;if(x&&(localStorage.setItem("access_token",x.accessToken||x.access_token),localStorage.setItem("refresh_token",x.refreshToken||x.refresh_token)),a){const w={id:a.id||a._id||"",email:a.email,displayName:a.displayName||`${a.firstName||""} ${a.lastName||""}`.trim()||a.email,role:a.role||s.role,isVerified:a.isVerified!==void 0?a.isVerified:!0,firstName:a.firstName||"",lastName:a.lastName||"",company:a.businessName||"",region:"",address:a.businessAddress||"",description:"",phone:a.phone||"",createdAt:a.createdAt||new Date().toISOString(),isVehicles:a.isVehicles,isLicense:a.isLicense};I(w),g(!0),localStorage.setItem("user",JSON.stringify(w)),k.invalidateQueries({queryKey:["user"]}),k.invalidateQueries({queryKey:["user-me"]})}else try{await A()}catch(w){console.error("Failed to fetch user profile:",w)}D.success("Account setup completed successfully!");const j=a||B.getState().user;s.role==="seller"||j?.role==="seller"?n("/seller/dashboard"):s.role==="driver"||j?.role==="driver"?j?.isVehicles?j?.isLicense?n("/driver/dashboard"):n("/driving-license"):n("/vehicle-information"):n("/")}}catch(t){console.error("Role selection error:",t),D.error(t.response?.data?.message||"Failed to complete signup. Please try again.")}finally{f(!1)}};return e.jsx(G,{open:m,onOpenChange:()=>{},children:e.jsxs(O,{className:"w-[95vw] max-w-[95vw] sm:max-w-[500px] md:max-w-[600px] bg-white max-h-[90vh] overflow-y-auto",onPointerDownOutside:s=>s.preventDefault(),onEscapeKeyDown:s=>s.preventDefault(),children:[e.jsxs(H,{children:[e.jsx(K,{children:"Select Your Account Type"}),e.jsx($,{children:"Please select your account type and provide the required information to continue."})]}),e.jsx(_,{...v,children:e.jsxs("form",{onSubmit:L(z),className:"space-y-3 sm:space-y-4 px-2 sm:px-0",children:[e.jsx(ae,{name:"role",label:"Account Type",disabled:l,placeholder:"Select account type",options:[{value:"seller",label:"Seller"}]}),c==="driver"&&e.jsx("div",{className:"space-y-4",children:e.jsx(C,{name:"phone",label:"Phone Number",placeholder:"(555) 123-4567",disabled:l})}),c==="seller"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(u,{name:"businessName",label:"Business Name",type:"text",placeholder:"Business Name",disabled:l,className:"text-base px-4 border-gray-300"}),e.jsx(u,{name:"businessAddress",label:"Business Address",type:"text",placeholder:"Address of sales for materials",disabled:l,className:"text-base px-4 border-gray-300"}),e.jsx(C,{name:"phone",label:"Business Phone",placeholder:"(123) 456-7890",disabled:l,className:"text-base px-4 border-gray-300"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsx(C,{name:"cellPhone",label:"Cell Phone",placeholder:"(123) 456-7890",disabled:l,className:"text-base px-4 border-gray-300"}),e.jsx(u,{name:"einNumber",label:"EIN Number",type:"text",placeholder:"EIN number",disabled:l,className:"text-base px-4 border-gray-300"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Local Delivery Shipping *"}),e.jsxs(J,{value:y,onValueChange:s=>{h(s),d("localDelivery",s)},className:"flex flex-row gap-6 sm:gap-8",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(V,{value:"yes",id:"delivery-yes",className:"h-5 w-5 sm:h-4 sm:w-4"}),e.jsx(R,{htmlFor:"delivery-yes",className:"font-normal cursor-pointer text-base sm:text-sm",children:"Yes"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(V,{value:"no",id:"delivery-no",className:"h-5 w-5 sm:h-4 sm:w-4"}),e.jsx(R,{htmlFor:"delivery-no",className:"font-normal cursor-pointer text-base sm:text-sm",children:"No"})]})]})]}),y==="no"&&e.jsx(u,{name:"salesTaxId",label:"Sales Tax ID / Resale Certificates",type:"text",placeholder:"Sales Tax ID/Resale Certificates",disabled:l,className:"text-base px-4 border-gray-300"})]}),e.jsx(S,{type:"submit",className:"w-full text-white hover:text-white",disabled:l||!c,children:l?"Processing...":"Continue"})]})})]})})}function de(){const m=U(),i=Y(),{login:n}=X(),[I,g]=o.useState(!1),[A,l]=o.useState(!1),[f,c]=o.useState(!1),[P,y]=o.useState(""),h=q({resolver:M(ee),defaultValues:{email:"",password:""}}),{handleSubmit:v}=h;o.useEffect(()=>{const r=new URLSearchParams(i.search).get("content");console.log("cont",r),r&&(y(r),c(!0))},[i.search]);const L=async d=>{g(!0);try{console.log("Login data:",d),console.log("Starting login process..."),await n(d.email,d.password),D.success("Login successful!")}catch(r){console.error("Login error:",r),D.error("Invalid email or password. Please try again.")}finally{g(!1)}},p=()=>{l(!0);const r="http://localhost:8081/api/v1/auth/google";window.location.href=r};return e.jsxs(se,{children:[e.jsx(re,{isOpen:f,userId:P,onClose:()=>c(!1)}),e.jsx(_,{...h,children:e.jsxs("form",{onSubmit:v(L),className:"space-y-6",children:[e.jsx(u,{name:"email",label:"Email",type:"email",placeholder:"Enter your email",className:" text-base px-4 border-gray-300"}),e.jsx(u,{name:"password",label:"Password",type:"password",placeholder:"Enter your password",className:"text-base px-4 border-gray-300"}),e.jsx(S,{type:"submit",className:"w-full  bg-primary   hover:bg-primary/80 text-white font-medium text-base",loading:I,children:"Login"}),e.jsx("div",{className:"text-center",children:e.jsx(Z,{to:"/auth/forgot-password",className:"text-primary hover:text-primary/80 font-medium",children:"Forgot Password?"})}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-4 bg-white text-gray-500",children:"OR"})})]}),e.jsxs(S,{type:"button",variant:"outline",className:"w-full  flex justify-center items-center  border-gray-300 font-medium text-base",onClick:p,disabled:A,children:[e.jsxs("svg",{className:"w-5 h-5 mr-2",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue With Google"]}),e.jsx(S,{type:"button",className:"w-full  flex justify-center items-center bg-green-600 hover:bg-green-700 text-white font-medium text-base",onClick:()=>m("/auth/signup"),children:"Create New Account"})]})})]})}export{de as default};
