import{j as e,aX as z,K as y,l as j,a3 as $,E as k,z as I,G as m,aY as b,u as D,g as U,aZ as Y,ae as _,r as W,B as C,L as H,X as p,Z as x,H as X,aO as Z}from"./index-CUSVstqU.js";import{L as G}from"./LazyImage-D5w62-6q.js";import{g as Q}from"./colorUtils-BjIcJb6R.js";import{E as J}from"./EmptyState-CH6fPGhV.js";import{C as V}from"./cartItemEmptyState-BRk6lG7v.js";import{T as F}from"./trash-2-BLdsFbCa.js";import{M as ee}from"./minus-Cdk7QGCs.js";const se=()=>{const t=[{label:"Home",href:"/"},{label:"Cart",isCurrentPage:!0}];return e.jsxs("div",{className:"px-4 sm:px-6 lg:px-8 animate-pulse",children:[e.jsx("div",{className:"",children:e.jsx(z,{items:t})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center gap-2 border-b pb-2 border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-8 w-16 bg-gray-200 rounded"}),e.jsx("div",{className:"h-6 w-20 bg-gray-200 rounded"})]}),e.jsx("div",{className:"h-10 w-24 bg-gray-200 rounded"})]}),e.jsx("div",{className:"space-y-4",children:[1,2,3].map(r=>e.jsx(y,{className:"p-4 sm:p-6 border-gray-200",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-24 h-24 sm:w-32 sm:h-32 bg-gray-200 rounded-lg"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"})]}),e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded"})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-6 w-20 bg-gray-200 rounded"}),e.jsx("div",{className:"h-6 w-16 bg-gray-200 rounded"})]}),e.jsxs("div",{className:"flex items-center bg-gray-100 rounded-lg",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-l-lg"}),e.jsx("div",{className:"px-4 py-2 w-12 bg-gray-200"}),e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-r-lg"})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-100",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"h-4 w-16 bg-gray-200 rounded"}),e.jsx("div",{className:"h-5 w-20 bg-gray-200 rounded"})]})})]})]})},r))})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(y,{className:"p-6 sticky top-4",children:[e.jsx("div",{className:"h-7 w-32 bg-gray-200 rounded mb-6"}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"h-5 w-16 bg-gray-200 rounded"}),e.jsx("div",{className:"h-5 w-20 bg-gray-200 rounded"})]}),e.jsx("div",{className:"border-t pt-3 border-gray-200",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"h-6 w-12 bg-gray-200 rounded"}),e.jsx("div",{className:"h-6 w-24 bg-gray-200 rounded"})]})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"h-4 w-20 bg-gray-200 rounded mb-2"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"flex-1 h-10 bg-gray-200 rounded-lg"}),e.jsx("div",{className:"w-16 h-10 bg-gray-200 rounded-lg"})]})]}),e.jsx("div",{className:"w-full h-12 bg-gray-200 rounded-lg"}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("div",{className:"h-3 w-48 bg-gray-200 rounded mx-auto"})})]})})]})]})},N="cart",P="cartCount",ae=()=>{const r=j(a=>a.user)?.role==="buyer";return $({queryKey:[N],queryFn:()=>b.getCart(),enabled:r,staleTime:5e3,refetchOnWindowFocus:r,refetchOnMount:r?"always":!1})},re=()=>{const r=j(a=>a.user)?.role==="buyer";return k({mutationFn:a=>r?b.updateCartItem(a):Promise.reject(new Error("Only buyers can update cart items")),onSuccess:a=>{m.setQueryData([N],a),m.invalidateQueries({queryKey:[P]})},onError:a=>{I.error(a.response?.data?.message||a.message||"Failed to update cart")}})},te=()=>{const r=j(a=>a.user)?.role==="buyer";return k({mutationFn:({productId:a,variantId:n})=>r?b.removeFromCart(a,n):Promise.reject(new Error("Only buyers can remove cart items")),onSuccess:a=>{m.setQueryData([N],a),m.invalidateQueries({queryKey:[P]})},onError:a=>{I.error(a.response?.data?.message||a.message||"Failed to remove item")}})},le=()=>{const r=j(a=>a.user)?.role==="buyer";return k({mutationFn:()=>r?b.clearCart():Promise.reject(new Error("Only buyers can clear cart")),onSuccess:a=>{m.setQueryData([N],a),m.invalidateQueries({queryKey:[P]})},onError:a=>{I.error(a.response?.data?.message||a.message||"Failed to clear cart")}})},xe=()=>{const t=D(),{user:r}=U(),a=Y(s=>s.syncWithAPI),[n,S]=_.useState(null),{data:g,isLoading:v,isFetching:f}=ae(),R=re(),w=te(),E=le();W.useEffect(()=>{g&&!v&&!f&&a(g,"replace")},[g,v,f,a]);const h=g?.items||[],q=h.reduce((s,c)=>s+(c.currentPrice??0)*c.quantity,0),B=q,T=[{label:"Home",href:"/"},{label:"Cart",isCurrentPage:!0}],O=(s,c)=>{const u=c?s.quantity+1:s.quantity-1;if(u<1)return;const d=`${s.productId}${s.variantId?`-${s.variantId}`:""}`;S(d),R.mutate({productId:s.productId,variantId:s.variantId,quantity:u},{onSettled:()=>{S(null)}})},A=s=>{w.mutate({productId:s.productId,variantId:s.variantId})},K=()=>{E.mutate()},L=()=>{r?t("/checkout"):t("/auth/login",{state:{from:{pathname:"/checkout"}}})};return v||f?e.jsx(se,{}):h.length===0?e.jsx("div",{className:"min-h-[calc(100vh-140px))] flex items-center justify-center",children:e.jsx(J,{title:"Your cart is empty",description:"Looks like you haven't added anything to your cart yet. Start shopping to find amazing products!",icon:e.jsx("img",{src:V,alt:"Cart empty",className:"h-64 w-auto"}),action:{label:"Continue Shopping",onClick:()=>t("/marketplace")},className:"min-h-[600px]"})}):e.jsxs("div",{className:"px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"",children:e.jsx(z,{items:T})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center gap-2 border-b pb-2 border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Cart"}),"("," ",e.jsxs("span",{className:"text-lg text-gray-600",children:[h.length," items"]}),")"]}),e.jsx("div",{className:"",children:e.jsx(C,{leftIcon:F,variant:"outline",onClick:K,disabled:E.isPending,className:"text-red-600 bg-white h-10 hover:text-red-700 border-red-200 hover:border-red-300",children:"Clear Cart"})})]}),e.jsx("div",{className:"space-y-4",children:h.map(s=>{const c=s.currentPrice??0,u=s.originalPrice??0,d=s.outOfStock===!0,l=s.isDeleted===!0,i=`${s.productId}${s.variantId?`-${s.variantId}`:""}`;return e.jsx(y,{className:"p-4 sm:p-6 border-gray-200",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(G,{src:s.product?.images?.[0]||"",alt:s.product?.title||"Product",className:"rounded-lg",wrapperClassName:"w-24 h-24 sm:w-32 sm:h-32 rounded-lg overflow-hidden bg-gray-100",fallbackSrc:"https://placehold.co/150x150",objectFit:"cover"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(H,{to:l?"#":`/products/${s.product?.slug||""}`,className:p("text-lg font-semibold transition-colors line-clamp-2",l?"text-gray-400 cursor-not-allowed":"text-gray-900 hover:text-primary"),onClick:l?o=>o.preventDefault():void 0,children:s.product?.title||"Unknown Product"}),l&&e.jsx("span",{className:"inline-block px-2 py-1 text-xs font-medium text-red-600 bg-red-100 rounded mt-1",children:"Product no longer available"}),!l&&d&&e.jsx("span",{className:"inline-block px-2 py-1 text-xs font-medium text-orange-600 bg-orange-100 rounded mt-1",children:"Out of stock"}),s.product?.color&&e.jsx("div",{className:"flex items-center gap-3 mt-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Color:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-5 h-5 rounded-full border-2 border-gray-300",style:{backgroundColor:s.product.color},title:Q(s.product.color).name}),e.jsx("span",{className:"text-sm text-gray-700 capitalize",children:Q(s.product.color).name})]})]})}),s.product?.size&&e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[e.jsx("span",{children:"Size:"})," ",e.jsx("span",{className:"font-medium",children:s.product.size})]}),s.product?.attributes&&Object.keys(s.product.attributes).length>0&&e.jsx("div",{className:"flex flex-wrap gap-3 mt-1",children:Object.entries(s.product.attributes).map(([o,M])=>o==="color"||o==="size"?null:e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("span",{className:"capitalize",children:[o,":"]})," ",e.jsx("span",{className:"font-medium",children:M})]},o))}),s.product?.brand&&e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Brand: ",s.product.brand]})]}),e.jsx("button",{onClick:()=>A(s),disabled:w.isPending,className:p("text-red-500 hover:text-red-600 transition-colors p-1 cursor-pointer",w.isPending&&"opacity-50 cursor-not-allowed"),"aria-label":"Remove item",children:e.jsx(F,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[u>c&&e.jsx("span",{className:"text-base line-through text-gray-400",children:x(u)}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-xl font-bold text-primary",children:x(c)}),e.jsx("span",{className:"text-sm text-gray-500",children:"/ each"})]})]}),e.jsxs("div",{className:"flex items-center bg-gray-100 rounded-lg",children:[e.jsx("button",{onClick:()=>O(s,!1),disabled:s.quantity<=1||n===i||d||l,className:p("p-2 hover:bg-gray-200 transition-colors rounded-l-lg cursor-pointer",(s.quantity<=1||n===i||d||l)&&"opacity-50 cursor-not-allowed"),children:e.jsx(ee,{className:"h-5 w-5 text-gray-600"})}),e.jsx("span",{className:"px-4 py-2 text-sm font-semibold min-w-[50px] text-center flex items-center justify-center",children:n===i?e.jsx(X,{className:"h-4 w-4 text-gray-600 animate-spin"}):s.quantity}),e.jsx("button",{onClick:()=>O(s,!0),disabled:s.quantity>=(s.stockQuantity??99)||n===i||d||l,className:p("p-2 hover:bg-gray-200 transition-colors rounded-r-lg cursor-pointer",(s.quantity>=(s.stockQuantity??99)||n===i||d||l)&&"opacity-50 cursor-not-allowed"),children:e.jsx(Z,{className:"h-4 w-4 text-gray-600"})})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-100",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Subtotal"}),e.jsx("span",{className:"text-lg font-semibold text-gray-900",children:x(c*s.quantity)})]})})]})]})},i)})})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(y,{className:"p-6 sticky top-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:"Order Summary"}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{className:"font-medium",children:x(q)})]}),e.jsx("div",{className:"border-t pt-3 border-gray-200",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-lg font-bold text-gray-900",children:"Total"}),e.jsx("span",{className:"text-lg font-bold text-primary",children:x(B)})]})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Promo Code"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"Enter code",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"}),e.jsx(C,{variant:"outline",className:"px-4",children:"Apply"})]})]}),e.jsx(C,{onClick:L,className:"w-full bg-primary hover:bg-primary/90 text-white font-semibold py-3 text-base",children:"Proceed to Checkout"}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("p",{className:"text-xs text-gray-500",children:"ðŸ”’ Secure checkout powered by Stripe"})})]})})]})]})};export{xe as default};
