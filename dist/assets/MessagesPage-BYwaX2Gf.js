import{j as e,h as C,aa as T,ab as X,ac as A,br as L,S as y,m as _,u as O,r as M,bs as k}from"./index-BCiIUrXb.js";import{B as U}from"./badge-C6OOTzUs.js";import{c as E,u as z}from"./useSocket-CZCdR09R.js";import{t as p,n as S,a as b,g as F,e as R,d as w,f as D}from"./en-US-BQ62IwJd.js";import{e as Y,d as H}from"./endOfMonth-ropScTyq.js";function v(s,t){const r=+p(s)-+p(t);return r<0?-1:r>0?1:r}function P(s){return t=>{const o=(s?Math[s]:Math.trunc)(t);return o===0?0:o}}function B(s,t){return+p(s)-+p(t)}function $(s,t){const r=p(s,t?.in);return r.setHours(23,59,59,999),r}function Q(s,t){const r=p(s,t?.in);return+$(r,t)==+Y(r,t)}function q(s,t,r){const[o,a,d]=S(r?.in,s,s,t),u=v(a,d),n=Math.abs(H(a,d));if(n<1)return 0;a.getMonth()===1&&a.getDate()>27&&a.setDate(30),a.setMonth(a.getMonth()-u*n);let h=v(a,d)===-u;Q(o)&&n===1&&v(o,d)===1&&(h=!1);const x=u*(n-+h);return x===0?0:x}function G(s,t,r){const o=B(s,t)/1e3;return P(r?.roundingMethod)(o)}function J(s,t,r){const o=F(),a=r?.locale??o.locale??R,d=2520,u=v(s,t);if(isNaN(u))throw new RangeError("Invalid time value");const n=Object.assign({},r,{addSuffix:r?.addSuffix,comparison:u}),[h,x]=S(r?.in,...u>0?[t,s]:[s,t]),m=G(x,h),N=(b(x)-b(h))/1e3,i=Math.round((m-N)/60);let c;if(i<2)return r?.includeSeconds?m<5?a.formatDistance("lessThanXSeconds",5,n):m<10?a.formatDistance("lessThanXSeconds",10,n):m<20?a.formatDistance("lessThanXSeconds",20,n):m<40?a.formatDistance("halfAMinute",0,n):m<60?a.formatDistance("lessThanXMinutes",1,n):a.formatDistance("xMinutes",1,n):i===0?a.formatDistance("lessThanXMinutes",1,n):a.formatDistance("xMinutes",i,n);if(i<45)return a.formatDistance("xMinutes",i,n);if(i<90)return a.formatDistance("aboutXHours",1,n);if(i<w){const l=Math.round(i/60);return a.formatDistance("aboutXHours",l,n)}else{if(i<d)return a.formatDistance("xDays",1,n);if(i<D){const l=Math.round(i/w);return a.formatDistance("xDays",l,n)}else if(i<D*2)return c=Math.round(i/D),a.formatDistance("aboutXMonths",c,n)}if(c=q(x,h),c<12){const l=Math.round(i/D);return a.formatDistance("xMonths",l,n)}else{const l=c%12,f=Math.trunc(c/12);return l<3?a.formatDistance("aboutXYears",f,n):l<9?a.formatDistance("overXYears",f,n):a.formatDistance("almostXYears",f+1,n)}}function K(s,t){return J(s,E(s),t)}const V=({id:s,displayName:t,avatar:r,lastMessage:o,timestamp:a,unreadCount:d=0,onClick:u})=>e.jsxs(C,{onClick:u,className:"relative p-2 bg-white border-gray-200 cursor-pointer hover:bg-gray-50 transition-colors  justify-center",children:[d>0&&e.jsx("div",{className:"absolute bottom-1 right-1",children:e.jsx(U,{className:"h-6 w-6 rounded-full p-0 flex items-center justify-center bg-red-500 hover:bg-red-500 text-white",children:d>9?"9+":d})}),e.jsxs("div",{className:"flex  gap-3 items-stretch",children:[e.jsxs(T,{className:"h-16 w-16",children:[e.jsx(X,{src:r||"",alt:t}),e.jsx(A,{className:"bg-gray-200 text-gray-700 font-semibold text-xl",children:e.jsx("div",{className:"mt-1",children:L(t||"U")})})]}),e.jsxs("div",{className:"flex-1 min-w-0 py-2 flex flex-col justify-center my-auto",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("h6",{className:"font-semibold text-gray-900 capitalize truncate",children:t}),e.jsx("span",{className:"text-sm text-gray-500 ml-2 whitespace-nowrap",children:a})]}),e.jsx("p",{className:"text-gray-600 text-sm line-clamp-2",children:o})]})]})]},s),W=()=>e.jsx("div",{className:"py-4 md:p-6 space-y-6",children:e.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((s,t)=>e.jsxs("div",{className:"flex items-center space-x-4 p-4 rounded-lg",children:[e.jsx(y,{className:"w-12 h-12 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(y,{className:"h-4 w-32"}),e.jsx(y,{className:"h-3 w-16"})]}),e.jsx(y,{className:"h-3 w-3/4"})]}),e.jsx(y,{className:"w-6 h-6 rounded-full"})]},t))})}),Z=()=>{const{user:s}=_(),{on:t}=z(),r=O(),[o,a]=M.useState(1),[d,u]=M.useState(10),{data:n,isLoading:h,error:x}=k({page:o,limit:d}),[m,N]=M.useState([]);return M.useEffect(()=>{n?.data&&N(n.data)},[n]),M.useEffect(()=>{const c=t("update_unread_count",l=>{N(f=>{const j=f.findIndex(g=>g.id===l.id);if(j!==-1){const g=[...f];return g[j]={...g[j],...l},g}return f})});return()=>{c()}},[t]),e.jsxs("div",{className:"py-4 md:p-6 space-y-6",children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-gray-900",children:"Messages"}),e.jsx("div",{className:"space-y-3",children:m?.length>0?m?.map(i=>{const c=i?.lastMessage,l=c?.messageType==="text"?c.content:c?.messageType==="file"||c?.messageType==="mix"?"Sent a file":"",f=i?.participants?.find(I=>I?.id!==s?.id),j=c?.sentAt?K(new Date(c.sentAt),{addSuffix:!0}):"",g=s?.id&&i.unreadCounts&&i.unreadCounts[s.id]||0;return e.jsx(V,{id:i.id||"",displayName:f?.displayName||"Unknown User",avatar:f?.avatar,lastMessage:l,timestamp:j,unreadCount:g,onClick:()=>r(`/${s?.role}/messages/${i._id}`,{state:i})},i.id)}):h?e.jsx(W,{}):x?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("p",{className:"text-red-500",children:"Failed to load messages. Please try again."})}):e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("p",{className:"text-gray-500",children:"No Messages Found"})})})]})};function re(){return e.jsx(Z,{})}export{re as default};
