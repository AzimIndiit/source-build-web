import{G as g,a2 as I,aj as P,Z as v,I as c,H as f}from"./index-BCiIUrXb.js";class h{async createProduct(r){return(await g.post("/products",r)).data}async saveDraft(r){return(await g.post("/products/draft",r)).data}async updateDraft(r,s){return(await g.patch(`/products/${r}`,{...s,status:"draft"})).data}async updateProduct(r,s){return(await g.patch(`/products/${r}`,s)).data}async getProducts(r){return(await g.get("/products",{params:r})).data}async getProductBySlug(r){return console.log("slug",r),(await g.get(`/products/${r}`)).data}async getProductById(r){return(await g.get(`/products/id/${r}`)).data}async deleteProduct(r){return(await g.delete(`/products/${r}`)).data}async uploadProductImages(r){const s=r.map(m=>I.uploadFile(m));return(await Promise.all(s)).map(m=>m.data.url)}}const u=new h,F=["products"],w=e=>["product",e];function q(){return v({mutationFn:async e=>{let r=[];e.imageFiles&&e.imageFiles.length>0&&(r=await Promise.all(e.imageFiles.map(t=>u.uploadProductImages([t]).then(n=>n[0]).catch(n=>{throw console.error("Failed to upload product image:",n),c.error("Failed to upload product image"),n}))));let s=e.variants;if(e.variantFiles&&e.variantFiles.length>0&&s){const t=new Map;for(const n of e.variantFiles)if(n.files.length>0)try{console.log("Uploading images for variant at index:",n.variantIndex);const a=await u.uploadProductImages(n.files);t.set(n.variantIndex,a)}catch(a){throw console.error("Failed to upload variant images:",a),c.error("Failed to upload variant images"),a}s=s.map((n,a)=>{const i=t.get(a);return i?(console.log(`Adding ${i.length} images to variant at index ${a}`),{...n,images:i}):n})}const{imageFiles:d,variantFiles:m,...l}=e,y={...l,price:Number(l.price),quantity:Number(l.quantity),shippingPrice:l.shippingPrice?Number(l.shippingPrice):void 0,discount:{...l.discount,discountValue:l.discount.discountValue?Number(l.discount.discountValue):void 0},variants:s?.map(t=>({...t,price:Number(t.price),quantity:Number(t.quantity),discount:{...t.discount,discountValue:t.discount.discountValue?Number(t.discount.discountValue):void 0}})),images:r};return await u.createProduct(y)},onSuccess:e=>{f.invalidateQueries({queryKey:F}),c.success(e.message||"Product created successfully")},onError:e=>{const r=e.response?.data?.message||"Failed to create product";c.error(r),console.error("Create product error:",e)}})}function N(){return v({mutationFn:async({id:e,data:r})=>{let s=r.existingImages||[];if(r.imageFiles&&r.imageFiles.length>0)try{const a=await u.uploadProductImages(r.imageFiles);s=[...s,...a]}catch(a){throw console.error("Failed to upload product images:",a),c.error("Failed to upload product images"),a}let d=r.variants;if(r.variantFiles&&r.variantFiles.length>0&&d){const a=new Map;for(const i of r.variantFiles)if(i.files.length>0)try{const o=await u.uploadProductImages(i.files);i.variantIndex!==void 0?a.set(i.variantIndex,o):d=d.map(p=>p.color===i.variantId?{...p,images:[...p.images||[],...o]}:p)}catch(o){throw console.error("Failed to upload variant images:",o),c.error("Failed to upload variant images"),o}a.size>0&&(d=d.map((i,o)=>{const p=a.get(o);return p?{...i,images:[...i.images||[],...p]}:i}))}const{imageFiles:m,variantFiles:l,existingImages:y,...t}=r,n={...t,price:t.price?Number(t.price):void 0,quantity:t.quantity?Number(t.quantity):void 0,shippingPrice:t.shippingPrice?Number(t.shippingPrice):void 0,discount:t.discount?{...t.discount,discountValue:t.discount.discountValue?Number(t.discount.discountValue):void 0}:void 0,variants:d?.map(a=>({...a,price:Number(a.price),quantity:Number(a.quantity),discount:{...a.discount,discountValue:a.discount.discountValue?Number(a.discount.discountValue):void 0}})),images:s};return await u.updateProduct(e,n)},onSuccess:e=>{f.invalidateQueries({queryKey:F}),f.invalidateQueries({queryKey:["product"]}),c.success(e.message||"Product updated successfully")},onError:e=>{const r=e.response?.data?.message||"Failed to update product";c.error(r),console.error("Update product error:",e)}})}function V(){return v({mutationFn:async e=>{let r=e.existingImages||[];if(e.imageFiles&&e.imageFiles.length>0){const a=await Promise.all(e.imageFiles.map(i=>u.uploadProductImages([i]).then(o=>o[0]).catch(o=>{throw console.error("Failed to upload product image:",o),c.error("Failed to upload product image"),o})));r=[...r,...a]}let s=e.variants;if(e.variantFiles&&e.variantFiles.length>0&&s){const a=new Map;for(const i of e.variantFiles)if(i.files.length>0)try{const o=await u.uploadProductImages(i.files);a.set(i.variantIndex,o)}catch(o){console.error("Failed to upload variant images:",o)}s=s.map((i,o)=>{const p=a.get(o);return p?{...i,images:p}:i})}const{imageFiles:d,variantFiles:m,existingImages:l,id:y,...t}=e,n={title:t.title,images:r,isDraft:!0,...t.price&&{price:Number(t.price)},...t.description&&{description:t.description},...t.category&&{category:t.category},...t.subCategory&&{subCategory:t.subCategory},...t.quantity&&{quantity:Number(t.quantity)},...t.brand&&{brand:t.brand},...t.color&&{color:t.color},...t.locationIds&&{locationIds:t.locationIds},...t.productTag&&{productTag:t.productTag},...t.marketplaceOptions&&{marketplaceOptions:t.marketplaceOptions},...t.pickupHours&&{pickupHours:t.pickupHours},...t.shippingPrice&&{shippingPrice:Number(t.shippingPrice)},...t.readyByDate&&{readyByDate:t.readyByDate},...t.readyByTime&&{readyByTime:t.readyByTime},...t.discount&&{discount:{...t.discount,discountValue:t.discount.discountValue?Number(t.discount.discountValue):void 0}},...s&&{variants:s.map(a=>({...a,price:Number(a.price),quantity:Number(a.quantity),discount:{...a.discount,discountValue:a.discount.discountValue?Number(a.discount.discountValue):void 0}}))}};return y?await u.updateDraft(y,n):await u.saveDraft(n)},onSuccess:e=>{f.invalidateQueries({queryKey:F}),c.success(e.message||"Draft saved successfully")},onError:e=>{const r=e.response?.data?.message||"Failed to save draft";c.error(r),console.error("Save draft error:",e)}})}function D(){return v({mutationFn:e=>u.deleteProduct(e),onSuccess:e=>{f.invalidateQueries({queryKey:F}),c.success(e.message||"Product deleted successfully")},onError:e=>{const r=e.response?.data?.message||"Failed to delete product";c.error(r),console.error("Delete product error:",e)}})}function x(e){return P({queryKey:[...F,e],queryFn:()=>u.getProducts(e),staleTime:300*1e3,gcTime:600*1e3})}function U(e){return console.log("slug-1",e),P({queryKey:w(e),queryFn:()=>u.getProductBySlug(e),enabled:!!e,staleTime:300*1e3,gcTime:600*1e3})}function B(e){return P({queryKey:["product","id",e],queryFn:()=>u.getProductById(e),enabled:!!e,staleTime:300*1e3,gcTime:600*1e3})}export{D as a,q as b,V as c,U as d,B as e,N as f,x as u};
