import{c as L,r as p,j as e,h as v,ae as Z,i as D,y as H,af as z,B as T,o as Y,p as G,E as Q,ag as V,D as J,q as ee,s as ae,t as se,F as te,x as w,O as ne,ah as ce,ai as E,_ as oe,A as k,S as i,G as g,aj as re,Z as S,I as x,H as b,ak as le,al as ue,am as de}from"./index-BCiIUrXb.js";import{T as ie}from"./trash-2-Ct1NlBzh.js";import{F as me}from"./FormSelect-prL940lU.js";import"./index-BdQq_4o_.js";import"./badge-C6OOTzUs.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],he=L("credit-card",xe),fe=({id:s,accountHolder:a,accountNumber:n,bankName:t,onEdit:r,onDelete:l,onToggleDefault:o,className:d,isDefault:y})=>{const[N,f]=p.useState(!1),j=async h=>{if(!N&&h&&o){f(!0);try{await o(s,h)}catch(m){console.error("Failed to update default status:",m)}finally{f(!1)}}};return e.jsx(v,{className:Z("bg-gray-50 border-gray-200 shadow-sm hover:shadow-md transition-shadow relative h-[180px] flex flex-col ",d),children:e.jsxs(D,{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-base sm:text-lg line-clamp-1",children:a}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{htmlFor:`default-${n}`,className:"text-xs text-gray-600",children:"Default"}),e.jsx(z,{id:`default-${n}`,checked:y||!1,onCheckedChange:j,className:`h-6 w-12  transition-all duration-200 ${(N||y)&&"data-[state=checked]:bg-green-500"}`})]})]}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("p",{className:"text-gray-600 text-sm font-mono tracking-wider",children:n}),e.jsx("p",{className:"text-gray-700 text-sm",children:t})]}),e.jsx("div",{className:"flex gap-2 justify-end mt-auto pt-3",children:e.jsx(T,{title:"Delete",variant:"ghost",size:"icon",onClick:l,className:"w-8 h-8 hover:bg-red-50 text-red-600 hover:text-red-700 rounded-md",children:e.jsx(ie,{className:"w-4 h-4"})})})]})})},A=[{label:"Checking",value:"checking"},{label:"Savings",value:"savings"},{label:"Current",value:"current"}],ge=Q({accountHolderName:k().trim().min(1,"Account holder name is required").min(2,"Account holder name must be at least 2 characters").max(70,"Account holder name must not exceed 70 characters"),bankName:k().trim().min(1,"Bank name is required").min(2,"Bank name must be at least 2 characters").max(100,"Bank name must not exceed 100 characters"),accountNumber:k().trim().min(1,"Account number is required").regex(/^[0-9]+$/,"Account number must contain only digits").min(8,"Account number must be at least 8 digits").max(20,"Account number must not exceed 20 digits"),routingNumber:k().trim().min(1,"Routing number is required").regex(/^[0-9]+$/,"Routing number must contain only digits").min(9,"Routing number must be 9 digits").max(9,"Routing number must be 9 digits"),swiftCode:k().trim().min(1,"SWIFT/BIC code is required").regex(/^[A-Z]{6}[A-Z0-9]{2}([A-Z0-9]{3})?$/,"Invalid SWIFT/BIC code format").max(11,"SWIFT/BIC code must not exceed 11 characters"),accountType:oe(["checking","savings","current"]),isDefault:E().optional()}),pe=Q({isDefault:E().optional()}),be=({isOpen:s,onClose:a,onSubmit:n,initialData:t,isEdit:r=!1,totalBankAccount:l,isSubmitting:o=!1})=>{const d=Y({resolver:G(r?pe:ge),defaultValues:t?{accountHolderName:t.accountHolderName||"",bankName:t.bankName||"",accountNumber:t.accountNumber||"",routingNumber:t.routingNumber||"",swiftCode:t.swiftCode||"",accountType:t.accountType||A[0].value,isDefault:t.isDefault??!1}:{accountHolderName:"",bankName:"",accountNumber:"",routingNumber:"",swiftCode:"",accountType:A[0].value,isDefault:!l}});V.useEffect(()=>{s?t&&d.reset({accountHolderName:t.accountHolderName||"",bankName:t.bankName||"",accountNumber:t.accountNumber||"",routingNumber:t.routingNumber||"",swiftCode:t.swiftCode||"",accountType:t.accountType||A[0].value,isDefault:t.isDefault??!1}):d.reset({accountHolderName:"",bankName:"",accountNumber:"",routingNumber:"",swiftCode:"",accountType:A[0].value,isDefault:!l})},[t,s,d,l]);const{handleSubmit:y,reset:N,control:f}=d,j=async m=>{await n(m)},h=()=>{o||N(),a()};return e.jsx(J,{open:s,onOpenChange:h,children:e.jsxs(ee,{className:"max-w-[90vw] sm:max-w-[600px] md:max-w-[700px] p-0 bg-white max-h-[90vh] overflow-y-auto",children:[e.jsx(ae,{className:"px-4 pt-4 sm:px-6 pb-0 mb-0",children:e.jsx(se,{className:"text-lg sm:text-xl font-semibold",children:r?"Manage Account":"Add New Account"})}),e.jsx(te,{...d,children:e.jsxs("form",{onSubmit:y(j),className:"p-4 sm:p-6 space-y-4 sm:space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4",children:[e.jsx(w,{disabled:r||o,name:"accountHolderName",label:"Account Holder Name",placeholder:"Enter Account Holder Name"}),e.jsx(w,{name:"bankName",label:"Bank Name",disabled:r||o,placeholder:"Enter Bank Name"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4",children:[e.jsx(w,{disabled:r||o,name:"accountNumber",label:"Bank Account Number",placeholder:"Enter Bank Account Number"}),e.jsx(w,{disabled:r||o,name:"routingNumber",label:"Routing Number",placeholder:"Enter Routing Number"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4",children:[e.jsx(w,{disabled:r||o,name:"swiftCode",label:"SWIFT/BIC Code",placeholder:"Enter SWIFT Code"}),e.jsx(me,{disabled:r||o,name:"accountType",label:"Account Type",options:A})]}),l&&e.jsx(ne,{name:"isDefault",control:f,render:({field:m})=>e.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[e.jsx(ce,{id:"isDefault",checked:m.value,disabled:o,onCheckedChange:m.onChange,className:"border-gray-300"}),e.jsx(H,{htmlFor:"isDefault",className:"text-sm font-normal text-gray-600 cursor-pointer",children:"Save as default"})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 pt-3 sm:pt-4 sm:justify-end",children:[e.jsx(T,{type:"button",variant:"outline",onClick:h,className:"w-full sm:w-[200px] md:w-[224px] border-gray-300 text-gray-700 hover:bg-gray-50 text-sm sm:text-base",disabled:o,children:"Cancel"}),e.jsx(T,{type:"submit",className:"w-full sm:w-[200px] md:w-[224px] bg-primary text-white hover:bg-primary/90 text-sm sm:text-base",disabled:o,children:o?"Saving...":r?"Update Account":"Add Account"})]})]})})]})})},ye=()=>e.jsx(v,{className:"bg-white border-gray-200 shadow-none h-[calc(100vh-200px)] flex flex-col",children:e.jsxs(D,{className:"px-4 sm:px-6 flex flex-col flex-1",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 sm:gap-4 mb-4 sm:mb-6",children:[e.jsx(i,{className:"h-8 w-48"}),e.jsx(i,{className:"w-full sm:w-[180px] h-10 sm:h-11 rounded-lg"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:[...Array(3)].map((s,a)=>e.jsxs(v,{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx(i,{className:"h-6 w-16 rounded-full"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{className:"h-8 w-8 rounded"}),e.jsx(i,{className:"h-8 w-8 rounded"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(i,{className:"h-3 w-24 mb-1"}),e.jsx(i,{className:"h-5 w-32"})]}),e.jsxs("div",{children:[e.jsx(i,{className:"h-3 w-20 mb-1"}),e.jsx(i,{className:"h-5 w-40"})]}),e.jsxs("div",{children:[e.jsx(i,{className:"h-3 w-16 mb-1"}),e.jsx(i,{className:"h-5 w-28"})]})]})]},a))})]})});class Ne{async getBankAccounts(){return(await g.get("/bank-accounts")).data}async getBankAccount(a){return(await g.get(`/bank-accounts/${a}`)).data}async createBankAccount(a){console.log("Creating bank account with data:",a);const n=await g.post("/bank-accounts",a);return console.log("Bank account created successfully:",n.data),n.data}async updateBankAccount(a,n){return(await g.patch(`/bank-accounts/${a}/set-default`,n)).data}async deleteBankAccount(a){return(await g.delete(`/bank-accounts/${a}`)).data}async setDefaultBankAccount(a){return(await g.patch(`/bank-accounts/${a}/set-default`)).data}}const C=new Ne,u=["bankAccounts"];function je(){return re({queryKey:u,queryFn:()=>C.getBankAccounts(),staleTime:300*1e3,gcTime:600*1e3})}function we(){return S({mutationFn:s=>C.createBankAccount(s),onSuccess:async s=>{await b.invalidateQueries({queryKey:u}),await b.refetchQueries({queryKey:u}),x.success(s.message||"Bank account added successfully")},onError:s=>{const a=s.response?.data?.message||"Failed to add bank account";x.error(a),console.error("Create bank account error:",s)}})}function ke(){return S({mutationFn:({id:s,data:a})=>C.updateBankAccount(s,a),onSuccess:async s=>{await b.invalidateQueries({queryKey:u}),await b.refetchQueries({queryKey:u}),x.success(s.message||"Bank account updated successfully")},onError:s=>{const a=s.response?.data?.message||"Failed to update bank account";x.error(a),console.error("Update bank account error:",s)}})}function Ae(){return S({mutationFn:s=>C.deleteBankAccount(s),onSuccess:async s=>{await b.invalidateQueries({queryKey:u}),await b.refetchQueries({queryKey:u}),x.success(s.message||"Bank account deleted successfully")},onError:s=>{const a=s.response?.data?.message||"Failed to delete bank account";x.error(a),console.error("Delete bank account error:",s)}})}function ve(){const s=le();return S({mutationFn:a=>C.setDefaultBankAccount(a),onMutate:async a=>{await s.cancelQueries({queryKey:u});const n=s.getQueryData(u);return s.setQueryData(u,t=>{if(!t?.data)return t;const r=t.data.map(l=>({...l,isDefault:l.id===a}));return{...t,data:r}}),{previousAccounts:n}},onError:(a,n,t)=>{s.setQueryData(u,t?.previousAccounts);const r=a.response?.data?.message||"Failed to set default bank account";x.error(r),console.error("Set default bank account error:",a)},onSettled:async()=>{await s.invalidateQueries({queryKey:u})},onSuccess:a=>{x.success(a.message||"Default bank account updated")}})}const Fe=()=>{const[s,a]=p.useState(!1),[n,t]=p.useState(null),[r,l]=p.useState(!1),[o,d]=p.useState(null),[y,N]=p.useState(null),{data:f,isLoading:j,error:h}=je(),m=we(),F=ke(),q=Ae(),X=ve(),B=f?.data||[],K=async(c,M)=>{if(M)await X.mutateAsync(c);else{const I=B.find(W=>W.id===c);I&&await F.mutateAsync({id:c,data:{...I,isDefault:!1}})}},$=async c=>{try{n?await F.mutateAsync({id:n.id,data:c}):await m.mutateAsync(c),a(!1),t(null)}catch(M){console.error("Failed to save bank account:",M)}},O=c=>{t(c),a(!0)},R=c=>{d(c),l(!0)},_=()=>{o&&q.mutate(o.id,{onSuccess:()=>{l(!1),d(null)}})},P=()=>{l(!1),d(null)},U=()=>{a(!1),t(null)};return j?e.jsx(ye,{}):h?e.jsx(v,{className:"bg-white border-gray-200 shadow-none h-[calc(100vh-200px)] justify-center items-center",children:e.jsx(D,{className:"px-4 sm:px-6",children:e.jsx("div",{className:"text-center py-12 text-red-500",children:"Failed to load bank accounts. Please try again."})})}):e.jsx(v,{className:"bg-white border-gray-200 shadow-none h-[calc(100vh-200px)] flex flex-col",children:e.jsxs(D,{className:"px-4 sm:px-6 flex flex-col flex-1",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 sm:gap-4 mb-4 sm:mb-6",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-semibold",children:"Manage Bank Accounts"}),e.jsxs(T,{onClick:()=>a(!0),className:"w-full sm:w-auto min-w-full sm:min-w-[180px] h-10 sm:h-11 bg-primary hover:bg-primary/90 text-white px-3 sm:px-5 rounded-lg flex items-center justify-center gap-2 text-sm sm:text-base font-medium",children:[e.jsx(ue,{className:"w-4 h-4"}),e.jsx("span",{children:"Add Bank Account"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 sm:gap-6 ",children:B.length>0?B.map(c=>e.jsx(fe,{id:c.id,accountHolder:c.accountHolderName,accountNumber:`XXXX XXXX XXXX ${c.accountNumber.slice(-4)}`,bankName:c.bankName,onEdit:()=>O(c),onDelete:()=>R(c),onToggleDefault:K,isDefault:c.isDefault},c.id)):e.jsxs("div",{className:"col-span-full flex flex-col items-center justify-center min-h-[400px]",children:[e.jsx(he,{className:"h-12 w-12 mb-4 text-gray-300"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"No bank accounts added yet"})]})}),e.jsx(be,{isOpen:s,isSubmitting:m.isPending||F?.isPending,onClose:U,onSubmit:$,totalBankAccount:B.length>0,initialData:n?{accountHolderName:n.accountHolderName,bankName:n.bankName,isDefault:n.isDefault,accountNumber:n.accountNumber,routingNumber:n.routingNumber,swiftCode:n.swiftCode,accountType:n.accountType}:void 0,isEdit:!!n}),r&&e.jsx(de,{isOpen:r,onClose:P,onConfirm:_,title:"Delete Bank Account?",description:e.jsxs(e.Fragment,{children:["Are you sure you want to delete the bank account ending in"," ",e.jsx("strong",{className:"font-semibold",children:o?.accountNumber}),"? This action cannot be undone."]}),confirmText:"Yes, I'm Sure",cancelText:"Cancel",isLoading:q.isPending})]})})};export{Fe as default};
