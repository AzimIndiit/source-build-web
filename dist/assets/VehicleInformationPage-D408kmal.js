import{E as K,$ as k,a0 as R,A as y,Z as G,I as d,H as W,u as Y,r as m,o as Q,p as J,j as e,F as ee,x as ae,a1 as O,B as re,L as le}from"./index-BCiIUrXb.js";import{A as se}from"./AuthWrapper-zmeuqRTi.js";import{F as D}from"./FormSelect-prL940lU.js";import{v as F}from"./vehicleService-DaKKc3jd.js";import{U as j}from"./upload-Brfr3HgH.js";import"./index-BdQq_4o_.js";import"./badge-C6OOTzUs.js";const z=5*1024*1024,L=["image/jpeg","image/jpg","image/png","image/webp"],te={default:/^[A-Z0-9]{2,}[\s-]?[A-Z0-9]{1,}[\s-]?[A-Z0-9]{1,}$/i},ie=K({vehicleType:y().min(1,"Vehicle type is required"),vehicleRegistrationNumber:y().trim().min(2,"Registration number must be at least 2 characters").max(20,"Registration number must not exceed 20 characters").transform(s=>s.toUpperCase()).refine(s=>te.default.test(s),"Invalid registration number format"),vehicleManufacturer:y().min(1,"Vehicle manufacturer is required"),vehicleModel:y().min(1,"Vehicle model is required"),vehicleImages:k(R(File).refine(s=>s.size<=z,{message:"Max file size is 5MB"}).refine(s=>L.includes(s.type),{message:"Only .jpg, .jpeg, .png, .webp and .gif formats are supported"})).optional(),insuranceImages:k(R(File).refine(s=>s.size<=z,{message:"Max file size is 5MB"}).refine(s=>L.includes(s.type),{message:"Only .jpg, .jpeg, .png, .webp and .gif formats are supported"})).optional()}),ne=["vehicles"];function oe(){return G({mutationFn:async s=>{const[c,b]=await Promise.all([F.uploadVehicleImages(s.vehicleImageFiles),F.uploadInsuranceImages(s.insuranceImageFiles)]);if(c.length===0)throw new Error("Failed to upload vehicle images. Please try again.");const u={vehicleType:s.vehicleType,vehicleManufacturer:s.vehicleManufacturer,vehicleModel:s.vehicleModel,vehicleRegistrationNumber:s.vehicleRegistrationNumber,vehicleImages:c,insuranceImages:b};return await F.createVehicle(u)},onSuccess:s=>{W.invalidateQueries({queryKey:ne}),d.success(s.message||"Vehicle information submitted successfully!")},onError:s=>{const c=s.response?.data?.message||s.message||"Failed to submit vehicle information";d.error(c),console.error("Error submitting vehicle information:",s)}})}const h=5,g=2,ce=5*1024*1024,de=[{value:"sedan",label:"Sedan"},{value:"suv",label:"SUV"},{value:"truck",label:"Truck"},{value:"van",label:"Van"},{value:"pickup",label:"Pickup"},{value:"minivan",label:"Minivan"},{value:"other",label:"Other"}],ue=[{value:"toyota",label:"Toyota"},{value:"honda",label:"Honda"},{value:"ford",label:"Ford"},{value:"chevrolet",label:"Chevrolet"},{value:"nissan",label:"Nissan"},{value:"hyundai",label:"Hyundai"},{value:"kia",label:"Kia"},{value:"mazda",label:"Mazda"},{value:"volkswagen",label:"Volkswagen"},{value:"mercedes",label:"Mercedes-Benz"},{value:"bmw",label:"BMW"},{value:"audi",label:"Audi"},{value:"tesla",label:"Tesla"},{value:"other",label:"Other"}],_={toyota:[{value:"camry",label:"Camry"},{value:"corolla",label:"Corolla"},{value:"rav4",label:"RAV4"},{value:"highlander",label:"Highlander"},{value:"tacoma",label:"Tacoma"},{value:"sienna",label:"Sienna"}],honda:[{value:"accord",label:"Accord"},{value:"civic",label:"Civic"},{value:"crv",label:"CR-V"},{value:"pilot",label:"Pilot"},{value:"odyssey",label:"Odyssey"}],ford:[{value:"f150",label:"F-150"},{value:"f250",label:"F-250"},{value:"explorer",label:"Explorer"},{value:"escape",label:"Escape"},{value:"transit",label:"Transit"}],chevrolet:[{value:"silverado",label:"Silverado"},{value:"tahoe",label:"Tahoe"},{value:"suburban",label:"Suburban"},{value:"express",label:"Express"}],other:[{value:"other",label:"Other"}]};function ye(){const s=Y(),[c,b]=m.useState([]),[u,N]=m.useState([]),[S,M]=m.useState(!1),[A,I]=m.useState(!1),[me,E]=m.useState(!1),p=oe(),V=Q({resolver:J(ie),defaultValues:{vehicleType:"",vehicleRegistrationNumber:"",vehicleManufacturer:"",vehicleModel:""}}),{handleSubmit:B,watch:U}=V,w=U("vehicleManufacturer"),H=w?_[w]||_.other:[],x=a=>a.type.startsWith("image/")?a.size>ce?{valid:!1,error:"Maximum size is 5MB allowed"}:{valid:!0}:{valid:!1,error:`"${a.name}" is not an image file`},v=m.useCallback(a=>{a.preventDefault(),a.stopPropagation(),a.type==="dragenter"||a.type==="dragover"?M(!0):a.type==="dragleave"&&M(!1)},[]),C=m.useCallback(a=>{if(a.preventDefault(),a.stopPropagation(),M(!1),a.dataTransfer.files&&a.dataTransfer.files[0]){const l=Array.from(a.dataTransfer.files);if(c.length>=h){d.error(`Maximum ${h} images allowed`);return}const i=h-c.length,t=[],n=[];for(let r=0;r<Math.min(l.length,i);r++){const o=x(l[r]);o.valid?t.push(l[r]):o.error&&n.push(o.error)}l.length>i&&n.push(`Only ${i} more image(s) can be added (max ${h} total)`),t.length>0&&(b(r=>[...r,...t]),E(!1)),n.forEach(r=>d.error(r))}},[c]),$=a=>{if(a.target.files){const l=Array.from(a.target.files);if(c.length>=h){d.error(`Maximum ${h} images allowed`),a.target.value="";return}const i=h-c.length,t=[],n=[];for(let r=0;r<Math.min(l.length,i);r++){const o=x(l[r]);o.valid?t.push(l[r]):o.error&&n.push(o.error)}l.length>i&&n.push(`Only ${i} more image(s) can be added (max ${h} total)`),t.length>0&&(b(r=>[...r,...t]),E(!1)),n.forEach(r=>d.error(r)),a.target.value=""}},f=m.useCallback(a=>{a.preventDefault(),a.stopPropagation(),a.type==="dragenter"||a.type==="dragover"?I(!0):a.type==="dragleave"&&I(!1)},[]),T=m.useCallback(a=>{if(a.preventDefault(),a.stopPropagation(),I(!1),a.dataTransfer.files&&a.dataTransfer.files[0]){const l=Array.from(a.dataTransfer.files);if(u.length>=g){d.error(`Maximum ${g} images allowed`);return}const i=g-u.length,t=[],n=[];for(let r=0;r<Math.min(l.length,i);r++){const o=x(l[r]);o.valid?t.push(l[r]):o.error&&n.push(o.error)}l.length>i&&n.push(`Only ${i} more image(s) can be added (max ${g} total)`),t.length>0&&N(r=>[...r,...t]),n.forEach(r=>d.error(r))}},[u]),P=a=>{if(a.target.files){const l=Array.from(a.target.files);if(u.length>=g){d.error(`Maximum ${g} images allowed`),a.target.value="";return}const i=g-u.length,t=[],n=[];for(let r=0;r<Math.min(l.length,i);r++){const o=x(l[r]);o.valid?t.push(l[r]):o.error&&n.push(o.error)}l.length>i&&n.push(`Only ${i} more image(s) can be added (max ${g} total)`),t.length>0&&N(r=>[...r,...t]),n.forEach(r=>d.error(r)),a.target.value=""}},Z=a=>{b(l=>l.filter((i,t)=>t!==a))},q=a=>{N(l=>l.filter((i,t)=>t!==a))},X=async a=>{if(c.length===0){E(!0),d.error("Please upload at least one vehicle image"),window.scrollTo({top:0,behavior:"smooth"});return}try{(await p.mutateAsync({vehicleType:a.vehicleType,vehicleManufacturer:a.vehicleManufacturer,vehicleModel:a.vehicleModel,vehicleRegistrationNumber:a.vehicleRegistrationNumber,vehicleImageFiles:c,insuranceImageFiles:u}))?.status==="success"&&s("/auth/driver-license")}catch(l){console.error("Failed to submit vehicle information:",l)}};return e.jsx(se,{children:e.jsxs("div",{className:"w-full max-w-2xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Vehicle Information"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Provide your vehicle details to ensure smooth delivery assignments and route optimization."})]}),e.jsx(ee,{...V,children:e.jsxs("form",{onSubmit:B(X),className:"space-y-4",children:[e.jsx(D,{name:"vehicleType",label:"",disabled:p.isPending,placeholder:"Select Vehicle type",options:de}),e.jsx(ae,{name:"vehicleRegistrationNumber",label:"",type:"text",disabled:p.isPending,placeholder:"Vehicle registration number e.g., KA01AB1234"}),e.jsx(D,{name:"vehicleManufacturer",label:"",disabled:p.isPending,placeholder:"Select Manufacturer",options:ue}),e.jsx(D,{name:"vehicleModel",label:"",disabled:p.isPending||!w,placeholder:"Select Model",options:H}),e.jsx("div",{className:"space-y-4",children:c.length===0?e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-4 text-center bg-gray-50 ${S?"border-primary bg-blue-50":"border-gray-300"}`,onDragEnter:v,onDragLeave:v,onDragOver:v,onDrop:C,children:[e.jsx("input",{type:"file",id:"vehicle-photo-upload",className:"hidden",multiple:!0,accept:"image/*",onChange:$}),e.jsxs("label",{htmlFor:"vehicle-photo-upload",className:"cursor-pointer inline-flex flex-col items-center",children:[e.jsx(j,{className:"h-8 w-8 text-gray-400 mb-2"}),e.jsxs("span",{className:"text-xs text-gray-600",children:["Drag & drop media or"," ",e.jsx("span",{className:"text-primary underline",children:"click here"})]}),e.jsx("span",{className:"text-xs text-red-600",children:"Max file size is 5MB"})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-3 text-center bg-gray-50 ${S?"border-primary bg-blue-50":"border-gray-300"}`,onDragEnter:v,onDragLeave:v,onDragOver:v,onDrop:C,children:[e.jsx("input",{type:"file",id:"vehicle-photo-upload-more",className:"hidden",multiple:!0,accept:"image/*",onChange:$}),e.jsxs("label",{htmlFor:"vehicle-photo-upload-more",className:"cursor-pointer inline-flex items-center gap-2",children:[e.jsx(j,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{className:"text-xs text-gray-600",children:["Drag & drop media or"," ",e.jsx("span",{className:"text-primary underline",children:"click here"})]})]}),e.jsx("div",{className:"text-xs text-red-600",children:"Max file size is 5MB"})]}),e.jsx("div",{className:"grid grid-cols-3 lg:grid-cols-5 gap-2",children:c.map((a,l)=>e.jsxs("div",{className:"relative group border border-gray-200 rounded-sm shadow-sm",children:[e.jsx("img",{src:URL.createObjectURL(a),alt:`Vehicle ${l+1}`,className:"w-full sm:h-24 md:h-28 h-20 lg:h-16 object-cover rounded-sm"}),e.jsx("button",{type:"button",onClick:()=>Z(l),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-0.5 cursor-pointer",children:e.jsx(O,{className:"h-3 w-3"})})]},`vehicle-${l}`))})]})}),e.jsx("div",{className:"space-y-2",children:u.length===0?e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-4 text-center bg-gray-50 ${A?"border-primary bg-blue-50":"border-gray-300"}`,onDragEnter:f,onDragLeave:f,onDragOver:f,onDrop:T,children:[e.jsx("input",{type:"file",id:"insurance-photo-upload",className:"hidden",multiple:!0,accept:"image/*",onChange:P}),e.jsxs("label",{htmlFor:"insurance-photo-upload",className:"cursor-pointer inline-flex flex-col items-center",children:[e.jsx(j,{className:"h-8 w-8 text-gray-400 mb-2"}),e.jsxs("span",{className:"text-xs text-gray-600",children:["Drag & drop insurance documents or"," ",e.jsx("span",{className:"text-primary underline",children:"click here"})]}),e.jsx("span",{className:"text-xs text-red-600",children:"Max file size is 5MB"})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-3 text-center bg-gray-50 ${A?"border-primary bg-blue-50":"border-gray-300"}`,onDragEnter:f,onDragLeave:f,onDragOver:f,onDrop:T,children:[e.jsx("input",{type:"file",id:"insurance-photo-upload-more",className:"hidden",multiple:!0,accept:"image/*",onChange:P}),e.jsxs("label",{htmlFor:"insurance-photo-upload-more",className:"cursor-pointer inline-flex items-center gap-2",children:[e.jsx(j,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{className:"text-xs text-gray-600",children:["Add more insurance documents"," ",e.jsx("span",{className:"text-primary underline",children:"click here"})]})]}),e.jsx("div",{className:"text-xs text-red-600",children:"Max file size is 5MB"})]}),e.jsx("div",{className:"grid grid-cols-3 lg:grid-cols-5 gap-2",children:u.map((a,l)=>e.jsxs("div",{className:"relative group border border-gray-200 rounded-sm shadow-sm",children:[e.jsx("img",{src:URL.createObjectURL(a),alt:`Insurance ${l+1}`,className:"w-full sm:h-24 md:h-28 h-20 lg:h-16 object-cover rounded-sm"}),e.jsx("button",{type:"button",onClick:()=>q(l),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-0.5 cursor-pointer",children:e.jsx(O,{className:"h-3 w-3"})})]},`insurance-${l}`))})]})}),e.jsx("div",{className:"flex gap-4 pt-4",children:e.jsx(re,{type:"submit",className:"flex-1  bg-primary hover:bg-primary/80 text-white",disabled:p.isPending,loading:p.isPending,children:"Continue"})}),e.jsx("div",{className:"text-center pt-2",children:e.jsxs(le,{to:"/auth/signup",className:"text-sm text-gray-500 hover:text-gray-700",children:["Back to ",e.jsx("span",{className:"text-primary",children:"Sign Up"})," |"," ",e.jsx("span",{className:"text-primary",children:"Login"})]})})]})})]})})}export{ye as default};
