import{c as b,r as m,j as e,I as v,p as E,q as r,B as T,k as P,z as i}from"./index-BiCr9dd_.js";import{A as w}from"./AuthWrapper-CC9SsPQ1.js";import{a as I,b as R}from"./useAuthMutations-Bb8_ghuI.js";const f=60,o="otp_resend_timestamp";function M(){const h=b(),[u,y]=m.useState(""),[c,l]=m.useState(0),s=sessionStorage.getItem("signup_email"),g=I(),p=R(),j=()=>{const t=localStorage.getItem(o);if(!t)return 0;const n=parseInt(t,10),d=Date.now(),x=Math.floor((d-n)/1e3),a=f-x;return a>0?a:0};m.useEffect(()=>{s||h("/auth/login")},[s,h]),m.useEffect(()=>{const t=j();l(t)},[]),m.useEffect(()=>{let t;return c>0&&(t=setTimeout(()=>{const n=c-1;l(n),n===0&&localStorage.removeItem(o)},1e3)),()=>{t&&clearTimeout(t)}},[c]);const N=async t=>{if(t.preventDefault(),u.length!==6){i.error("Please enter a 6-digit OTP");return}if(!s){i.error("Email not found. Please sign up again.");return}g.mutate({email:s,otp:u,type:"UR"},{onSuccess:()=>{localStorage.removeItem(o)}})},O=()=>{if(!s){i.error("Email not found. Please sign up again.");return}const t=j();if(t>0){i.error(`Please wait ${t} seconds before requesting another OTP`);return}localStorage.setItem(o,Date.now().toString()),p.mutate({email:s,type:"UR"},{onSuccess:()=>{y(""),l(f)},onError:n=>{const d=n.response?.data?.message||"";if(d.includes("Please wait")){const x=d.match(/(\d+) seconds/),a=x?parseInt(x[1],10):f;l(a);const S=Date.now()-(f-a)*1e3;localStorage.setItem(o,S.toString()),i(`Please wait ${a} seconds before requesting another OTP`,{icon:"â°",style:{background:"#FEF8C6",color:"#000",border:"1px solid #FCE992"}})}else localStorage.removeItem(o),l(0),i.error(d||"Failed to resend OTP. Please try again.")}})};return s?e.jsx(w,{children:e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"OTP Verification"}),e.jsx("p",{className:"text-gray-600",children:"Enter 6-digit OTP sent on your registered email"}),e.jsx("p",{className:"text-gray-600 font-medium",children:s})]}),e.jsx("div",{className:"flex justify-center sm:py-6",children:e.jsx(v,{disabled:g.isPending||p.isPending,maxLength:6,pattern:"^[0-9]+$",value:u,onChange:t=>y(t),children:e.jsxs(E,{className:"gap-3",children:[e.jsx(r,{index:0}),e.jsx(r,{index:1}),e.jsx(r,{index:2}),e.jsx(r,{index:3}),e.jsx(r,{index:4}),e.jsx(r,{index:5})]})})}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-gray-600",children:["Didn't get OTP?"," ",c>0?e.jsxs("span",{className:"font-medium text-gray-700",children:["Resend in ",e.jsxs("span",{className:"text-primary font-bold",children:[c,"s"]})]}):e.jsx("button",{type:"button",onClick:O,disabled:p.isPending,className:"text-red-600 hover:text-red-700 font-medium disabled:opacity-50 cursor-pointer transition-colors ",children:p.isPending?"Resending...":"Resend"})]})}),e.jsx(T,{type:"submit",className:"w-full  bg-primary hover:bg-primary/80 text-white font-medium text-base",loading:g.isPending,disabled:u.length!==6||g.isPending,children:"Verify"}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-gray-600",children:["Back to"," ",e.jsx(P,{to:"/auth/signup",className:"text-primary hover:text-primary/80 font-medium",children:"Sign Up"})," | ",e.jsx(P,{to:"/auth/login",className:"text-primary hover:text-primary/80 font-medium",children:"Login"})]})})]})}):null}export{M as default};
