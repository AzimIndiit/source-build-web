import{u as S,r as i,j as e,W as b,X as v,Y as n,B as E,L as h,I as u}from"./index-BCiIUrXb.js";import{A as T}from"./AuthWrapper-zmeuqRTi.js";import{a as I,b as R}from"./useAuthMutations-CBbxsjT0.js";const j=60,r="otp_resend_timestamp";function C(){const x=S(),[o,p]=i.useState(""),[a,c]=i.useState(0),s=sessionStorage.getItem("signup_email"),l=I(),m=R(),g=()=>{const t=localStorage.getItem(r);if(!t)return 0;const d=parseInt(t,10),P=Date.now(),O=Math.floor((P-d)/1e3),f=j-O;return f>0?f:0};i.useEffect(()=>{s||x("/auth/login")},[s,x]),i.useEffect(()=>{const t=g();c(t)},[]),i.useEffect(()=>{let t;return a>0&&(t=setTimeout(()=>{const d=a-1;c(d),d===0&&localStorage.removeItem(r)},1e3)),()=>{t&&clearTimeout(t)}},[a]);const y=async t=>{if(t.preventDefault(),o.length!==6){u.error("Please enter a 6-digit OTP");return}if(!s){u.error("Email not found. Please sign up again.");return}l.mutate({email:s,otp:o,type:"UR"},{onSuccess:()=>{localStorage.removeItem(r)}})},N=()=>{if(!s){u.error("Email not found. Please sign up again.");return}const t=g();if(t>0){u.error(`Please wait ${t} seconds before requesting another OTP`);return}localStorage.setItem(r,Date.now().toString()),m.mutate({email:s,type:"UR"},{onSuccess:()=>{p(""),c(j)},onError:()=>{localStorage.removeItem(r),c(0)}})};return s?e.jsx(T,{children:e.jsxs("form",{onSubmit:y,className:"space-y-6",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"OTP Verification"}),e.jsx("p",{className:"text-gray-600",children:"Enter 6-digit OTP sent on your registered email"}),e.jsx("p",{className:"text-gray-600 font-medium",children:s})]}),e.jsx("div",{className:"flex justify-center sm:py-6",children:e.jsx(b,{disabled:l.isPending||m.isPending,maxLength:6,pattern:"^[0-9]+$",value:o,onChange:t=>p(t),children:e.jsxs(v,{className:"gap-3",children:[e.jsx(n,{index:0}),e.jsx(n,{index:1}),e.jsx(n,{index:2}),e.jsx(n,{index:3}),e.jsx(n,{index:4}),e.jsx(n,{index:5})]})})}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-gray-600",children:["Didn't get OTP?"," ",a>0?e.jsxs("span",{className:"font-medium text-gray-700",children:["Resend in ",e.jsxs("span",{className:"text-primary font-bold",children:[a,"s"]})]}):e.jsx("button",{type:"button",onClick:N,disabled:m.isPending,className:"text-red-600 hover:text-red-700 font-medium disabled:opacity-50 cursor-pointer transition-colors ",children:m.isPending?"Resending...":"Resend"})]})}),e.jsx(E,{type:"submit",className:"w-full  bg-primary hover:bg-primary/80 text-white font-medium text-base",loading:l.isPending,disabled:o.length!==6||l.isPending,children:"Verify"}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-gray-600",children:["Back to"," ",e.jsx(h,{to:"/auth/signup",className:"text-primary hover:text-primary/80 font-medium",children:"Sign Up"})," | ",e.jsx(h,{to:"/auth/login",className:"text-primary hover:text-primary/80 font-medium",children:"Login"})]})})]})}):null}export{C as default};
