import{j as s,S as r,u as Ae,ad as Oe,r as h,aj as Ee,ak as Me,a3 as ie,h as Be,i as $e,z as w,F as He,ac as _e,B as re,al as Le,am as Qe,an as ze,f as Re,$ as S,a2 as m,ao as Z,ap as N,a0 as X,aq as oe,n as ne}from"./index-CUSVstqU.js";import{P as le,a as Xe}from"./ProductPreview-DXz8ypX9.js";import{d as Ue,e as Ge,c as Ke}from"./useProductMutations-CP-SVJ5v.js";import{v as U}from"./imageValidation-BOnAwXS7.js";import{f as ce}from"./format-Byp0gi1d.js";import"./FormSelect-DiVd6t5g.js";import"./index-BdQq_4o_.js";import"./badge-c_xwgsXg.js";import"./PickupHoursSelector-C2PCOgFr.js";import"./colorUtils-BjIcJb6R.js";import"./upload-BVTc7vsb.js";import"./trash-2-BLdsFbCa.js";import"./en-US-CPLesiGp.js";const Ze=()=>s.jsxs("div",{className:"h-screen bg-gray-50 fixed top-0 w-full z-50 left-0 flex flex-col",children:[s.jsx("div",{className:"bg-primary px-4 py-3",children:s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[s.jsx(r,{className:"h-6 w-6 rounded bg-white/20"}),s.jsxs("div",{children:[s.jsx(r,{className:"h-3 w-20 mb-1 bg-white/20"}),s.jsx(r,{className:"h-4 w-24 bg-white/20"})]})]})})}),s.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row gap-4 p-4 mx-auto overflow-hidden min-h-0 w-full",children:[s.jsx("div",{className:"w-full lg:max-w-[450px] h-full",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 h-full overflow-y-auto space-y-6",children:[s.jsxs("div",{className:"space-y-3",children:[s.jsx(r,{className:"h-5 w-20"}),s.jsx(r,{className:"w-full h-48 rounded-lg border-2 border-dashed"}),s.jsx("div",{className:"flex gap-2",children:Array.from({length:3}).map((a,o)=>s.jsx(r,{className:"w-16 h-16 rounded"},o))})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(r,{className:"h-4 w-16"}),s.jsx(r,{className:"h-10 w-full rounded"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(r,{className:"h-4 w-12"}),s.jsx(r,{className:"h-10 w-full rounded"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(r,{className:"h-4 w-20"}),s.jsx(r,{className:"h-24 w-full rounded"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(r,{className:"h-4 w-16"}),s.jsx(r,{className:"h-10 w-full rounded"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(r,{className:"h-4 w-20"}),s.jsx(r,{className:"h-10 w-full rounded"})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(r,{className:"h-4 w-16"}),s.jsx(r,{className:"h-10 w-full rounded"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(r,{className:"h-4 w-12"}),s.jsx(r,{className:"h-10 w-full rounded"})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(r,{className:"h-4 w-12"}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(r,{className:"h-10 w-20 rounded"}),s.jsx(r,{className:"w-10 h-10 rounded-full"})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(r,{className:"h-4 w-16"}),s.jsx(r,{className:"h-10 w-full rounded"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(r,{className:"h-4 w-16"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:Array.from({length:4}).map((a,o)=>s.jsx(r,{className:"h-6 w-16 rounded-full"},o))})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx(r,{className:"h-4 w-32"}),s.jsx("div",{className:"space-y-2",children:Array.from({length:3}).map((a,o)=>s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(r,{className:"w-4 h-4 rounded"}),s.jsx(r,{className:"h-4 w-20"})]},o))})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(r,{className:"h-4 w-20"}),s.jsx(r,{className:"h-10 w-full rounded"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(r,{className:"h-4 w-16"}),s.jsx(r,{className:"h-10 w-full rounded"})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx(r,{className:"h-4 w-16"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(r,{className:"h-10 w-full rounded"}),s.jsx(r,{className:"h-10 w-full rounded"})]})]}),s.jsx("div",{className:"pt-4",children:s.jsx(r,{className:"h-12 w-full rounded"})})]})]})}),s.jsx("div",{className:"w-full lg:flex-1 hidden lg:block h-full",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 h-full overflow-y-auto",children:[s.jsx(r,{className:"h-6 w-32 mb-6"}),s.jsx(r,{className:"w-full h-64 rounded-lg mb-6"}),s.jsxs("div",{className:"space-y-4",children:[s.jsx(r,{className:"h-8 w-full"}),s.jsx(r,{className:"h-6 w-32"}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(r,{className:"h-4 w-full"}),s.jsx(r,{className:"h-4 w-3/4"}),s.jsx(r,{className:"h-4 w-1/2"})]}),s.jsx("div",{className:"flex gap-2",children:Array.from({length:3}).map((a,o)=>s.jsx(r,{className:"h-6 w-16 rounded-full"},o))})]})]})})]})]}),We=S({color:m().trim().regex(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,"Please enter a valid HEX color code"),quantity:m().trim().refine(a=>a.length>0,"Quantity is required").regex(/^(0|[1-9]\d*)$/,"Quantity must be a whole number").refine(a=>{const o=parseInt(a);return!isNaN(o)&&o>=0},"Quantity must be at least 0"),outOfStock:N().optional(),price:m().trim().min(1,"Price is required").regex(/^\d+(\.\d{1,2})?$/,"Price must be a valid number").refine(a=>parseFloat(a)>0,"Price must be greater than 0"),priceType:Z(["sqft","linear","pallet"]).default("sqft").optional(),discount:S({discountType:Z(["none","flat","percentage"]),discountValue:m().optional()}).refine(a=>a.discountType!=="none"?a.discountValue&&a.discountValue.trim().length>0:!0,{message:"Discount value is required when discount type is selected",path:["discountValue"]}).refine(a=>{if(a.discountType==="percentage"&&a.discountValue){const o=parseFloat(a.discountValue);return!isNaN(o)&&o>=0&&o<=100}return!0},{message:"Percentage discount must be between 0 and 100",path:["discountValue"]}).refine(a=>{if(a.discountType==="flat"&&a.discountValue){const o=parseFloat(a.discountValue);return!isNaN(o)&&o>=0}return!0},{message:"Flat discount must be a positive number",path:["discountValue"]})}),Ye=S({title:m().trim().min(3,"Title must be at least 3 characters").max(100,"Title must not exceed 100 characters"),price:m().trim().min(1,"Price is required").regex(/^\d+(\.\d{1,2})?$/,"Price must be a valid number with up to 2 decimal places").refine(a=>parseFloat(a)>0,"Price must be greater than 0").refine(a=>parseFloat(a)<=999999.99,"Price must not exceed 999,999.99"),priceType:m().trim().default("sqft").optional(),description:m().trim().min(10,"Description must be at least 10 characters").max(2e3,"Description must not exceed 2000 characters"),category:m().trim().min(1,"Category is required").max(50,"Category must not exceed 50 characters"),subCategory:m().trim().min(1,"Sub category is required").max(50,"Sub category must not exceed 50 characters"),quantity:m().trim().refine(a=>a.length>0,"Quantity is required").regex(/^(0|[1-9]\d*)$/,"Quantity must be a whole number").refine(a=>{const o=parseInt(a);return!isNaN(o)&&o>=0},"Quantity must be at least 0").refine(a=>{const o=parseInt(a);return!isNaN(o)&&o<=99999},"Quantity must not exceed 99,999"),outOfStock:N().optional(),brand:m().trim().min(2,"Brand must be at least 2 characters").max(50,"Brand must not exceed 50 characters").regex(/^[a-zA-Z0-9\s\-&.]+$/,"Brand can only contain letters, numbers, spaces, hyphens, ampersands, and periods").optional().or(oe("")),color:m().trim().regex(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,"Please enter a valid HEX color code").optional().or(oe("")),locationIds:X(m()).min(1,"At least one location is required").max(10,"Maximum 10 locations allowed"),productTag:X(m().trim().min(2,"Each tag must be at least 2 characters").max(30,"Each tag must not exceed 30 characters").regex(/^[a-zA-Z0-9\s\-#]+$/,"Tags can only contain letters, numbers, spaces, hyphens, and hashtags")).max(10,"Maximum 10 tags allowed").default([]),variants:X(We).max(5,"Maximum 5 variants allowed").optional(),marketplaceOptions:S({pickup:N().optional(),shipping:N().optional(),delivery:N().optional()}).required().refine(a=>a.pickup||a.shipping||a.delivery,{message:"At least one marketplace option (Pickup, Shipping, or Delivery) must be selected"}),pickupHours:m().trim().optional(),deliveryDistance:m().trim().optional(),shippingPrice:m().trim().optional(),localDeliveryFree:N().optional(),readyByDays:m().optional(),dimensions:S({width:m().optional(),length:m().optional(),height:m().optional()}).optional(),discount:S({discountType:Z(["none","flat","percentage"]),discountValue:m().optional()}).refine(a=>a.discountType!=="none"?a.discountValue&&a.discountValue.trim().length>0:!0,{message:"Discount value is required when discount type is selected",path:["discountValue"]}).refine(a=>{if(a.discountType==="percentage"&&a.discountValue){const o=parseFloat(a.discountValue);return!isNaN(o)&&o>=0&&o<=100}return!0},{message:"Percentage discount must be between 0 and 100",path:["discountValue"]}).refine(a=>{if(a.discountType==="flat"&&a.discountValue){const o=parseFloat(a.discountValue);return!isNaN(o)&&o>=0}return!0},{message:"Flat discount must be a positive number",path:["discountValue"]})}).refine(a=>!(a.marketplaceOptions?.pickup&&!a.pickupHours?.trim()),{message:"Pickup hours are required when pickup option is selected",path:["pickupHours"]}).refine(a=>!(a.marketplaceOptions?.shipping&&!a.shippingPrice?.trim()),{message:"Shipping price is required when shipping option is selected",path:["shippingPrice"]}).refine(a=>{if(a.marketplaceOptions?.shipping&&a.shippingPrice?.trim()){if(!/^\d+(\.\d{1,2})?$/.test(a.shippingPrice))return!1;const f=parseFloat(a.shippingPrice);if(isNaN(f)||f<0)return!1}return!0},{message:"Shipping price must be a valid positive number",path:["shippingPrice"]}).superRefine((a,o)=>{a.marketplaceOptions?.pickup&&!a.pickupHours?.trim()&&o.addIssue({code:"custom",path:["pickupHours"],message:"Pickup hours are required when pickup option is selected"}),a.marketplaceOptions?.shipping&&(a.shippingPrice?.trim()?/^\d+(\.\d{1,2})?$/.test(a.shippingPrice)?parseFloat(a.shippingPrice)<0&&o.addIssue({code:"custom",path:["shippingPrice"],message:"Shipping price must be greater than or equal to 0"}):o.addIssue({code:"custom",path:["shippingPrice"],message:"Shipping price must be a valid number with up to 2 decimals"}):o.addIssue({code:"custom",path:["shippingPrice"],message:"Shipping price is required when shipping option is selected"}))}),G=[{value:"casing",label:"Casing"},{value:"trim",label:"Trim"},{value:"molding",label:"Molding"},{value:"hardware",label:"Hardware"},{value:"doors",label:"Doors"},{value:"windows",label:"Windows"},{value:"glass",label:"Glass"},{value:"locks",label:"Locks"},{value:"hinges",label:"Hinges"},{value:"frames",label:"Frames"},{value:"panels",label:"Panels"},{value:"handles",label:"Handles"}],K=5;function gs(){const a=Ae(),{id:o}=Oe(),[f,k]=h.useState([]),[v,W]=h.useState([]),[de,B]=h.useState(!1),[ue,b]=h.useState(!1),[g,j]=h.useState([]),[pe,P]=h.useState(!1),[me,$]=h.useState(null),[Y,ge]=h.useState(!1),[D,J]=h.useState(!1),[ee,H]=h.useState(!1),[he,_]=h.useState(!1),[F,L]=h.useState(""),{data:C,isLoading:fe}=Ue(o||""),{data:I,refetch:ye}=Ee(),se=Me(),q=Ge(),V=Ke(),{data:xe,isLoading:Je}=ie({queryKey:["categories-active"],queryFn:async()=>(await ne.get("/categories",{params:{limit:100}})).data.data.filter(c=>c.isActive)}),{data:A,isLoading:es}=ie({queryKey:["subcategories",F],queryFn:async()=>F?(await ne.get("/subcategories",{params:{category:F,limit:100}})).data.data.filter(c=>c.isActive):[],enabled:!!F}),T=xe?.map(e=>({value:e._id,label:e.name}))||[],Q=A?.map(e=>({value:e._id,label:e.name}))||[],O=Array.isArray(I?.data)?I.data:I?.data?[I.data]:[],z=O.map(e=>({value:e.id||e._id||"",label:`${e.name} , ${e.formattedAddress}`||""})),p=Be({resolver:$e(Ye),mode:"onChange",reValidateMode:"onChange",defaultValues:{title:"",price:"",priceType:"",description:"",category:"",subCategory:"",quantity:"",outOfStock:!1,brand:"",color:"",locationIds:[],productTag:[],variants:[],marketplaceOptions:{pickup:!1,shipping:!1,delivery:!1},pickupHours:"",shippingPrice:"200",deliveryDistance:void 0,localDeliveryFree:!1,readyByDays:"0",dimensions:{width:"",length:"",height:""},discount:{discountType:"none",discountValue:""}}}),{handleSubmit:ve,watch:we,reset:te,setValue:y}=p,x=we();h.useEffect(()=>{if(x.category){const e=T.find(n=>n.value===x.category||n.label.toLowerCase()===x.category.toLowerCase());e&&L(e.value)}else L("")},[x.category,T]),h.useEffect(()=>{if(Y)if(x.category&&A){const e=x.subCategory;!A.some(c=>c._id===e||c.name.toLowerCase()===e?.toLowerCase())&&e&&y("subCategory","")}else x.category||y("subCategory","")},[x.category,y,Y,A]),h.useEffect(()=>{if(C?.data){const e=C.data;console.log("Product data:",e),console.log("Product category:",e.category),console.log("Product subCategory:",e.subCategory),e.images&&e.images.length>0&&W(e.images);let n="",c="";if(e.readyByDate)try{const u=new Date(e.readyByDate);n=ce(u,"yyyy-MM-dd"),c=ce(u,"HH:mm")}catch(u){console.error("Error parsing date:",u)}let t="",i="";e.category&&(typeof e.category=="string"?t=e.category:typeof e.category=="object"&&e.category&&(t=e.category._id||e.category.id||"")),e.subCategory&&(typeof e.subCategory=="string"?i=e.subCategory:typeof e.subCategory=="object"&&e.subCategory&&(i=e.subCategory._id||e.subCategory.id||"")),t&&L(t),console.log("Category ID:",t),console.log("SubCategory ID:",i);const d=e.priceType||"sqft",l={title:e.title||"",price:e.price?.toString()||"",priceType:d,description:e.description||"",category:t,subCategory:i,quantity:e.quantity?.toString()||"",outOfStock:e.outOfStock||!1,brand:e.brand||"",color:e.color||"",locationIds:e.locationIds?.map(u=>typeof u=="string"?u:u._id||u.id)||[],productTag:e.productTag||[],variants:e.variants?.map(u=>({color:u.color,quantity:u.quantity?.toString()||"",price:u.price?.toString()||"",priceType:u.priceType||d,outOfStock:u.outOfStock||!1,discount:{discountType:u.discount?.discountType||"none",discountValue:u.discount?.discountValue?.toString()||""}}))||[],marketplaceOptions:{pickup:e.marketplaceOptions?.pickup||!1,shipping:e.marketplaceOptions?.shipping||!1,delivery:e.marketplaceOptions?.delivery||!1},deliveryDistance:e?.deliveryDistance?.toString()||"",localDeliveryFree:e.localDeliveryFree||!1,pickupHours:e.pickupHours||"",shippingPrice:e.shippingPrice?.toString()||"",readyByDate:n,readyByTime:c,readyByDays:e.readyByDays?.toString()||"0",dimensions:{width:e.dimensions?.width?.toString()||"",length:e.dimensions?.length?.toString()||"",height:e.dimensions?.height?.toString()||""},discount:{discountType:e.discount?.discountType||"none",discountValue:e.discount?.discountValue?.toString()||""}};console.log("Form data being set:",l),console.log("Discount data:",l.discount),console.log("Setting subCategory to:",i),console.log("About to reset form with category:",t,"subcategory:",i),te(l);const E=p.getValues();console.log("Values immediately after reset:",E),console.log("SubCategory after reset:",E.subCategory),setTimeout(()=>{console.log("Setting form values after delay - category:",t,"subcategory:",i),console.log("Setting discount after delay:",l.discount),p.setValue("category",t),p.setValue("subCategory",i);const u=p.getValues();console.log("SubCategory after setValue:",u.subCategory),p.setValue("discount.discountType",l.discount.discountType),p.setValue("discount.discountValue",l.discount.discountValue),p.clearErrors(["category","subCategory","discount.discountType","discount.discountValue"]),setTimeout(()=>{p.trigger(["category","subCategory"])},50)},100),e.variants&&e.variants.length>0&&(P(!0),j(e.variants.map((u,M)=>({id:u.id||u._id||`variant-${M}-${Date.now()}`,images:[],existingImages:u.images||[]}))),setTimeout(()=>{e.variants?.forEach((u,M)=>{u.discount?.discountType&&(p.setValue(`variants.${M}.discount.discountType`,u.discount.discountType),p.setValue(`variants.${M}.discount.discountValue`,u.discount.discountValue?.toString()||""))})},150)),setTimeout(()=>{p.clearErrors();const u=p.getValues();console.log("Form values after reset:",u),p.trigger(),ge(!0)},200)}},[C,te,p]);const be=h.useCallback(e=>{e.preventDefault(),e.stopPropagation(),e.type==="dragenter"||e.type==="dragover"?B(!0):e.type==="dragleave"&&B(!1)},[]),je=h.useCallback(async e=>{if(e.preventDefault(),e.stopPropagation(),B(!1),e.dataTransfer.files&&e.dataTransfer.files[0]){const n=Array.from(e.dataTransfer.files),c=v.length+f.length,{validFiles:t,errors:i}=await U(n,K,c);t.length>0&&(k(d=>[...d,...t]),b(!1)),i.forEach(d=>w.error(d))}},[f,v]),Ne=async e=>{if(e.target.files){const n=Array.from(e.target.files),c=v.length+f.length,{validFiles:t,errors:i}=await U(n,K,c);t.length>0&&(k(d=>[...d,...t]),b(!1)),i.forEach(d=>w.error(d)),e.target.value=""}},Se=e=>{k(n=>n.filter((c,t)=>t!==e))},Ve=e=>{W(n=>n.filter((c,t)=>t!==e))},Te=async e=>{if(v.length+f.length<2){b(!0),w.error("Please keep at least 2 product images"),window.scrollTo({top:0,behavior:"smooth"});return}b(!1);const c=g.map((i,d)=>({variant:i,originalIndex:d})).filter(({variant:i})=>i.images.length>0).map(({variant:i,originalIndex:d})=>({variantId:i.id,variantIndex:d,files:i.images})),t={title:e.title,price:parseFloat(e.price),priceType:e.priceType,description:e.description,category:e.category,subCategory:e.subCategory,quantity:parseInt(e.quantity),outOfStock:e.outOfStock,brand:e.brand,color:e.color,locationIds:e.locationIds,productTag:e.productTag,marketplaceOptions:e.marketplaceOptions,pickupHours:e.pickupHours,deliveryDistance:e.deliveryDistance?parseFloat(e.deliveryDistance):void 0,shippingPrice:e.shippingPrice?parseFloat(e.shippingPrice):void 0,localDeliveryFree:e.localDeliveryFree,readyByDays:e.readyByDays?parseInt(e.readyByDays):void 0,dimensions:e.dimensions&&(e.dimensions.width||e.dimensions.length||e.dimensions.height)?{width:e.dimensions.width?parseFloat(e.dimensions.width):void 0,length:e.dimensions.length?parseFloat(e.dimensions.length):void 0,height:e.dimensions.height?parseFloat(e.dimensions.height):void 0}:void 0,discount:{discountType:e.discount.discountType,discountValue:e.discount.discountValue?parseFloat(e.discount.discountValue):void 0},variants:g.map((i,d)=>{const l=e.variants?.[d];return l?{color:l.color,quantity:parseInt(l.quantity),price:parseFloat(l.price),priceType:l.priceType||e.priceType||"sqft",outOfStock:l.outOfStock??!1,discount:{discountType:l.discount.discountType||"none",discountValue:l.discount.discountValue?parseFloat(l.discount.discountValue):void 0},images:i?.existingImages||[]}:null}).filter(Boolean),imageFiles:f.length>0?f:void 0,existingImages:v,variantFiles:c.length>0?c:void 0};try{console.log("mutationData",t),await q.mutateAsync({id:o,data:t}),a("/seller/products")}catch(i){console.error("Failed to update product:",i)}},ae=async()=>{const e=p.getValues();if(!e.title||e.title.trim().length===0){w.error("Title is required to save as draft"),p.setFocus("title"),p.setError("title",{message:"Title is required to save as draft"});return}if(!e.category||e.category.trim().length===0){w.error("Category is required to save as draft"),p.setFocus("category"),p.setError("category",{message:"Category is required to save as draft"});return}if(!e.price||e.price.trim().length===0){w.error("Price is required to save as draft"),p.setFocus("price"),p.setError("price",{message:"Price is required to save as draft"});return}if(v.length+f.length<2){b(!0),w.error("At least 2 images are required to save as draft"),window.scrollTo({top:0,behavior:"smooth"});return}b(!1);const c=g.map((i,d)=>({variant:i,index:d})).filter(({variant:i})=>i.images.length>0).map(({variant:i,index:d})=>({variantId:i.id,variantIndex:d,files:i.images})),t={id:o,title:e.title,imageFiles:f.length>0?f:void 0,existingImages:v};e.price&&e.price.trim()&&(t.price=e.price),e.priceType&&(t.priceType=e.priceType),e.description&&e.description.trim()&&(t.description=e.description),e.category&&e.category.trim()&&(t.category=e.category),e.subCategory&&e.subCategory.trim()&&(t.subCategory=e.subCategory),e.quantity&&e.quantity.trim()&&(t.quantity=e.quantity),e.brand&&e.brand.trim()&&(t.brand=e.brand),e.color&&e.color.trim()&&(t.color=e.color),e.locationIds&&e.locationIds.length>0&&(t.locationIds=e.locationIds),e.productTag&&e.productTag.length>0&&(t.productTag=e.productTag),e.marketplaceOptions&&(e.marketplaceOptions.pickup||e.marketplaceOptions.shipping||e.marketplaceOptions.delivery)&&(t.marketplaceOptions=e.marketplaceOptions),e.localDeliveryFree!==void 0&&(t.localDeliveryFree=e.localDeliveryFree),e.pickupHours&&e.pickupHours.trim()&&(t.pickupHours=e.pickupHours),e.shippingPrice&&e.shippingPrice.trim()&&(t.shippingPrice=e.shippingPrice),e.deliveryDistance&&e.deliveryDistance.trim()&&(t.deliveryDistance=e.deliveryDistance),e.readyByDays&&e.readyByDays.trim()&&(t.readyByDays=parseInt(e.readyByDays)),e.dimensions&&(e.dimensions.width||e.dimensions.length||e.dimensions.height)&&(t.dimensions={width:e.dimensions.width||"",length:e.dimensions.length||"",height:e.dimensions.height||""}),e.discount&&e.discount.discountType!=="none"&&e.discount.discountValue&&e.discount.discountValue.trim()&&(t.discount={discountType:e.discount.discountType,discountValue:e.discount.discountValue}),e.outOfStock!==void 0&&(t.outOfStock=e.outOfStock),g&&g.length>0&&(t.variants=g.map((i,d)=>{const l=e.variants?.[d];return l?{color:l.color,quantity:l.quantity,price:l.price,priceType:l.priceType||e.priceType||"sqft",outOfStock:l.outOfStock??!1,images:i?.existingImages||[],discount:l.discount?.discountType!=="none"&&l.discount?.discountValue&&l.discount.discountValue.trim()?{discountType:l.discount.discountType,discountValue:l.discount.discountValue}:{discountType:"none",discountValue:""}}:null}).filter(Boolean)),c.length>0&&(t.variantFiles=c);try{if(console.log("draftData",t),o){const i={...t,status:"draft",price:t.price?parseFloat(t.price):void 0,priceType:t.priceType,quantity:t.quantity?parseInt(t.quantity):void 0,outOfStock:t.outOfStock,shippingPrice:t.shippingPrice?parseFloat(t.shippingPrice):void 0,dimensions:t.dimensions?{width:t.dimensions.width?parseFloat(t.dimensions.width):void 0,length:t.dimensions.length?parseFloat(t.dimensions.length):void 0,height:t.dimensions.height?parseFloat(t.dimensions.height):void 0}:void 0,discount:t.discount?{discountType:t.discount.discountType,discountValue:t.discount.discountValue?parseFloat(t.discount.discountValue):void 0}:void 0,variants:t.variants?.map((d,l)=>{const E=g[l];return{color:d.color,quantity:parseInt(d.quantity||"0"),price:parseFloat(d.price||"0"),priceType:d.priceType,outOfStock:d.outOfStock,images:E?.existingImages||d.images||[],discount:{discountType:d.discount.discountType,discountValue:d.discount.discountValue?parseFloat(d.discount.discountValue):void 0}}})};delete i.id,await V.mutateAsync({id:o,...i})}else await V.mutateAsync(t);a("/seller/products")}catch(i){console.error("Failed to save draft:",i)}},ke=async e=>{try{await se.mutateAsync(e),await ye(),H(!1)}catch(n){console.error("Failed to add address:",n),w.error("Failed to add address")}},Pe=()=>{if(g.length>=5){w.error("Maximum 5 variants allowed");return}const e={id:Date.now().toString(),images:[],color:"#000000",existingImages:[]};j([...g,e]),P(!0);const n=g.length;y(`variants.${n}.color`,""),y(`variants.${n}.discount.discountType`,"none"),y(`variants.${n}.quantity`,""),y(`variants.${n}.price`,""),y(`variants.${n}.priceType`,x.priceType||"sqft"),y(`variants.${n}.discount.discountValue`,"")},De=e=>{const n=g.findIndex(d=>d.id===e),c=g.filter(d=>d.id!==e);j(c);const i=(p.getValues("variants")||[]).filter((d,l)=>l!==n);y("variants",i),n!==-1&&p.clearErrors(`variants.${n}`),c.length===0&&(P(!1),y("variants",[]))},R=h.useCallback(async(e,n)=>{const c=g.find(l=>l.id===e);if(!c)return;const t=5,{validFiles:i,errors:d}=await U(n,t,c.images.length);i.length>0&&j(g.map(l=>l.id===e?{...l,images:[...l.images,...i]}:l)),d.forEach(l=>w.error(l))},[g]),Fe=(e,n)=>{j(g.map(c=>c.id===e?{...c,images:c.images.filter((t,i)=>i!==n)}:c))},Ce=(e,n)=>{j(g.map(c=>c.id===e?{...c,existingImages:c.existingImages?.filter((t,i)=>i!==n)||[]}:c))},Ie=h.useCallback((e,n)=>{e.preventDefault(),e.stopPropagation(),e.type==="dragenter"||e.type==="dragover"?$(n):e.type==="dragleave"&&$(null)},[]),qe=h.useCallback((e,n)=>{if(e.preventDefault(),e.stopPropagation(),$(null),e.dataTransfer.files&&e.dataTransfer.files[0]){const c=Array.from(e.dataTransfer.files);R(n,c)}},[R]);return fe?s.jsx(Ze,{}):s.jsxs(He,{...p,children:[s.jsxs("div",{className:"h-screen bg-gray-50 fixed top-0 w-full z-50 left-0 flex flex-col",children:[s.jsx("div",{className:"bg-primary px-4 py-3",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[s.jsx("button",{onClick:()=>a(-1),className:"text-white hover:bg-white  hover:text-black p-1 rounded cursor-pointer",children:s.jsx(_e,{className:"h-5 w-5 sm:h-6 sm:w-6"})}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-blue-100",children:"Marketplace"}),s.jsx("div",{className:"text-white text-sm sm:text-base font-medium",children:"Edit Product"})]})]}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsx(re,{type:"button",onClick:()=>{C?.data?.status==="draft"?ae():_(!0)},variant:"ghost",className:"text-white hover:bg-white border border-white h-[40px] sm:h-[48px] text-sm sm:text-base hover:text-primary px-3 sm:px-4",disabled:q.isPending||V.isPending,children:q.isPending||V.isPending?"Saving...":"Save Draft"})})]})}),s.jsx("div",{className:"lg:hidden fixed bottom-4 right-4 z-50",children:!D&&s.jsx(re,{type:"button",onClick:()=>J(!D),className:"bg-primary text-white p-3 shadow-sm hover:bg-primary/90 rounded-sm flex gap-3 w-fit h-10",children:D?s.jsxs(s.Fragment,{children:[s.jsx("span",{children:"Hide Preview "})," ",s.jsx(Le,{className:"h-6 w-6"})]}):s.jsxs(s.Fragment,{children:[s.jsx("span",{children:"Show Preview "})," ",s.jsx(Qe,{className:"h-6 w-6"})]})})}),D&&s.jsx("div",{className:"lg:hidden fixed inset-0 z-[100] bg-white overflow-y-auto",children:s.jsx("div",{className:"min-h-screen",children:s.jsx(le,{handleBackClick:()=>J(!1),formValues:x,uploadedPhotos:f,existingImages:v,addressOptions:z,savedAddresses:O,variants:g,categoryOptions:T,subCategoryOptions:Q,tagOptions:G})})}),s.jsxs("form",{id:"product-form",onSubmit:ve(Te),className:"flex-1 flex flex-col lg:flex-row gap-4 p-4 mx-auto overflow-hidden min-h-0 w-full",children:[s.jsx("div",{className:"w-full lg:max-w-[450px] h-full",children:s.jsx(Xe,{methods:p,uploadedPhotos:f,setUploadedPhotos:k,existingImages:v,removeExistingImage:Ve,imageError:ue,setImageError:b,addressOptions:z,showAddAddressModal:ee,setShowAddAddressModal:H,variants:g,showVariants:pe,setShowVariants:P,handleDrag:be,handleDrop:je,handleFileChange:Ne,removePhoto:Se,addVariant:Pe,removeVariant:De,handleVariantImageUpload:R,removeVariantImage:Fe,removeExistingVariantImage:Ce,handleVariantDrag:Ie,handleVariantDrop:qe,dragActive:de,variantDragActive:me,MAX_IMAGES:K,categoryOptions:T,subCategoryOptions:Q,tagOptions:G,isLoading:q.isPending})}),s.jsx("div",{className:"w-full lg:flex-1 hidden lg:block h-full",children:s.jsx(le,{formValues:x,uploadedPhotos:f,existingImages:v,addressOptions:z,savedAddresses:O,variants:g,categoryOptions:T,subCategoryOptions:Q,tagOptions:G})})]})]}),s.jsx(ze,{isOpen:ee,onClose:()=>H(!1),onSubmit:ke,isSubmitting:se.isPending,totalAddress:O.length!==0}),s.jsx(Re,{isOpen:he,onClose:()=>_(!1),onConfirm:()=>{_(!1),ae()},title:"Save as Draft?",description:s.jsxs("div",{className:"text-gray-600",children:[s.jsx("p",{className:"mb-2",children:"Saving this product as a draft will:"}),s.jsxs("ul",{className:"text-left list-disc list-inside space-y-1 text-sm",children:[s.jsx("li",{children:"Remove it from your active listings"}),s.jsx("li",{children:"Make it invisible to buyers"}),s.jsx("li",{children:"Allow you to edit and publish it later"})]}),s.jsx("p",{className:"mt-3 font-medium",children:"Are you sure you want to continue?"})]}),confirmText:"Yes, Save as Draft",cancelText:"Cancel",isLoading:V.isPending})]})}export{gs as default};
