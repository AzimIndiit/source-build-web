import{j as s,S as o,u as ke,ay as Se,r as h,ao as Ve,ap as Fe,o as Ce,p as Ie,I as f,F as qe,a1 as De,B as Z,aT as Ae,aU as Ee,au as Be,E as N,A as u,_ as ee,ai as M,$ as H}from"./index-BCiIUrXb.js";import{v as _,P as J,a as $e}from"./imageValidation-C4rbLUvl.js";import{e as Oe,f as Me,c as He}from"./useProductMutations-BwEQtzFr.js";import{f as Y}from"./format-K4P4TTu3.js";import"./FormSelect-prL940lU.js";import"./index-BdQq_4o_.js";import"./badge-C6OOTzUs.js";import"./PickupHoursSelector-BvNq3gU7.js";import"./upload-Brfr3HgH.js";import"./trash-2-Ct1NlBzh.js";import"./calendar-D77CX2lA.js";import"./en-US-BQ62IwJd.js";const _e=()=>s.jsxs("div",{className:"h-screen bg-gray-50 fixed top-0 w-full z-50 left-0 flex flex-col",children:[s.jsx("div",{className:"bg-primary px-4 py-3",children:s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[s.jsx(o,{className:"h-6 w-6 rounded bg-white/20"}),s.jsxs("div",{children:[s.jsx(o,{className:"h-3 w-20 mb-1 bg-white/20"}),s.jsx(o,{className:"h-4 w-24 bg-white/20"})]})]})})}),s.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row gap-4 p-4 mx-auto overflow-hidden min-h-0 w-full",children:[s.jsx("div",{className:"w-full lg:max-w-[450px] h-full",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 h-full overflow-y-auto space-y-6",children:[s.jsxs("div",{className:"space-y-3",children:[s.jsx(o,{className:"h-5 w-20"}),s.jsx(o,{className:"w-full h-48 rounded-lg border-2 border-dashed"}),s.jsx("div",{className:"flex gap-2",children:Array.from({length:3}).map((t,d)=>s.jsx(o,{className:"w-16 h-16 rounded"},d))})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{className:"h-4 w-16"}),s.jsx(o,{className:"h-10 w-full rounded"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{className:"h-4 w-12"}),s.jsx(o,{className:"h-10 w-full rounded"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{className:"h-4 w-20"}),s.jsx(o,{className:"h-24 w-full rounded"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{className:"h-4 w-16"}),s.jsx(o,{className:"h-10 w-full rounded"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{className:"h-4 w-20"}),s.jsx(o,{className:"h-10 w-full rounded"})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{className:"h-4 w-16"}),s.jsx(o,{className:"h-10 w-full rounded"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{className:"h-4 w-12"}),s.jsx(o,{className:"h-10 w-full rounded"})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{className:"h-4 w-12"}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(o,{className:"h-10 w-20 rounded"}),s.jsx(o,{className:"w-10 h-10 rounded-full"})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{className:"h-4 w-16"}),s.jsx(o,{className:"h-10 w-full rounded"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{className:"h-4 w-16"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:Array.from({length:4}).map((t,d)=>s.jsx(o,{className:"h-6 w-16 rounded-full"},d))})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx(o,{className:"h-4 w-32"}),s.jsx("div",{className:"space-y-2",children:Array.from({length:3}).map((t,d)=>s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(o,{className:"w-4 h-4 rounded"}),s.jsx(o,{className:"h-4 w-20"})]},d))})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{className:"h-4 w-20"}),s.jsx(o,{className:"h-10 w-full rounded"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{className:"h-4 w-16"}),s.jsx(o,{className:"h-10 w-full rounded"})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx(o,{className:"h-4 w-16"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(o,{className:"h-10 w-full rounded"}),s.jsx(o,{className:"h-10 w-full rounded"})]})]}),s.jsx("div",{className:"pt-4",children:s.jsx(o,{className:"h-12 w-full rounded"})})]})]})}),s.jsx("div",{className:"w-full lg:flex-1 hidden lg:block h-full",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 h-full overflow-y-auto",children:[s.jsx(o,{className:"h-6 w-32 mb-6"}),s.jsx(o,{className:"w-full h-64 rounded-lg mb-6"}),s.jsxs("div",{className:"space-y-4",children:[s.jsx(o,{className:"h-8 w-full"}),s.jsx(o,{className:"h-6 w-32"}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{className:"h-4 w-full"}),s.jsx(o,{className:"h-4 w-3/4"}),s.jsx(o,{className:"h-4 w-1/2"})]}),s.jsx("div",{className:"flex gap-2",children:Array.from({length:3}).map((t,d)=>s.jsx(o,{className:"h-6 w-16 rounded-full"},d))})]})]})})]})]}),Le=N({color:u().trim().min(1,"Color is required").regex(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,"Please enter a valid HEX color code"),quantity:u().trim().min(1,"Quantity is required").regex(/^\d+$/,"Quantity must be a whole number").refine(t=>parseInt(t)>0,"Quantity must be at least 1"),price:u().trim().min(1,"Price is required").regex(/^\d+(\.\d{1,2})?$/,"Price must be a valid number").refine(t=>parseFloat(t)>0,"Price must be greater than 0"),discount:N({discountType:ee(["none","flat","percentage"]),discountValue:u().optional()}).refine(t=>t.discountType!=="none"?t.discountValue&&t.discountValue.trim().length>0:!0,{message:"Discount value is required when discount type is selected",path:["discountValue"]}).refine(t=>{if(t.discountType==="percentage"&&t.discountValue){const d=parseFloat(t.discountValue);return!isNaN(d)&&d>=0&&d<=100}return!0},{message:"Percentage discount must be between 0 and 100",path:["discountValue"]}).refine(t=>{if(t.discountType==="flat"&&t.discountValue){const d=parseFloat(t.discountValue);return!isNaN(d)&&d>=0}return!0},{message:"Flat discount must be a positive number",path:["discountValue"]})}),Qe=N({title:u().trim().min(3,"Title must be at least 3 characters").max(100,"Title must not exceed 100 characters"),price:u().trim().min(1,"Price is required").regex(/^\d+(\.\d{1,2})?$/,"Price must be a valid number with up to 2 decimal places").refine(t=>parseFloat(t)>0,"Price must be greater than 0").refine(t=>parseFloat(t)<=999999.99,"Price must not exceed 999,999.99"),description:u().trim().min(10,"Description must be at least 10 characters").max(2e3,"Description must not exceed 2000 characters"),category:u().trim().min(1,"Category is required").max(50,"Category must not exceed 50 characters"),subCategory:u().trim().min(1,"Sub category is required").max(50,"Sub category must not exceed 50 characters"),quantity:u().trim().min(1,"Quantity is required").regex(/^\d+$/,"Quantity must be a whole number").refine(t=>parseInt(t)>0,"Quantity must be at least 1").refine(t=>parseInt(t)<=99999,"Quantity must not exceed 99,999"),brand:u().trim().min(2,"Brand must be at least 2 characters").max(50,"Brand must not exceed 50 characters").regex(/^[a-zA-Z0-9\s\-&.]+$/,"Brand can only contain letters, numbers, spaces, hyphens, ampersands, and periods"),color:u().trim().min(1,"Color is required").regex(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,"Please enter a valid HEX color code (e.g., #FF0000)"),locationIds:H(u()).min(1,"At least one location is required").max(10,"Maximum 10 locations allowed"),productTag:H(u().trim().min(2,"Each tag must be at least 2 characters").max(30,"Each tag must not exceed 30 characters").regex(/^[a-zA-Z0-9\s\-#]+$/,"Tags can only contain letters, numbers, spaces, hyphens, and hashtags")).min(1,"At least one product tag is required").max(10,"Maximum 10 tags allowed"),variants:H(Le).max(5,"Maximum 5 variants allowed").optional(),marketplaceOptions:N({pickup:M().optional(),shipping:M().optional(),delivery:M().optional()}).required().refine(t=>t.pickup||t.shipping||t.delivery,{message:"At least one marketplace option (Pickup, Shipping, or Delivery) must be selected"}),pickupHours:u().trim().max(100,"Pickup hours must not exceed 100 characters").optional(),shippingPrice:u().trim().optional(),readyByDate:u().min(1,"Date is required"),readyByTime:u().min(1,"Time is required"),dimensions:N({width:u().optional(),length:u().optional(),height:u().optional()}).optional(),discount:N({discountType:ee(["none","flat","percentage"]),discountValue:u().optional()}).refine(t=>t.discountType!=="none"?t.discountValue&&t.discountValue.trim().length>0:!0,{message:"Discount value is required when discount type is selected",path:["discountValue"]}).refine(t=>{if(t.discountType==="percentage"&&t.discountValue){const d=parseFloat(t.discountValue);return!isNaN(d)&&d>=0&&d<=100}return!0},{message:"Percentage discount must be between 0 and 100",path:["discountValue"]}).refine(t=>{if(t.discountType==="flat"&&t.discountValue){const d=parseFloat(t.discountValue);return!isNaN(d)&&d>=0}return!0},{message:"Flat discount must be a positive number",path:["discountValue"]})}).refine(t=>!(t.marketplaceOptions?.pickup&&!t.pickupHours?.trim()),{message:"Pickup hours are required when pickup option is selected",path:["pickupHours"]}).refine(t=>!(t.marketplaceOptions?.shipping&&!t.shippingPrice?.trim()),{message:"Shipping price is required when shipping option is selected",path:["shippingPrice"]}).refine(t=>{if(t.marketplaceOptions?.shipping&&t.shippingPrice?.trim()){if(!/^\d+(\.\d{1,2})?$/.test(t.shippingPrice))return!1;const m=parseFloat(t.shippingPrice);if(isNaN(m)||m<0)return!1}return!0},{message:"Shipping price must be a valid positive number",path:["shippingPrice"]}).superRefine((t,d)=>{t.marketplaceOptions?.pickup&&!t.pickupHours?.trim()&&d.addIssue({code:"custom",path:["pickupHours"],message:"Pickup hours are required when pickup option is selected"}),t.marketplaceOptions?.shipping&&(t.shippingPrice?.trim()?/^\d+(\.\d{1,2})?$/.test(t.shippingPrice)?parseFloat(t.shippingPrice)<0&&d.addIssue({code:"custom",path:["shippingPrice"],message:"Shipping price must be greater than or equal to 0"}):d.addIssue({code:"custom",path:["shippingPrice"],message:"Shipping price must be a valid number with up to 2 decimals"}):d.addIssue({code:"custom",path:["shippingPrice"],message:"Shipping price is required when shipping option is selected"}))}),I=[{value:"electronics",label:"Electronics"},{value:"clothing",label:"Clothing"},{value:"home",label:"Home & Garden"},{value:"sports",label:"Sports & Outdoors"},{value:"accessories",label:"Accessories"},{value:"commercial",label:"Commercial"},{value:"commercial doors",label:"Commercial Doors"}],L={electronics:[{value:"phones",label:"Phones"},{value:"laptops",label:"Laptops"},{value:"tablets",label:"Tablets"},{value:"headphones",label:"Headphones"},{value:"cameras",label:"Cameras"},{value:"accessories",label:"Accessories"}],clothing:[{value:"mens",label:"Men's Clothing"},{value:"womens",label:"Women's Clothing"},{value:"kids",label:"Kids' Clothing"},{value:"shoes",label:"Shoes"},{value:"accessories",label:"Accessories"}],home:[{value:"furniture",label:"Furniture"},{value:"decor",label:"Decor"},{value:"kitchen",label:"Kitchen"},{value:"bathroom",label:"Bathroom"},{value:"garden",label:"Garden"}],sports:[{value:"fitness",label:"Fitness Equipment"},{value:"outdoor",label:"Outdoor Gear"},{value:"sportswear",label:"Sportswear"},{value:"accessories",label:"Accessories"}],accessories:[{value:"jewelry",label:"Jewelry"},{value:"bags",label:"Bags"},{value:"watches",label:"Watches"},{value:"belts",label:"Belts"},{value:"other",label:"Other"}],commercial:[{value:"equipment",label:"Equipment"},{value:"supplies",label:"Supplies"},{value:"furniture",label:"Furniture"},{value:"tools",label:"Tools"}],"commercial doors":[{value:"doors",label:"Doors"},{value:"windows",label:"Windows"},{value:"glass doors",label:"Glass Doors"},{value:"frames",label:"Frames"},{value:"hardware",label:"Hardware"}]},Q=[{value:"casing",label:"Casing"},{value:"trim",label:"Trim"},{value:"molding",label:"Molding"},{value:"hardware",label:"Hardware"},{value:"doors",label:"Doors"},{value:"windows",label:"Windows"},{value:"glass",label:"Glass"},{value:"locks",label:"Locks"},{value:"hinges",label:"Hinges"},{value:"frames",label:"Frames"},{value:"panels",label:"Panels"},{value:"handles",label:"Handles"}],R=5;function as(){const t=ke(),{id:d}=Se(),[m,T]=h.useState([]),[y,z]=h.useState([]),[se,q]=h.useState(!1),[ae,x]=h.useState(!1),[g,j]=h.useState([]),[te,k]=h.useState(!1),[ie,D]=h.useState(null),[G,re]=h.useState(!1),[S,U]=h.useState(!1),[W,A]=h.useState(!1),{data:V,isLoading:oe}=Oe(d||""),{data:F,refetch:ne}=Ve(),X=Fe(),P=Me(),le=He(),C=Array.isArray(F?.data)?F.data:F?.data?[F.data]:[],E=C.map(e=>({value:e.id||e._id||"",label:`${e.name} , ${e.formattedAddress}`||""})),p=Ce({resolver:Ie(Qe),mode:"onChange",reValidateMode:"onChange",defaultValues:{title:"",price:"",description:"",category:"",subCategory:"",quantity:"",brand:"",color:"#000000",locationIds:[],productTag:[],variants:[],marketplaceOptions:{pickup:!1,shipping:!1,delivery:!1},pickupHours:"",shippingPrice:"",readyByDate:"",readyByTime:"",dimensions:{width:"",length:"",height:""},discount:{discountType:"none",discountValue:""}}}),{handleSubmit:ce,watch:de,reset:K,setValue:b}=p,w=de(),B=w.category?L[w.category]||[]:[];h.useEffect(()=>{if(G)if(w.category){const e=w.subCategory;!(L[w.category]||[]).some(n=>n.value===e)&&e&&b("subCategory","")}else b("subCategory","")},[w.category,b,G]),h.useEffect(()=>{if(V?.data){const e=V.data;console.log("Product data:",e),console.log("Product category:",e.category),console.log("Product subCategory:",e.subCategory),e.images&&e.images.length>0&&z(e.images);let c="",l="";if(e.readyByDate)try{const i=new Date(e.readyByDate);c=Y(i,"yyyy-MM-dd"),l=Y(i,"HH:mm")}catch(i){console.error("Error parsing date:",i)}let n=e.category||"",a=e.subCategory||"";if(n){const i=I.find(v=>v.value.toLowerCase()===n.toLowerCase());i?n=i.value:console.warn(`Category "${e.category}" not found in predefined options, keeping original value`)}if(n){const i=L[n]||[];if(console.log(`Subcategory options for category "${n}":`,i),console.log(`Original subcategory value: "${a}"`),a)if(i.length>0){const v=i.find(O=>O.value.toLowerCase()===a.toLowerCase());v?(console.log(`Found matching subcategory: "${v.value}"`),a=v.value):console.warn(`SubCategory "${e.subCategory}" not found for category "${n}", keeping original value`)}else console.log(`No subcategory options available for category "${n}", keeping value: "${a}"`)}console.log("Final category value:",n),console.log("Final subcategory value:",a);const r={title:e.title||"",price:e.price?.toString()||"",description:e.description||"",category:n,subCategory:a,quantity:e.quantity?.toString()||"",brand:e.brand||"",color:e.color||"#000000",locationIds:e.locationIds?.map(i=>typeof i=="string"?i:i._id||i.id)||[],productTag:e.productTag||[],variants:e.variants?.map(i=>({color:i.color,quantity:i.quantity?.toString()||"",price:i.price?.toString()||"",discount:{discountType:i.discount?.discountType||"none",discountValue:i.discount?.discountValue?.toString()||""}}))||[],marketplaceOptions:{pickup:e.marketplaceOptions?.pickup||!1,shipping:e.marketplaceOptions?.shipping||!1,delivery:e.marketplaceOptions?.delivery||!1},pickupHours:e.pickupHours||"",shippingPrice:e.shippingPrice?.toString()||"",readyByDate:c,readyByTime:l,dimensions:{width:e.dimensions?.width?.toString()||"",length:e.dimensions?.length?.toString()||"",height:e.dimensions?.height?.toString()||""},discount:{discountType:e.discount?.discountType||"none",discountValue:e.discount?.discountValue?.toString()||""}};console.log("Form data being set:",r),K(r),setTimeout(()=>{console.log("Setting form values after delay - category:",n,"subcategory:",a),p.setValue("category",n),p.setValue("subCategory",a),p.clearErrors(["category","subCategory"]),setTimeout(()=>{p.trigger(["category","subCategory"])},50)},100),e.variants&&e.variants.length>0&&(k(!0),j(e.variants.map((i,v)=>({id:i.id||i._id||`variant-${v}-${Date.now()}`,images:[],existingImages:i.images||[]})))),setTimeout(()=>{p.clearErrors();const i=p.getValues();console.log("Form values after reset:",i),p.trigger(),re(!0)},200)}},[V,K,p]);const ue=h.useCallback(e=>{e.preventDefault(),e.stopPropagation(),e.type==="dragenter"||e.type==="dragover"?q(!0):e.type==="dragleave"&&q(!1)},[]),pe=h.useCallback(async e=>{if(e.preventDefault(),e.stopPropagation(),q(!1),e.dataTransfer.files&&e.dataTransfer.files[0]){const c=Array.from(e.dataTransfer.files),l=y.length+m.length,{validFiles:n,errors:a}=await _(c,R,l);n.length>0&&(T(r=>[...r,...n]),x(!1)),a.forEach(r=>f.error(r))}},[m,y]),me=async e=>{if(e.target.files){const c=Array.from(e.target.files),l=y.length+m.length,{validFiles:n,errors:a}=await _(c,R,l);n.length>0&&(T(r=>[...r,...n]),x(!1)),a.forEach(r=>f.error(r)),e.target.value=""}},ge=e=>{T(c=>c.filter((l,n)=>n!==e))},he=e=>{z(c=>c.filter((l,n)=>n!==e))},fe=async e=>{if(y.length+m.length<2){x(!0),f.error("Please keep at least 2 product images"),window.scrollTo({top:0,behavior:"smooth"});return}x(!1);const l=g.filter(r=>r.images.length>0).map((r,i)=>({variantId:r.id,variantIndex:i,files:r.images}));let n;if(e.readyByDate){const r=e.readyByTime||"00:00";n=new Date(`${e.readyByDate}T${r}:00`).toISOString()}const a={title:e.title,price:parseFloat(e.price),description:e.description,category:e.category,subCategory:e.subCategory,quantity:parseInt(e.quantity),brand:e.brand,color:e.color,locationIds:e.locationIds,productTag:e.productTag,marketplaceOptions:e.marketplaceOptions,pickupHours:e.pickupHours,shippingPrice:e.shippingPrice?parseFloat(e.shippingPrice):void 0,readyByDate:n,readyByTime:e.readyByTime,dimensions:e.dimensions&&(e.dimensions.width||e.dimensions.length||e.dimensions.height)?{width:e.dimensions.width?parseFloat(e.dimensions.width):void 0,length:e.dimensions.length?parseFloat(e.dimensions.length):void 0,height:e.dimensions.height?parseFloat(e.dimensions.height):void 0}:void 0,discount:{discountType:e.discount.discountType,discountValue:e.discount.discountValue?parseFloat(e.discount.discountValue):void 0},variants:e.variants?.map((r,i)=>{const v=g[i];return{color:r.color,quantity:parseInt(r.quantity),price:parseFloat(r.price),discount:{discountType:r.discount.discountType,discountValue:r.discount.discountValue?parseFloat(r.discount.discountValue):void 0},images:v?.existingImages||[]}}),imageFiles:m.length>0?m:void 0,existingImages:y,variantFiles:l.length>0?l:void 0};try{await P.mutateAsync({id:d,data:a}),t("/seller/products")}catch(r){console.error("Failed to update product:",r)}},ye=async()=>{const e=p.getValues();if(!e.title||e.title.trim().length===0){f.error("Title is required to save as draft"),p.setFocus("title"),p.setError("title",{message:"Title is required to save as draft"});return}if(!e.category||e.category.trim().length===0){f.error("Category is required to save as draft"),p.setFocus("category"),p.setError("category",{message:"Category is required to save as draft"});return}if(!e.price||e.price.trim().length===0){f.error("Price is required to save as draft"),p.setFocus("price"),p.setError("price",{message:"Price is required to save as draft"});return}if(y.length+m.length<2){x(!0),f.error("At least 2 images are required to save as draft"),window.scrollTo({top:0,behavior:"smooth"});return}x(!1);const l=g.map((r,i)=>({variant:r,index:i})).filter(({variant:r})=>r.images.length>0).map(({variant:r,index:i})=>({variantId:r.id,variantIndex:i,files:r.images}));let n;if(e.readyByDate){const r=e.readyByTime||"00:00";n=new Date(`${e.readyByDate}T${r}:00`).toISOString()}const a={id:d,title:e.title,imageFiles:m.length>0?m:void 0,existingImages:y};e.price&&e.price.trim()&&(a.price=e.price),e.description&&e.description.trim()&&(a.description=e.description),e.category&&e.category.trim()&&(a.category=e.category),e.subCategory&&e.subCategory.trim()&&(a.subCategory=e.subCategory),e.quantity&&e.quantity.trim()&&(a.quantity=e.quantity),e.brand&&e.brand.trim()&&(a.brand=e.brand),e.color&&e.color.trim()&&(a.color=e.color),e.locationIds&&e.locationIds.length>0&&(a.locationIds=e.locationIds),e.productTag&&e.productTag.length>0&&(a.productTag=e.productTag),e.marketplaceOptions&&(e.marketplaceOptions.pickup||e.marketplaceOptions.shipping||e.marketplaceOptions.delivery)&&(a.marketplaceOptions=e.marketplaceOptions),e.pickupHours&&e.pickupHours.trim()&&(a.pickupHours=e.pickupHours),e.shippingPrice&&e.shippingPrice.trim()&&(a.shippingPrice=e.shippingPrice),n&&(a.readyByDate=n,a.readyByTime=e.readyByTime),e.dimensions&&(e.dimensions.width||e.dimensions.length||e.dimensions.height)&&(a.dimensions=e.dimensions),e.discount&&e.discount.discountType!=="none"&&(a.discount={discountType:e.discount.discountType,discountValue:e.discount.discountValue||""}),e.variants&&e.variants.length>0&&(a.variants=e.variants.map(r=>({...r,discount:{discountType:r.discount.discountType,discountValue:r.discount.discountValue||""}}))),l.length>0&&(a.variantFiles=l);try{if(d){const r={...a,status:"draft",price:a.price?parseFloat(a.price):void 0,quantity:a.quantity?parseInt(a.quantity):void 0,shippingPrice:a.shippingPrice?parseFloat(a.shippingPrice):void 0,dimensions:a.dimensions?{width:a.dimensions.width?parseFloat(a.dimensions.width):void 0,length:a.dimensions.length?parseFloat(a.dimensions.length):void 0,height:a.dimensions.height?parseFloat(a.dimensions.height):void 0}:void 0,discount:a.discount?{discountType:a.discount.discountType,discountValue:a.discount.discountValue?parseFloat(a.discount.discountValue):void 0}:void 0,variants:a.variants?.map(i=>({color:i.color,quantity:parseInt(i.quantity||"0"),price:parseFloat(i.price||"0"),discount:{discountType:i.discount.discountType,discountValue:i.discount.discountValue?parseFloat(i.discount.discountValue):void 0}}))};delete r.id,await P.mutateAsync({id:d,data:r})}else await le.mutateAsync(a);t("/seller/products")}catch(r){console.error("Failed to save draft:",r)}},ve=e=>{if(console.log("Form errors:",e),y.length+m.length<2){x(!0),f.error("Please keep at least 2 product images"),setTimeout(()=>{const n=document.getElementById("photos");if(n){const a=n.closest(".overflow-y-auto");if(a){const r=n.getBoundingClientRect(),i=a.getBoundingClientRect();a.scrollTop+=r.top-i.top-100}else n.scrollIntoView({behavior:"smooth",block:"start"})}},100);return}const l=Object.keys(e)[0];if(l){const n=e[l];n?.message&&f.error(n.message),setTimeout(()=>{const a=document.querySelector(`[name="${l}"]`);if(a){const r=a.closest(".overflow-y-auto");if(r){const i=a.getBoundingClientRect(),v=r.getBoundingClientRect(),O=r.scrollTop+i.top-v.top-100;r.scrollTo({top:O,behavior:"smooth"}),setTimeout(()=>{a.focus()},500)}else a.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{a.focus()},500)}},100)}},xe=async e=>{try{await X.mutateAsync(e),await ne(),A(!1)}catch(c){console.error("Failed to add address:",c),f.error("Failed to add address")}},be=()=>{if(g.length>=5){f.error("Maximum 5 variants allowed");return}const e={id:Date.now().toString(),images:[],existingImages:[]};j([...g,e]),k(!0);const c=g.length;b(`variants.${c}.color`,"#000000"),b(`variants.${c}.discount.discountType`,"none"),b(`variants.${c}.quantity`,""),b(`variants.${c}.price`,""),b(`variants.${c}.discount.discountValue`,"")},we=e=>{const c=g.findIndex(l=>l.id===e);j(g.filter(l=>l.id!==e)),c!==-1&&p.clearErrors(`variants.${c}`),g.length<=1&&k(!1)},$=h.useCallback(async(e,c)=>{const l=g.find(i=>i.id===e);if(!l)return;const n=5,{validFiles:a,errors:r}=await _(c,n,l.images.length);a.length>0&&j(g.map(i=>i.id===e?{...i,images:[...i.images,...a]}:i)),r.forEach(i=>f.error(i))},[g]),je=(e,c)=>{j(g.map(l=>l.id===e?{...l,images:l.images.filter((n,a)=>a!==c)}:l))},Ne=(e,c)=>{j(g.map(l=>l.id===e?{...l,existingImages:l.existingImages?.filter((n,a)=>a!==c)||[]}:l))},Pe=h.useCallback((e,c)=>{e.preventDefault(),e.stopPropagation(),e.type==="dragenter"||e.type==="dragover"?D(c):e.type==="dragleave"&&D(null)},[]),Te=h.useCallback((e,c)=>{if(e.preventDefault(),e.stopPropagation(),D(null),e.dataTransfer.files&&e.dataTransfer.files[0]){const l=Array.from(e.dataTransfer.files);$(c,l)}},[$]);return oe?s.jsx(_e,{}):s.jsxs(qe,{...p,children:[s.jsxs("div",{className:"h-screen bg-gray-50 fixed top-0 w-full z-50 left-0 flex flex-col",children:[s.jsx("div",{className:"bg-primary px-4 py-3",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[s.jsx("button",{onClick:()=>t(-1),className:"text-white hover:bg-white  hover:text-black p-1 rounded cursor-pointer",children:s.jsx(De,{className:"h-5 w-5 sm:h-6 sm:w-6"})}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-blue-100",children:"Marketplace"}),s.jsx("div",{className:"text-white text-sm sm:text-base font-medium",children:"Edit Product"})]})]}),V?.data?.status==="draft"&&s.jsx("div",{className:"flex items-center gap-2",children:s.jsx(Z,{type:"button",onClick:ye,variant:"ghost",className:"text-white hover:bg-white border border-white h-[40px] sm:h-[48px] text-sm sm:text-base hover:text-primary px-3 sm:px-4",disabled:P.isPending,children:P.isPending?"Saving...":"Save Draft"})})]})}),s.jsx("div",{className:"lg:hidden fixed bottom-4 right-4 z-50",children:!S&&s.jsx(Z,{type:"button",onClick:()=>U(!S),className:"bg-primary text-white p-3 shadow-sm hover:bg-primary/90 rounded-sm flex gap-3 w-fit h-10",children:S?s.jsxs(s.Fragment,{children:[s.jsx("span",{children:"Hide Preview "})," ",s.jsx(Ae,{className:"h-6 w-6"})]}):s.jsxs(s.Fragment,{children:[s.jsx("span",{children:"Show Preview "})," ",s.jsx(Ee,{className:"h-6 w-6"})]})})}),S&&s.jsx("div",{className:"lg:hidden fixed inset-0 z-[100] bg-white overflow-y-auto",children:s.jsx("div",{className:"min-h-screen",children:s.jsx(J,{handleBackClick:()=>U(!1),formValues:w,uploadedPhotos:m,existingImages:y,addressOptions:E,savedAddresses:C,variants:g,categoryOptions:I,subCategoryOptions:B,tagOptions:Q})})}),s.jsxs("form",{id:"product-form",onSubmit:ce(fe,ve),className:"flex-1 flex flex-col lg:flex-row gap-4 p-4 mx-auto overflow-hidden min-h-0 w-full",children:[s.jsx("div",{className:"w-full lg:max-w-[450px] h-full",children:s.jsx($e,{methods:p,uploadedPhotos:m,setUploadedPhotos:T,existingImages:y,removeExistingImage:he,imageError:ae,setImageError:x,addressOptions:E,showAddAddressModal:W,setShowAddAddressModal:A,variants:g,showVariants:te,setShowVariants:k,handleDrag:ue,handleDrop:pe,handleFileChange:me,removePhoto:ge,addVariant:be,removeVariant:we,handleVariantImageUpload:$,removeVariantImage:je,removeExistingVariantImage:Ne,handleVariantDrag:Pe,handleVariantDrop:Te,dragActive:se,variantDragActive:ie,MAX_IMAGES:R,categoryOptions:I,subCategoryOptions:B,tagOptions:Q,isLoading:P.isPending})}),s.jsx("div",{className:"w-full lg:flex-1 hidden lg:block h-full",children:s.jsx(J,{formValues:w,uploadedPhotos:m,existingImages:y,addressOptions:E,savedAddresses:C,variants:g,categoryOptions:I,subCategoryOptions:B,tagOptions:Q})})]})]}),s.jsx(Be,{isOpen:W,onClose:()=>A(!1),onSubmit:xe,isSubmitting:X.isPending,totalAddress:C.length!==0})]})}export{as as default};
