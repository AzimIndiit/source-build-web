import{r as b,j as e,C as F,ah as L,b as S,L as H,aN as Z,B,d as _,e as z,E as I,a1 as Y,aq as J,ar as V,as as G,at as ee,F as ae,f as A,h as te,aZ as se,a8 as Q,a7 as ne,H as j,K as h,J as ce,t as D,z as m,w as y,aE as oe,ai as re,aO as le,ap as ue}from"./index-BiCr9dd_.js";import{T as de}from"./trash-2-BSx2CMeK.js";import{F as ie}from"./FormSelect-B-UjWW9p.js";import{M as me}from"./ManageBankAccountsSkeleton-C8V7MDwX.js";import"./index-BdQq_4o_.js";import"./badge-gylWw4eT.js";const xe=({id:t,accountHolder:a,accountNumber:n,bankName:s,onEdit:r,onDelete:l,onToggleDefault:o,className:d,isDefault:x,totalBankAccount:N})=>{const[f,g]=b.useState(!1),p=async i=>{if(!f&&i&&o){g(!0);try{await o(t,i)}catch(k){console.error("Failed to update default status:",k)}finally{g(!1)}}};return console.log("isDefault && totalBankAccount ",x,N),e.jsx(F,{className:L("bg-gray-50 border-gray-200 shadow-sm hover:shadow-md transition-shadow relative h-[180px] flex flex-col ",d),children:e.jsxs(S,{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-base sm:text-lg line-clamp-1",children:a}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{htmlFor:`default-${n}`,className:"text-xs text-gray-600",children:"Default"}),e.jsx(Z,{id:`default-${n}`,checked:x,onCheckedChange:p,className:`h-6 w-12  transition-all duration-200 ${f?"data-[state=checked]:bg-green-500":x&&N?"data-[state=checked]:bg-gray-500 opacity-50 cursor-not-allowed":"data-[state=checked]:bg-green-500"}`})]})]}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("p",{className:"text-gray-600 text-sm font-mono tracking-wider",children:n}),e.jsx("p",{className:"text-gray-700 text-sm",children:s})]}),e.jsx("div",{className:"flex gap-2 justify-end mt-auto pt-3",children:e.jsx(B,{title:"Delete",variant:"ghost",size:"icon",onClick:l,className:"w-8 h-8 hover:bg-red-50 text-red-600 hover:text-red-700 rounded-md",children:e.jsx(de,{className:"w-4 h-4"})})})]})})},v=[{label:"Checking",value:"checking"},{label:"Savings",value:"savings"},{label:"Current",value:"current"}],fe=I({accountHolderName:j().trim().min(1,"Account holder name is required").min(2,"Account holder name must be at least 2 characters").max(70,"Account holder name must not exceed 70 characters"),bankName:j().trim().min(1,"Bank name is required").min(2,"Bank name must be at least 2 characters").max(100,"Bank name must not exceed 100 characters"),accountNumber:j().trim().min(1,"Account number is required").regex(/^[0-9]+$/,"Account number must contain only digits").min(8,"Account number must be at least 8 digits").max(20,"Account number must not exceed 20 digits"),routingNumber:j().trim().min(1,"Routing number is required").regex(/^[0-9]+$/,"Routing number must contain only digits").min(9,"Routing number must be 9 digits").max(9,"Routing number must be 9 digits"),swiftCode:j().trim().min(1,"SWIFT/BIC code is required").regex(/^[A-Z]{6}[A-Z0-9]{2}([A-Z0-9]{3})?$/,"Invalid SWIFT/BIC code format").max(11,"SWIFT/BIC code must not exceed 11 characters"),accountType:ne(["checking","savings","current"]),isDefault:Q().optional()}),ge=I({isDefault:Q().optional()}),pe=({isOpen:t,onClose:a,onSubmit:n,initialData:s,isEdit:r=!1,totalBankAccount:l,isSubmitting:o=!1})=>{const d=_({resolver:z(r?ge:fe),defaultValues:s?{accountHolderName:s.accountHolderName||"",bankName:s.bankName||"",accountNumber:s.accountNumber||"",routingNumber:s.routingNumber||"",swiftCode:s.swiftCode||"",accountType:s.accountType||v[0].value,isDefault:s.isDefault??!1}:{accountHolderName:"",bankName:"",accountNumber:"",routingNumber:"",swiftCode:"",accountType:v[0].value,isDefault:!l}});Y.useEffect(()=>{t?s&&d.reset({accountHolderName:s.accountHolderName||"",bankName:s.bankName||"",accountNumber:s.accountNumber||"",routingNumber:s.routingNumber||"",swiftCode:s.swiftCode||"",accountType:s.accountType||v[0].value,isDefault:s.isDefault??!1}):d.reset({accountHolderName:"",bankName:"",accountNumber:"",routingNumber:"",swiftCode:"",accountType:v[0].value,isDefault:!l})},[s,t,d,l]);const{handleSubmit:x,reset:N,control:f}=d,g=async i=>{await n(i)},p=()=>{o||N(),a()};return e.jsx(J,{open:t,onOpenChange:p,children:e.jsxs(V,{className:" sm:max-w-[600px] md:max-w-[700px] p-0 bg-white max-h-[90vh] overflow-y-auto",children:[e.jsx(G,{className:"px-4 pt-4 sm:px-6 pb-0 mb-0",children:e.jsx(ee,{className:"text-lg sm:text-xl font-semibold",children:r?"Manage Account":"Add New Account"})}),e.jsx(ae,{...d,children:e.jsxs("form",{onSubmit:x(g),className:"p-4 sm:p-6 space-y-4 sm:space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4",children:[e.jsx(A,{disabled:r||o,name:"accountHolderName",label:"Account Holder Name",placeholder:"Enter Account Holder Name"}),e.jsx(A,{name:"bankName",label:"Bank Name",disabled:r||o,placeholder:"Enter Bank Name"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4",children:[e.jsx(A,{disabled:r||o,name:"accountNumber",label:"Bank Account Number",placeholder:"Enter Bank Account Number"}),e.jsx(A,{disabled:r||o,name:"routingNumber",label:"Routing Number",placeholder:"Enter Routing Number"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4",children:[e.jsx(A,{disabled:r||o,name:"swiftCode",label:"SWIFT/BIC Code",placeholder:"Enter SWIFT Code"}),e.jsx(ie,{disabled:r||o,name:"accountType",label:"Account Type",options:v})]}),l&&e.jsx(te,{name:"isDefault",control:f,render:({field:i})=>e.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[e.jsx(se,{id:"isDefault",checked:i.value,disabled:o,onCheckedChange:i.onChange,className:"border-gray-300"}),e.jsx(H,{htmlFor:"isDefault",className:"text-sm font-normal text-gray-600 cursor-pointer",children:"Save as default"})]})}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row gap-2 sm:gap-3 pt-3 sm:pt-4 sm:justify-end",children:[e.jsx(B,{type:"button",variant:"outline",onClick:p,className:"w-full sm:w-[200px] md:w-[224px] border-gray-300 text-gray-700 hover:bg-gray-50 text-sm sm:text-base",disabled:o,children:"Cancel"}),e.jsx(B,{type:"submit",className:"w-full sm:w-[200px] md:w-[224px] bg-primary text-white hover:bg-primary/90 text-sm sm:text-base",disabled:o,children:o?"Saving...":r?"Update Account":"Add Account"})]})]})})]})})};class he{async getBankAccounts(){return(await h.get("/bank-accounts")).data}async getBankAccount(a){return(await h.get(`/bank-accounts/${a}`)).data}async createBankAccount(a){console.log("Creating bank account with data:",a);const n=await h.post("/bank-accounts",a);return console.log("Bank account created successfully:",n.data),n.data}async updateBankAccount(a,n){return(await h.patch(`/bank-accounts/${a}/set-default`,n)).data}async deleteBankAccount(a){return(await h.delete(`/bank-accounts/${a}`)).data}async setDefaultBankAccount(a){return(await h.patch(`/bank-accounts/${a}/set-default`)).data}}const C=new he,u=["bankAccounts"];function be(){return ce({queryKey:u,queryFn:()=>C.getBankAccounts(),staleTime:300*1e3,gcTime:600*1e3})}function ye(){return D({mutationFn:t=>C.createBankAccount(t),onSuccess:async t=>{await y.invalidateQueries({queryKey:u}),await y.refetchQueries({queryKey:u}),m.success(t.message||"Bank account added successfully")},onError:t=>{const a=t.response?.data?.message||"Failed to add bank account";m.error(a),console.error("Create bank account error:",t)}})}function Ne(){return D({mutationFn:({id:t,data:a})=>C.updateBankAccount(t,a),onSuccess:async t=>{await y.invalidateQueries({queryKey:u}),await y.refetchQueries({queryKey:u}),m.success(t.message||"Bank account updated successfully")},onError:t=>{const a=t.response?.data?.message||"Failed to update bank account";m.error(a),console.error("Update bank account error:",t)}})}function ke(){return D({mutationFn:t=>C.deleteBankAccount(t),onSuccess:async t=>{await y.invalidateQueries({queryKey:u}),await y.refetchQueries({queryKey:u}),m.success(t.message||"Bank account deleted successfully")},onError:t=>{const a=t.response?.data?.message||"Failed to delete bank account";m.error(a),console.error("Delete bank account error:",t)}})}function we(){const t=oe();return D({mutationFn:a=>C.setDefaultBankAccount(a),onMutate:async a=>{await t.cancelQueries({queryKey:u});const n=t.getQueryData(u);return t.setQueryData(u,s=>{if(!s?.data)return s;const r=s.data.map(l=>({...l,isDefault:l.id===a}));return{...s,data:r}}),{previousAccounts:n}},onError:(a,n,s)=>{t.setQueryData(u,s?.previousAccounts);const r=a.response?.data?.message||"Failed to set default bank account";m.error(r),console.error("Set default bank account error:",a)},onSettled:async()=>{await t.invalidateQueries({queryKey:u})},onSuccess:a=>{m.success(a.message||"Default bank account updated")}})}const Te=()=>{const[t,a]=b.useState(!1),[n,s]=b.useState(null),[r,l]=b.useState(!1),[o,d]=b.useState(null),[x,N]=b.useState(null),{data:f,isLoading:g,error:p}=be(),i=ye(),k=Ne(),M=ke(),E=we(),w=f?.data||[],K=async(c,T)=>{if(T)await E.mutateAsync(c);else{const q=w.find(W=>W.id===c);q&&await k.mutateAsync({id:c,data:{...q,isDefault:!1}})}},X=async c=>{try{n?await k.mutateAsync({id:n.id,data:c}):await i.mutateAsync(c),a(!1),s(null)}catch(T){console.error("Failed to save bank account:",T)}},$=c=>{s(c),a(!0)},O=c=>{d(c),l(!0)},R=()=>{o&&M.mutate(o.id,{onSuccess:()=>{l(!1),d(null)}})},P=()=>{l(!1),d(null)},U=()=>{a(!1),s(null)};return g?e.jsx(me,{}):p?e.jsx(F,{className:"bg-white border-gray-200 shadow-none h-[calc(100vh-200px)] justify-center items-center",children:e.jsx(S,{className:"px-4 sm:px-6",children:e.jsx("div",{className:"text-center py-12 text-red-500",children:"Failed to load bank accounts. Please try again."})})}):e.jsx(F,{className:"bg-white border-gray-200 shadow-none min-h-[calc(100vh-200px)] flex flex-col",children:e.jsxs(S,{className:"px-4 sm:px-6 flex flex-col flex-1",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 sm:gap-4 mb-4 sm:mb-6",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-semibold",children:"Manage Bank Accounts"}),e.jsxs(B,{onClick:()=>a(!0),className:"w-full sm:w-auto min-w-full sm:min-w-[180px] h-10 sm:h-11 bg-primary hover:bg-primary/90 text-white px-3 sm:px-5 rounded-lg flex items-center justify-center gap-2 text-sm sm:text-base font-medium",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{children:"Add Bank Account"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 sm:gap-6 ",children:w.length>0?w.map(c=>e.jsx(xe,{id:c.id,totalBankAccount:w.length===1,accountHolder:c.accountHolderName,accountNumber:`XXXX XXXX XXXX ${c.accountNumber.slice(-4)}`,bankName:c.bankName,onEdit:()=>$(c),onDelete:()=>O(c),onToggleDefault:K,isDefault:c.isDefault},c.id)):e.jsxs("div",{className:"col-span-full flex flex-col items-center justify-center min-h-[400px]",children:[e.jsx(le,{className:"h-12 w-12 mb-4 text-gray-300"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"No bank accounts added yet"})]})}),e.jsx(pe,{isOpen:t,isSubmitting:i.isPending||k?.isPending,onClose:U,onSubmit:X,totalBankAccount:w.length>0,initialData:n?{accountHolderName:n.accountHolderName,bankName:n.bankName,isDefault:n.isDefault,accountNumber:n.accountNumber,routingNumber:n.routingNumber,swiftCode:n.swiftCode,accountType:n.accountType}:void 0,isEdit:!!n}),r&&e.jsx(ue,{isOpen:r,onClose:P,onConfirm:R,title:"Delete Bank Account?",description:e.jsxs(e.Fragment,{children:["Are you sure you want to delete the bank account ending in"," ",e.jsx("strong",{className:"font-semibold",children:o?.accountNumber}),"? This action cannot be undone."]}),confirmText:"Yes, I'm Sure",cancelText:"Cancel",isLoading:M.isPending})]})})};export{Te as default};
