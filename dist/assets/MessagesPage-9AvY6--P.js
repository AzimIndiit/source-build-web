import{j as e,C as _,Y as A,Z as L,$ as O,a0 as U,S as N,u as k,bM as E,c as Y,r as j,bU as z}from"./index-BiCr9dd_.js";import{B as F}from"./badge-gylWw4eT.js";import{c as R}from"./constructNow-CYnDNQGr.js";import{t as y,n as X,g as I,b as $,e as H,d as T,f as b}from"./en-US-CPLesiGp.js";import{e as P,d as B}from"./endOfMonth-B0jjArdg.js";function w(s,t){const r=+y(s)-+y(t);return r<0?-1:r>0?1:r}function Q(s){return t=>{const l=(s?Math[s]:Math.trunc)(t);return l===0?0:l}}function Z(s,t){return+y(s)-+y(t)}function q(s,t){const r=y(s,t?.in);return r.setHours(23,59,59,999),r}function G(s,t){const r=y(s,t?.in);return+q(r,t)==+P(r,t)}function J(s,t,r){const[l,n,u]=X(r?.in,s,s,t),d=w(n,u),a=Math.abs(B(n,u));if(a<1)return 0;n.getMonth()===1&&n.getDate()>27&&n.setDate(30),n.setMonth(n.getMonth()-d*a);let m=w(n,u)===-d;G(l)&&a===1&&w(l,u)===1&&(m=!1);const h=d*(a-+m);return h===0?0:h}function K(s,t,r){const l=Z(s,t)/1e3;return Q(r?.roundingMethod)(l)}function V(s,t,r){const l=$(),n=r?.locale??l.locale??H,u=2520,d=w(s,t);if(isNaN(d))throw new RangeError("Invalid time value");const a=Object.assign({},r,{addSuffix:r?.addSuffix,comparison:d}),[m,h]=X(r?.in,...d>0?[t,s]:[s,t]),x=K(h,m),D=(I(h)-I(m))/1e3,i=Math.round((x-D)/60);let o;if(i<2)return r?.includeSeconds?x<5?n.formatDistance("lessThanXSeconds",5,a):x<10?n.formatDistance("lessThanXSeconds",10,a):x<20?n.formatDistance("lessThanXSeconds",20,a):x<40?n.formatDistance("halfAMinute",0,a):x<60?n.formatDistance("lessThanXMinutes",1,a):n.formatDistance("xMinutes",1,a):i===0?n.formatDistance("lessThanXMinutes",1,a):n.formatDistance("xMinutes",i,a);if(i<45)return n.formatDistance("xMinutes",i,a);if(i<90)return n.formatDistance("aboutXHours",1,a);if(i<T){const c=Math.round(i/60);return n.formatDistance("aboutXHours",c,a)}else{if(i<u)return n.formatDistance("xDays",1,a);if(i<b){const c=Math.round(i/T);return n.formatDistance("xDays",c,a)}else if(i<b*2)return o=Math.round(i/b),n.formatDistance("aboutXMonths",o,a)}if(o=J(h,m),o<12){const c=Math.round(i/b);return n.formatDistance("xMonths",c,a)}else{const c=o%12,f=Math.trunc(o/12);return c<3?n.formatDistance("aboutXYears",f,a):c<9?n.formatDistance("overXYears",f,a):n.formatDistance("almostXYears",f+1,a)}}function W(s,t){return V(s,R(s),t)}const ee=({id:s,displayName:t,avatar:r,lastMessage:l,timestamp:n,unreadCount:u=0,onClick:d})=>e.jsxs(_,{onClick:d,className:"relative p-2 bg-white border-gray-200 cursor-pointer hover:bg-gray-50 transition-colors  justify-center",children:[u>0&&e.jsx("div",{className:"absolute bottom-1 right-1",children:e.jsx(F,{className:"h-6 w-6 rounded-full p-0 flex items-center justify-center bg-red-500 hover:bg-red-500 text-white",children:u>9?"9+":u})}),e.jsxs("div",{className:"flex  gap-3 items-stretch",children:[e.jsxs(A,{className:"h-16 w-16",children:[e.jsx(L,{src:r||"",alt:t}),e.jsx(O,{className:"bg-gray-200 text-gray-700 font-semibold text-xl",children:e.jsx("div",{className:"mt-1",children:U(t||"U")})})]}),e.jsxs("div",{className:"flex-1 min-w-0 py-2 flex flex-col justify-center my-auto",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("h6",{className:"font-semibold text-gray-900 capitalize truncate",children:t}),e.jsx("span",{className:"text-sm text-gray-500 ml-2 whitespace-nowrap",children:n})]}),e.jsx("p",{className:"text-gray-600 text-sm line-clamp-2",children:l})]})]})]},s),se=()=>e.jsx("div",{className:"py-4 md:p-6 space-y-6",children:e.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((s,t)=>e.jsxs("div",{className:"flex items-center space-x-4 p-4 rounded-lg",children:[e.jsx(N,{className:"w-12 h-12 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(N,{className:"h-4 w-32"}),e.jsx(N,{className:"h-3 w-16"})]}),e.jsx(N,{className:"h-3 w-3/4"})]}),e.jsx(N,{className:"w-6 h-6 rounded-full"})]},t))})}),te=()=>{const{user:s}=k(),{on:t}=E(),r=Y(),[l,n]=j.useState(1),[u,d]=j.useState(10),{data:a,isLoading:m,error:h,refetch:x}=z({page:l,limit:u}),[D,i]=j.useState([]);return j.useEffect(()=>{x()},[]),j.useEffect(()=>{a?.data&&i(a.data)},[a]),j.useEffect(()=>{const c=t("update_unread_count",f=>{console.log("data",f),i(p=>{const M=p.findIndex(g=>g.id===f.id);if(M!==-1){const g=[...p];return g[M]={...g[M],...f},g}return p})});return()=>{c()}},[t]),e.jsxs("div",{className:"py-4 md:p-6 space-y-6",children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-gray-900",children:"Messages"}),e.jsx("div",{className:"space-y-3",children:D?.length>0?D?.map(o=>{const c=o?.lastMessage,f=c?.messageType==="text"?c.content:c?.messageType==="file"||c?.messageType==="mix"?"Sent a file":"",p=o?.participants?.find(S=>S?.id!==s?.id),M=c?.sentAt?W(new Date(c.sentAt),{addSuffix:!0}):"",g=s?.id&&o.unreadCounts&&o.unreadCounts[s.id]||0;return e.jsx(ee,{id:o.id||"",displayName:p?.displayName||"Unknown User",avatar:p?.avatar,lastMessage:f,timestamp:M,unreadCount:g,onClick:()=>{i(S=>S.map(v=>{if(v.id===o.id){const C={...v.unreadCounts,[s?.id||""]:0};return console.log("unreadCounts",C),{...v,unreadCounts:C}}return v})),r(s?.role==="buyer"?`/messages/${o._id}`:`/${s?.role}/messages/${o._id}`,{state:o})}},o.id)}):m?e.jsx(se,{}):h?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("p",{className:"text-red-500",children:"Failed to load messages. Please try again."})}):e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("p",{className:"text-gray-500",children:"No Messages Found"})})})]})};function ce(){return e.jsx(te,{})}export{ce as default};
