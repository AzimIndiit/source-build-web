import{$ as D,a2 as A,a0 as C,a1 as $,E as k,z as d,G as P,u as _,r as p,h as B,i as U,j as e,F as z,k as T,ac as O,B as R,l as S}from"./index-CUSVstqU.js";import{A as X}from"./AuthWrapper-BHMzU0-9.js";import{v as w}from"./vehicleService-DvBLmtkJ.js";import{U as L}from"./upload-BVTc7vsb.js";const G=5*1024*1024,Y=["image/jpeg","image/jpg","image/png","image/webp"],Z=D({licenceImages:C($(File).refine(i=>i.size<=G,{message:"Max file size is 5MB"}).refine(i=>Y.includes(i.type),{message:"Only .jpg, .jpeg, .png, .webp and .gif formats are supported"})).optional(),licenseNumber:A().min(5,"License number must be at least 5 characters").max(20,"License number must not exceed 20 characters").regex(/^[A-Z0-9-]+$/i,"License number can only contain letters, numbers, and hyphens")}),q=["license"];function K(){return k({mutationFn:async i=>{const t=await w.uploadVehicleImages(i.licenseImageFiles);if(t.length===0)throw new Error("Failed to upload license images. Please try again.");const u={licenseNumber:i.licenseNumber,licenseImages:t};return await w.createLicense(u)},onSuccess:i=>{P.invalidateQueries({queryKey:q}),d.success(i.message||"License information submitted successfully!")},onError:i=>{const t=i.response?.data?.message||i.message||"Failed to submit license information";d.error(t),console.error("Error submitting license information:",i)}})}const n=2,Q=5*1024*1024;function ee(){const i=_(),[t,u]=p.useState([]),[b,x]=p.useState(!1),[v,f]=p.useState(!1),h=K(),y=B({resolver:U(Z),defaultValues:{licenseNumber:""}}),{handleSubmit:F}=y,j=s=>s.type.startsWith("image/")?s.size>Q?{valid:!1,error:"Maximum size is 5MB allowed"}:{valid:!0}:{valid:!1,error:`"${s.name}" is not an image file`},g=p.useCallback(s=>{s.preventDefault(),s.stopPropagation(),s.type==="dragenter"||s.type==="dragover"?x(!0):s.type==="dragleave"&&x(!1)},[]),N=p.useCallback(s=>{if(s.preventDefault(),s.stopPropagation(),x(!1),s.dataTransfer.files&&s.dataTransfer.files[0]){const a=Array.from(s.dataTransfer.files);if(t.length>=n){d.error(`Maximum ${n} images allowed`);return}const o=n-t.length,l=[],c=[];for(let r=0;r<Math.min(a.length,o);r++){const m=j(a[r]);m.valid?l.push(a[r]):m.error&&c.push(m.error)}a.length>o&&c.push(`Only ${o} more image(s) can be added (max ${n} total)`),l.length>0&&(u(r=>[...r,...l]),f(!1)),c.forEach(r=>d.error(r))}},[t]),E=s=>{if(s.target.files){const a=Array.from(s.target.files);if(t.length>=n){d.error(`Maximum ${n} images allowed`),s.target.value="";return}const o=n-t.length,l=[],c=[];for(let r=0;r<Math.min(a.length,o);r++){const m=j(a[r]);m.valid?l.push(a[r]):m.error&&c.push(m.error)}a.length>o&&c.push(`Only ${o} more image(s) can be added (max ${n} total)`),l.length>0&&(u(r=>[...r,...l]),f(!1)),c.forEach(r=>d.error(r)),s.target.value=""}},I=s=>{u(a=>a.filter((o,l)=>l!==s))},M=async s=>{if(t.length===0){f(!0),d.error("Please upload at least one driving license image"),window.scrollTo({top:0,behavior:"smooth"});return}try{(await h.mutateAsync({licenseNumber:s.licenseNumber,licenseImageFiles:t}))?.status==="success"&&i("/driver/dashboard")}catch(a){console.error("Failed to submit license information:",a)}};return e.jsx(X,{children:e.jsxs("div",{className:"w-full max-w-2xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Driving License"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Upload a valid driving license to verify your eligibility for deliveries."})]}),e.jsx(z,{...y,children:e.jsxs("form",{onSubmit:F(M),className:"space-y-4",children:[e.jsx(T,{name:"licenseNumber",label:"",type:"text",disabled:h.isPending,placeholder:"Enter License number",className:"text-base px-4 border-gray-300"}),e.jsxs("div",{className:"space-y-4",children:[t.length===0?e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center bg-gray-50 ${b?"border-primary bg-blue-50":"border-gray-300"} ${v?"border-red-500":""}`,onDragEnter:g,onDragLeave:g,onDragOver:g,onDrop:N,children:[e.jsx("input",{type:"file",id:"license-photo-upload",className:"hidden",multiple:!0,accept:"image/*",onChange:E}),e.jsxs("label",{htmlFor:"license-photo-upload",className:"cursor-pointer inline-flex flex-col items-center",children:[e.jsx(L,{className:"h-12 w-12 text-gray-400 mb-3"}),e.jsx("span",{className:"text-base text-gray-700 font-medium mb-1",children:"Drag & drop images"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["or ",e.jsx("span",{className:"text-primary underline",children:"click here"})]})]}),e.jsx("div",{className:"text-xs text-red-600",children:"Max file size is 5MB"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-4 text-center bg-gray-50 ${b?"border-primary bg-blue-50":"border-gray-300"}`,onDragEnter:g,onDragLeave:g,onDragOver:g,onDrop:N,children:[e.jsx("input",{type:"file",id:"license-photo-upload-more",className:"hidden",multiple:!0,accept:"image/*",onChange:E,disabled:t.length>=n}),e.jsxs("label",{htmlFor:"license-photo-upload-more",className:`inline-flex items-center gap-2 ${t.length>=n?"cursor-not-allowed opacity-50":"cursor-pointer"}`,children:[e.jsx(L,{className:"h-5 w-5 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600",children:t.length>=n?"Maximum images reached":"Add more images"})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:t.map((s,a)=>e.jsxs("div",{className:"relative group border-2 border-gray-200 rounded-lg overflow-hidden bg-white shadow-sm",children:[e.jsx("img",{src:URL.createObjectURL(s),alt:`License ${a===0?"Front":"Back"}`,className:"w-full h-48 object-cover "}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/50 to-transparent p-2",children:e.jsx("span",{className:"text-white text-sm font-medium",children:a===0?"Front Side":"Back Side"})}),e.jsx("button",{type:"button",onClick:()=>I(a),className:"absolute top-2 right-2 bg-red-500 text-white rounded-full p-1 cursor-pointer transition-opacity",children:e.jsx(O,{className:"h-4 w-4"})})]},`license-${a}`))}),t.length===1&&e.jsx("p",{className:"text-sm text-amber-600 text-center",children:"ℹ️ Consider uploading both front and back of your license for faster verification"})]}),v&&e.jsx("p",{className:"text-sm text-red-600 text-center",children:"Please upload at least one driving license image"})]}),e.jsx("div",{className:"flex gap-4 pt-4",children:e.jsx(R,{type:"submit",className:"flex-1 bg-primary hover:bg-primary/80 text-white",disabled:h.isPending,loading:h.isPending,children:"Continue"})}),e.jsx("div",{className:"text-center pt-2",children:e.jsxs("span",{className:"text-sm text-gray-500",children:["Back to"," ",e.jsx("button",{type:"button",onClick:()=>{const{logout:s}=S.getState();s(),localStorage.clear(),sessionStorage.clear(),setTimeout(()=>{i("/auth/signup")},1e3)},className:"text-primary hover:underline",children:"Sign Up"})," | ",e.jsx("button",{type:"button",onClick:()=>{const{logout:s}=S.getState();s(),localStorage.clear(),sessionStorage.clear(),i("/auth/login")},className:"text-primary hover:underline",children:"Login"})]})})]})})]})})}export{ee as default};
