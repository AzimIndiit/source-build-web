const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BiCr9dd_.js","assets/index-CFu2upes.css"])))=>i.map(i=>d[i]);
import{c as G,r as n,d as Y,e as Z,z as c,j as e,F as J,f as ee,X as O,B as ae,v as U,w as R,U as L,aD as _,m as re}from"./index-BiCr9dd_.js";import{A as le}from"./AuthWrapper-CC9SsPQ1.js";import{v as te}from"./vehicleSchemas-CjdoQspT.js";import{F as I}from"./FormSelect-B-UjWW9p.js";import{u as se}from"./useVehicleMutations-Cs-QPN7I.js";import{U as b}from"./upload-BsZw_j0x.js";import"./index-BdQq_4o_.js";import"./badge-gylWw4eT.js";import"./vehicleService-B4kj4K-z.js";const h=5,m=2,ie=5*1024*1024,oe=[{value:"sedan",label:"Sedan"},{value:"suv",label:"SUV"},{value:"truck",label:"Truck"},{value:"van",label:"Van"},{value:"pickup",label:"Pickup"},{value:"minivan",label:"Minivan"},{value:"other",label:"Other"}],ne=[{value:"toyota",label:"Toyota"},{value:"honda",label:"Honda"},{value:"ford",label:"Ford"},{value:"chevrolet",label:"Chevrolet"},{value:"nissan",label:"Nissan"},{value:"hyundai",label:"Hyundai"},{value:"kia",label:"Kia"},{value:"mazda",label:"Mazda"},{value:"volkswagen",label:"Volkswagen"},{value:"mercedes",label:"Mercedes-Benz"},{value:"bmw",label:"BMW"},{value:"audi",label:"Audi"},{value:"tesla",label:"Tesla"},{value:"other",label:"Other"}],z={toyota:[{value:"camry",label:"Camry"},{value:"corolla",label:"Corolla"},{value:"rav4",label:"RAV4"},{value:"highlander",label:"Highlander"},{value:"tacoma",label:"Tacoma"},{value:"sienna",label:"Sienna"}],honda:[{value:"accord",label:"Accord"},{value:"civic",label:"Civic"},{value:"crv",label:"CR-V"},{value:"pilot",label:"Pilot"},{value:"odyssey",label:"Odyssey"}],ford:[{value:"f150",label:"F-150"},{value:"f250",label:"F-250"},{value:"explorer",label:"Explorer"},{value:"escape",label:"Escape"},{value:"transit",label:"Transit"}],chevrolet:[{value:"silverado",label:"Silverado"},{value:"tahoe",label:"Tahoe"},{value:"suburban",label:"Suburban"},{value:"express",label:"Express"}],other:[{value:"other",label:"Other"}]};function be(){const x=G(),[d,y]=n.useState([]),[u,j]=n.useState([]),[T,N]=n.useState(!1),[F,S]=n.useState(!1),[M,w]=n.useState(!1),[D,A]=n.useState(!1),g=se(),P=Y({resolver:Z(te),defaultValues:{vehicleType:"",vehicleRegistrationNumber:"",vehicleManufacturer:"",vehicleModel:""}}),{handleSubmit:B,watch:K}=P,E=K("vehicleManufacturer"),q=E?z[E]||z.other:[],f=a=>a.type.startsWith("image/")?a.size>ie?{valid:!1,error:"Maximum size is 5MB allowed"}:{valid:!0}:{valid:!1,error:`"${a.name}" is not an image file`},p=n.useCallback(a=>{a.preventDefault(),a.stopPropagation(),a.type==="dragenter"||a.type==="dragover"?N(!0):a.type==="dragleave"&&N(!1)},[]),$=n.useCallback(a=>{if(a.preventDefault(),a.stopPropagation(),N(!1),a.dataTransfer.files&&a.dataTransfer.files[0]){const l=Array.from(a.dataTransfer.files);if(d.length>=h){c.error(`Maximum ${h} images allowed`);return}const s=h-d.length,t=[],i=[];for(let r=0;r<Math.min(l.length,s);r++){const o=f(l[r]);o.valid?t.push(l[r]):o.error&&i.push(o.error)}l.length>s&&i.push(`Only ${s} more image(s) can be added (max ${h} total)`),t.length>0&&(y(r=>[...r,...t]),w(!1)),i.forEach(r=>c.error(r))}},[d]),C=a=>{if(a.target.files){const l=Array.from(a.target.files);if(d.length>=h){c.error(`Maximum ${h} images allowed`),a.target.value="";return}const s=h-d.length,t=[],i=[];for(let r=0;r<Math.min(l.length,s);r++){const o=f(l[r]);o.valid?t.push(l[r]):o.error&&i.push(o.error)}l.length>s&&i.push(`Only ${s} more image(s) can be added (max ${h} total)`),t.length>0&&(y(r=>[...r,...t]),w(!1)),i.forEach(r=>c.error(r)),a.target.value=""}},v=n.useCallback(a=>{a.preventDefault(),a.stopPropagation(),a.type==="dragenter"||a.type==="dragover"?S(!0):a.type==="dragleave"&&S(!1)},[]),V=n.useCallback(a=>{if(a.preventDefault(),a.stopPropagation(),S(!1),a.dataTransfer.files&&a.dataTransfer.files[0]){const l=Array.from(a.dataTransfer.files);if(u.length>=m){c.error(`Maximum ${m} images allowed`);return}const s=m-u.length,t=[],i=[];for(let r=0;r<Math.min(l.length,s);r++){const o=f(l[r]);o.valid?t.push(l[r]):o.error&&i.push(o.error)}l.length>s&&i.push(`Only ${s} more image(s) can be added (max ${m} total)`),t.length>0&&(j(r=>[...r,...t]),A(!1)),i.forEach(r=>c.error(r))}},[u]),k=a=>{if(a.target.files){const l=Array.from(a.target.files);if(u.length>=m){c.error(`Maximum ${m} images allowed`),a.target.value="";return}const s=m-u.length,t=[],i=[];for(let r=0;r<Math.min(l.length,s);r++){const o=f(l[r]);o.valid?t.push(l[r]):o.error&&i.push(o.error)}l.length>s&&i.push(`Only ${s} more image(s) can be added (max ${m} total)`),t.length>0&&(j(r=>[...r,...t]),A(!1)),i.forEach(r=>c.error(r)),a.target.value=""}},H=a=>{y(l=>l.filter((s,t)=>t!==a))},X=a=>{j(l=>l.filter((s,t)=>t!==a))},Q=async a=>{if(d.length===0){w(!0),c.error("Please upload at least one vehicle image"),window.scrollTo({top:0,behavior:"smooth"});return}if(u.length===0){A(!0),c.error("Please upload at least one insurance image"),window.scrollTo({top:0,behavior:"smooth"});return}try{const l=await g.mutateAsync({vehicleType:a.vehicleType,vehicleManufacturer:a.vehicleManufacturer,vehicleModel:a.vehicleModel,vehicleRegistrationNumber:a.vehicleRegistrationNumber,vehicleImageFiles:d,insuranceImageFiles:u});if(console.log("navigating to driver license",l),l?.status==="success"){console.log("navigating to driver license",l?.status),await R.invalidateQueries({queryKey:L});try{const s=await R.fetchQuery({queryKey:L,queryFn:async()=>{const{authService:t}=await _(async()=>{const{authService:r}=await Promise.resolve().then(()=>ce);return{authService:r}},void 0),i=await t.getProfile();if(i.data&&i.data.user){const{transformApiUserToUser:r}=await _(async()=>{const{transformApiUserToUser:o}=await import("./index-BiCr9dd_.js").then(W=>W.c2);return{transformApiUserToUser:o}},__vite__mapDeps([0,1]));return r(i.data.user)}throw new Error("Failed to fetch updated user profile")},staleTime:0});if(s){const{useAuthStore:t}=await _(async()=>{const{useAuthStore:i}=await import("./index-BiCr9dd_.js").then(r=>r.c3);return{useAuthStore:i}},__vite__mapDeps([0,1]));t.getState().setUser(s),setTimeout(()=>{x("/auth/driver-license")},100)}else x("/auth/driver-license")}catch(s){console.error("Failed to fetch updated user profile:",s),x("/auth/driver-license")}}}catch(l){console.error("Failed to submit vehicle information:",l)}};return e.jsx(le,{children:e.jsxs("div",{className:"w-full max-w-2xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Vehicle Information"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Provide your vehicle details to ensure smooth delivery assignments and route optimization."})]}),e.jsx(J,{...P,children:e.jsxs("form",{onSubmit:B(Q),className:"space-y-4",children:[e.jsx(I,{name:"vehicleType",label:"",disabled:g.isPending,placeholder:"Select Vehicle type",options:oe}),e.jsx(ee,{name:"vehicleRegistrationNumber",label:"",type:"text",disabled:g.isPending,placeholder:"Vehicle registration number e.g., KA01AB1234"}),e.jsx(I,{name:"vehicleManufacturer",label:"",disabled:g.isPending,placeholder:"Select Manufacturer",options:ne}),e.jsx(I,{name:"vehicleModel",label:"",disabled:g.isPending||!E,placeholder:"Select Model",options:q}),e.jsx("div",{className:"space-y-4",children:d.length===0?e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-4 text-center bg-gray-50 ${T?"border-primary bg-blue-50":"border-gray-300"} ${M?"border-red-500":""}`,onDragEnter:p,onDragLeave:p,onDragOver:p,onDrop:$,children:[e.jsx("input",{type:"file",id:"vehicle-photo-upload",className:"hidden",multiple:!0,accept:"image/*",onChange:C}),e.jsxs("label",{htmlFor:"vehicle-photo-upload",className:"cursor-pointer inline-flex flex-col items-center",children:[e.jsx(b,{className:"h-8 w-8 text-gray-400 mb-2"}),e.jsxs("span",{className:"text-xs text-gray-600",children:["Drag & drop media or"," ",e.jsx("span",{className:"text-primary underline",children:"click here"})]}),e.jsx("span",{className:"text-xs text-red-600",children:"Max file size is 5MB"})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-3 text-center bg-gray-50 ${T?"border-primary bg-blue-50":"border-gray-300"} ${M?"border-red-500":""}`,onDragEnter:p,onDragLeave:p,onDragOver:p,onDrop:$,children:[e.jsx("input",{type:"file",id:"vehicle-photo-upload-more",className:"hidden",multiple:!0,accept:"image/*",onChange:C}),e.jsxs("label",{htmlFor:"vehicle-photo-upload-more",className:"cursor-pointer inline-flex items-center gap-2",children:[e.jsx(b,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{className:"text-xs text-gray-600",children:["Drag & drop media or"," ",e.jsx("span",{className:"text-primary underline",children:"click here"})]})]}),e.jsx("div",{className:"text-xs text-red-600",children:"Max file size is 5MB"})]}),e.jsx("div",{className:"grid grid-cols-3 lg:grid-cols-5 gap-2",children:d.map((a,l)=>e.jsxs("div",{className:"relative group border border-gray-200 rounded-sm shadow-sm",children:[e.jsx("img",{src:URL.createObjectURL(a),alt:`Vehicle ${l+1}`,className:"w-full sm:h-24 md:h-28 h-20 lg:h-16 object-cover rounded-sm"}),e.jsx("button",{type:"button",onClick:()=>H(l),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-0.5 cursor-pointer",children:e.jsx(O,{className:"h-3 w-3"})})]},`vehicle-${l}`))})]})}),M&&e.jsx("p",{className:"text-sm text-red-600 text-center",children:"Please upload at least one vehicle image"}),e.jsxs("div",{className:"space-y-2",children:[u.length===0?e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-4 text-center bg-gray-50 ${F?"border-primary bg-blue-50":"border-gray-300"} ${D?"border-red-500":""}`,onDragEnter:v,onDragLeave:v,onDragOver:v,onDrop:V,children:[e.jsx("input",{type:"file",id:"insurance-photo-upload",className:"hidden",multiple:!0,accept:"image/*",onChange:k}),e.jsxs("label",{htmlFor:"insurance-photo-upload",className:"cursor-pointer inline-flex flex-col items-center",children:[e.jsx(b,{className:"h-8 w-8 text-gray-400 mb-2"}),e.jsxs("span",{className:"text-xs text-gray-600",children:["Drag & drop insurance documents or"," ",e.jsx("span",{className:"text-primary underline",children:"click here"})]}),e.jsx("span",{className:"text-xs text-red-600",children:"Max file size is 5MB"})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-3 text-center bg-gray-50 ${F?"border-primary bg-blue-50":"border-gray-300"} ${D?"border-red-500":""}`,onDragEnter:v,onDragLeave:v,onDragOver:v,onDrop:V,children:[e.jsx("input",{type:"file",id:"insurance-photo-upload-more",className:"hidden",multiple:!0,accept:"image/*",onChange:k}),e.jsxs("label",{htmlFor:"insurance-photo-upload-more",className:"cursor-pointer inline-flex items-center gap-2",children:[e.jsx(b,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{className:"text-xs text-gray-600",children:["Add more insurance documents"," ",e.jsx("span",{className:"text-primary underline",children:"click here"})]})]}),e.jsx("div",{className:"text-xs text-red-600",children:"Max file size is 5MB"})]}),e.jsx("div",{className:"grid grid-cols-3 lg:grid-cols-5 gap-2",children:u.map((a,l)=>e.jsxs("div",{className:"relative group border border-gray-200 rounded-sm shadow-sm",children:[e.jsx("img",{src:URL.createObjectURL(a),alt:`Insurance ${l+1}`,className:"w-full sm:h-24 md:h-28 h-20 lg:h-16 object-cover rounded-sm"}),e.jsx("button",{type:"button",onClick:()=>X(l),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-0.5 cursor-pointer",children:e.jsx(O,{className:"h-3 w-3"})})]},`insurance-${l}`))})]}),D&&e.jsx("p",{className:"text-sm text-red-600 text-center",children:"Please upload at least one insurance image"})]}),e.jsx("div",{className:"flex gap-4 pt-4",children:e.jsx(ae,{type:"submit",className:"flex-1  bg-primary hover:bg-primary/80 text-white",disabled:g.isPending,loading:g.isPending,children:"Continue"})}),e.jsxs("div",{className:"text-center pt-2",children:[e.jsxs("button",{type:"button",onClick:()=>{const{logout:a}=U.getState();a(),localStorage.clear(),sessionStorage.clear(),setTimeout(()=>{x("/auth/signup")},1e3)},className:"text-sm text-gray-500 hover:text-gray-700",children:["Back to ",e.jsx("span",{className:"text-primary",children:"Sign Up"})]})," | ",e.jsx("button",{type:"button",onClick:()=>{const{logout:a}=U.getState();a(),localStorage.clear(),sessionStorage.clear(),x("/auth/login")},className:"text-sm text-gray-500 hover:text-gray-700",children:e.jsx("span",{className:"text-primary",children:"Login"})})]})]})})]})})}const ce=Object.freeze(Object.defineProperty({__proto__:null,authService:re},Symbol.toStringTag,{value:"Module"}));export{be as default};
