import{J as F,t as v,z as l,w as n}from"./index-BiCr9dd_.js";import{p}from"./productService-DV0qzB1U.js";const m=["products"],h=e=>["product",e];function q(){return v({mutationFn:async e=>{let i=[];e.imageFiles&&e.imageFiles.length>0&&(i=await Promise.all(e.imageFiles.map(t=>p.uploadProductImages([t]).then(d=>d[0]).catch(d=>{throw console.error("Failed to upload product image:",d),l.error("Failed to upload product image"),d}))));let o=e.variants;if(e.variantFiles&&e.variantFiles.length>0&&o){const t=new Map;for(const d of e.variantFiles)if(d.files.length>0)try{console.log("Uploading images for variant at index:",d.variantIndex);const s=await p.uploadProductImages(d.files);t.set(d.variantIndex,s)}catch(s){throw console.error("Failed to upload variant images:",s),l.error("Failed to upload variant images"),s}o=o.map((d,s)=>{const r=t.get(s);return r?(console.log(`Adding ${r.length} images to variant at index ${s}`),{...d,images:r}):d})}const{imageFiles:u,variantFiles:g,...c}=e,f={...c,price:Number(c.price),quantity:Number(c.quantity),shippingPrice:c.shippingPrice?Number(c.shippingPrice):void 0,discount:{...c.discount,discountValue:c.discount.discountValue?Number(c.discount.discountValue):void 0},variants:o?.map(t=>({...t,price:Number(t.price),quantity:Number(t.quantity),discount:{...t.discount,discountValue:t.discount.discountValue?Number(t.discount.discountValue):void 0}})),images:i};return await p.createProduct(f)},onSuccess:e=>{n.invalidateQueries({queryKey:m}),l.success(e.message||"Product created successfully")},onError:e=>{const i=e.response?.data?.message||"Failed to create product";l.error(i),console.error("Create product error:",e)}})}function I(){return v({mutationFn:async({id:e,data:i})=>{let o=i.existingImages||[];if(i.imageFiles&&i.imageFiles.length>0)try{const s=await p.uploadProductImages(i.imageFiles);o=[...o,...s]}catch(s){throw console.error("Failed to upload product images:",s),l.error("Failed to upload product images"),s}let u=i.variants;if(i.variantFiles&&i.variantFiles.length>0&&u){const s=new Map;for(const r of i.variantFiles)if(r.files.length>0)try{const a=await p.uploadProductImages(r.files);r.variantIndex!==void 0?s.set(r.variantIndex,a):u=u.map(y=>y.color===r.variantId?{...y,images:[...y.images||[],...a]}:y)}catch(a){throw console.error("Failed to upload variant images:",a),l.error("Failed to upload variant images"),a}s.size>0&&(u=u.map((r,a)=>{const y=s.get(a);return y?{...r,images:[...r.images||[],...y]}:r}))}const{imageFiles:g,variantFiles:c,existingImages:f,...t}=i,d={...t,price:t.price!==void 0?Number(t.price):void 0,quantity:t.quantity!==void 0?Number(t.quantity):void 0,outOfStock:t.outOfStock,shippingPrice:t.shippingPrice?Number(t.shippingPrice):void 0,discount:t.discount?{...t.discount,discountValue:t.discount.discountValue?Number(t.discount.discountValue):void 0}:void 0,variants:u?.map(s=>{const r=s.discount||{discountType:"none",discountValue:void 0},a=r?.discountValue||"",y=r.discountType!=="none"&&a!==void 0&&a!==null&&a!==""&&(typeof a=="string"?a?.trim()!=="":Number(a)>0);return{...s,price:Number(s.price),quantity:Number(s.quantity),outOfStock:s.outOfStock||!1,discount:y?{discountType:r.discountType,discountValue:Number(a)}:{discountType:"none",discountValue:void 0}}}),images:o};return await p.updateProduct(e,d)},onSuccess:(e,i)=>{n.invalidateQueries({queryKey:m}),n.invalidateQueries({queryKey:["product"]}),n.invalidateQueries({queryKey:["product","id",i.id]}),l.success(e.message||"Product updated successfully")},onError:e=>{const i=e.response?.data?.message||"Failed to update product";l.error(i),console.error("Update product error:",e)}})}function w(){return v({mutationFn:async e=>{let i=e.existingImages||[];if(e.imageFiles&&e.imageFiles.length>0){const s=await Promise.all(e.imageFiles.map(r=>p.uploadProductImages([r]).then(a=>a[0]).catch(a=>{throw console.error("Failed to upload product image:",a),l.error("Failed to upload product image"),a})));i=[...i,...s]}let o=e.variants;if(e.variantFiles&&e.variantFiles.length>0&&o){const s=new Map;for(const r of e.variantFiles)if(r.files.length>0)try{const a=await p.uploadProductImages(r.files);s.set(r.variantIndex,a)}catch(a){console.error("Failed to upload variant images:",a)}o=o.map((r,a)=>{const y=s.get(a);return y?{...r,images:y}:r})}const{imageFiles:u,variantFiles:g,existingImages:c,id:f,...t}=e,d={title:t.title,images:i,isDraft:!0,outOfStock:t.outOfStock,...t.price&&{price:Number(t.price)},...t.description&&{description:t.description},...t.category&&{category:t.category},...t.subCategory&&{subCategory:t.subCategory},...t.quantity!==void 0&&{quantity:Number(t.quantity)},...t.brand&&{brand:t.brand},...t.color&&{color:t.color},...t.locationIds&&{locationIds:t.locationIds},...t.productTag&&{productTag:t.productTag},...t.marketplaceOptions&&{marketplaceOptions:t.marketplaceOptions},...t.pickupHours&&{pickupHours:t.pickupHours},...t.shippingPrice&&{shippingPrice:Number(t.shippingPrice)},...t.readyByDays&&{readyByDays:Number(t.readyByDays)},...t.dimensions&&{dimensions:{width:t.dimensions.width?Number(t.dimensions.width):void 0,length:t.dimensions.length?Number(t.dimensions.length):void 0,height:t.dimensions.height?Number(t.dimensions.height):void 0}},...t.discount&&{discount:{...t.discount,discountValue:t.discount.discountValue?Number(t.discount.discountValue):void 0}},...o&&{variants:o.map(s=>({...s,price:Number(s.price),quantity:Number(s.quantity),outOfStock:s.outOfStock,discount:{...s.discount,discountValue:s.discount.discountValue?Number(s.discount.discountValue):void 0}}))}};return f?await p.updateDraft(f,d):await p.saveDraft(d)},onSuccess:(e,i)=>{n.invalidateQueries({queryKey:m}),i.id&&n.invalidateQueries({queryKey:["product","id",i.id]}),l.success(e.message||"Draft saved successfully")},onError:e=>{const i=e.response?.data?.message||"Failed to save draft";l.error(i),console.error("Save draft error:",e)}})}function S(){return v({mutationFn:e=>p.deleteProduct(e),onSuccess:e=>{n.invalidateQueries({queryKey:m}),l.success(e.message||"Product deleted successfully")},onError:e=>{const i=e.response?.data?.message||"Failed to delete product";l.error(i),console.error("Delete product error:",e)}})}function N(){return v({mutationFn:({id:e,status:i})=>p.toggleProductStatus(e,i),onMutate:async({id:e,status:i})=>{await n.cancelQueries({queryKey:m});const o=n.getQueryData(m);return n.setQueryData(m,u=>u&&{...u,data:{...u.data,products:u.data.products?.map(g=>g._id===e||g.id===e?{...g,status:i}:g)}}),{previousProducts:o}},onError:(e,i,o)=>{o?.previousProducts&&n.setQueryData(m,o.previousProducts);const u=e.response?.data?.message||"Failed to update product status";l.error(u)},onSuccess:()=>{l.success("Product status updated successfully")},onSettled:()=>{n.invalidateQueries({queryKey:m})}})}function Q(){return v({mutationFn:({id:e,quantity:i,variants:o,outOfStock:u})=>p.updateProductStock(e,{quantity:i,variants:o,outOfStock:u}),onMutate:async({id:e,quantity:i,outOfStock:o})=>{await n.cancelQueries({queryKey:m});const u=n.getQueryData(m);return n.setQueryData(m,g=>g&&{...g,data:{...g.data,products:g.data.products?.map(c=>{if(c._id===e||c.id===e){const f=i===0?"out_of_stock":c.status==="out_of_stock"?"active":c.status;return{...c,quantity:i,status:f}}return c})}}),{previousProducts:u}},onError:(e,i,o)=>{o?.previousProducts&&n.setQueryData(m,o.previousProducts);const u=e.response?.data?.message||"Failed to update product stock";l.error(u)},onSuccess:()=>{l.success("Product stock updated successfully")},onSettled:()=>{n.invalidateQueries({queryKey:m}),n.invalidateQueries({queryKey:["product"]})}})}function D(e){return F({queryKey:[...m,e],queryFn:()=>p.getProducts(e),staleTime:300*1e3,gcTime:600*1e3})}function k(e){return console.log("slug-1",e),F({queryKey:h(e),queryFn:()=>p.getProductBySlug(e),enabled:!!e,staleTime:300*1e3,gcTime:600*1e3})}function V(e){return F({queryKey:["product","id",e],queryFn:()=>p.getProductById(e),enabled:!!e})}export{w as a,D as b,S as c,k as d,V as e,I as f,N as g,Q as h,q as u};
