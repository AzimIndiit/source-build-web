import{u as d,Z as l,n as u,T as c,I as n,H as m}from"./index-BCiIUrXb.js";function p(){const a=d();return l({mutationFn:s=>c.signup(s),onSuccess:async s=>{if(s?.data?.user?.email){sessionStorage.setItem("signup_email",s.data.user.email);try{await c.createOtp({email:s.data.user.email,type:"UR"}),localStorage.setItem("otp_resend_timestamp",Date.now().toString()),n.success("OTP sent to your email successfully!")}catch(r){console.error("Failed to send OTP:",r)}}a("/auth/verify-otp")},onError:s=>{let r="Failed to create account. Please try again.";s.response?r=s.response.data?.message||s.response.data?.error?.message||r:s.request?r="No response from server. Please check your connection.":s.message&&(r=s.message),n.error(r),console.error("Signup error:",s)}})}function h(){const a=d(),{setUser:s,setIsAuthenticated:r,checkAuth:f}=u();return l({mutationFn:t=>c.verifyOtp(t),onSuccess:async t=>{if(console.log("response.data",t.data),t?.data?.tokens){const o=t.data.tokens.accessToken,i=t.data.tokens.refreshToken;o&&i&&(localStorage.setItem("access_token",o),localStorage.setItem("refresh_token",i))}const e=t?.data?.user;if(sessionStorage.removeItem("signup_email"),localStorage.removeItem("otp_resend_timestamp"),e){const o={...e,id:e.id||e._id||"",email:e.email,displayName:e.displayName||`${e.firstName||""} ${e.lastName||""}`.trim()||e.email,role:e.role,isVerified:!0,firstName:e.firstName||"",lastName:e.lastName||"",company:e.businessName||"",region:"",address:e.businessAddress||"",description:"",phone:e.phone||"",createdAt:e.createdAt||new Date().toISOString()};if(r(!0),localStorage.setItem("user",JSON.stringify(o)),m.invalidateQueries({queryKey:["user"]}),n.success(t.message||"Email verified successfully!"),e.role==="driver"){const i=e.vehicles?.length>0;console.log("hasVehicles",i),a(i?"/driver":"/vehicle-information")}else s(o),a(e.role==="seller"?"/seller/dashboard":"/")}else try{await f(),m.invalidateQueries({queryKey:["user"]}),n.success(t.message||"Email verified successfully!");const o=u.getState().user,i=o?.role==="driver"?"/vehicle-information":o?.role==="seller"?"/seller/dashboard":"/";console.log("hasVehicles",i,o),a(i)}catch(o){console.error("Failed to fetch profile:",o),n.success(t.message||"Email verified successfully!"),a("/")}},onError:t=>{let e="Invalid OTP. Please try again.";t.response?e=t.response.data?.message||t.response.data?.error?.message||e:t.request?e="No response from server. Please check your connection.":t.message&&(e=t.message),n.error(e),console.error("OTP verification error:",t)}})}function y(){return l({mutationFn:a=>c.resendOtp(a),onSuccess:a=>{n.success(a.message||"OTP resent successfully!")},onError:a=>{let s="Failed to resend OTP. Please try again.";a.response?s=a.response.data?.message||a.response.data?.error?.message||s:a.request?s="No response from server. Please check your connection.":a.message&&(s=a.message),n.error(s),console.error("Resend OTP error:",a)}})}export{h as a,y as b,p as u};
