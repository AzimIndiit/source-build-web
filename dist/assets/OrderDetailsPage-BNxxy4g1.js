import{j as e,K as O,X as R,bw as M,r as v,af as T,ag as $,aD as _,aE as I,B as g,bz as B,aK as j,g as F,Z as D,a5 as L,S as r,ad as z,u as U,aX as E}from"./index-CUSVstqU.js";import{O as H}from"./OrderProductCard-CeIdk2Wm.js";import{o as k,c as V}from"./useOrderMutations-CL6oNQvb.js";import{U as W}from"./upload-BVTc7vsb.js";import{C as A}from"./CustomerDetailsSection-Bh0WC976.js";import"./StarRating-sEf5bhyI.js";import"./badge-c_xwgsXg.js";import"./date-utils-CIparGJB.js";import"./orderUtils-DR-jD4b-.js";import"./colorUtils-BjIcJb6R.js";const G=(t,s)=>{const d=new Date(s),i=o=>o.toLocaleDateString("en-US",{month:"short",day:"2-digit",year:"numeric"})+" at "+o.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),l=[{title:"Order Received",description:"New order received and pending confirmation",date:i(d),completed:!1},{title:"Order Confirmed",description:"Order has been confirmed and is being prepared.",date:i(new Date(d.getTime()+3600*1e3)),completed:!1},{title:"In Transit",description:"Shipment arrived at Driver location",date:i(new Date(d.getTime()+480*60*1e3)),completed:!1},{title:"Out for Delivery",description:"Driver has picked up the order and is en route to the customer.",date:i(new Date(d.getTime()+1440*60*1e3)),completed:!1},{title:"Delivered",description:"Order successfully delivered to the customer.",date:i(new Date(d.getTime()+1440*60*1e3)),completed:!1}];switch(t.toLowerCase()){case"pending":l[0].completed=!0;break;case"processing":l[0].completed=!0,l[1].completed=!0;break;case"in transit":l[0].completed=!0,l[1].completed=!0,l[2].completed=!0;break;case"out for delivery":l[0].completed=!0,l[1].completed=!0,l[2].completed=!0,l[3].completed=!0;break;case"delivered":l.forEach(o=>o.completed=!0);break;case"cancelled":return[{title:"Order Received",description:"New order received and pending confirmation",date:i(d),completed:!0},{title:"Order Cancelled",description:"Order has been cancelled",date:i(new Date),completed:!0,isLast:!0}];default:l[0].completed=!0}return l[l.length-1].isLast=!0,l},J=({order:t})=>{const s=G(t.status,t.date);return e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Booking Status"}),e.jsx(O,{className:"relative p-4 border-gray-200 shadow-none gap-0",children:s.map((d,i)=>e.jsxs("div",{className:"flex gap-4 relative",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:R("w-10 h-10 rounded-full flex items-center justify-center z-10",d.completed?"bg-green-500":"bg-gray-300"),children:d.completed?e.jsx(M,{className:"w-5 h-5 text-white",strokeWidth:3}):e.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center bg-gray-300",children:e.jsx("span",{className:"text-xs text-gray-500",children:i+1})})}),!d.isLast&&e.jsx("div",{className:R("w-0.5 flex-1 ",d.completed&&i==s.length-1?"bg-green-500":"bg-gray-300"),style:{minHeight:"80px"}})]}),e.jsxs("div",{className:"flex-1 pb-8",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-1",children:d.title}),e.jsx("p",{className:"text-sm text-gray-500 mb-2",children:d.description}),e.jsx("p",{className:"text-xs text-gray-400",children:d.date})]})]},i))})]})},K=({isOpen:t,onClose:s,onSubmit:d,isSubmitting:i=!1})=>{const[l,o]=v.useState(null),[m,a]=v.useState(null),[c,N]=v.useState(""),[y,f]=v.useState(!1),b=v.useRef(null),x=n=>{if(!n.type.startsWith("image/")){j.error("Please select an image file");return}if(n.size>5*1024*1024){j.error("File size must be less than 5MB");return}o(n);const u=new FileReader;u.onloadend=()=>{a(u.result)},u.readAsDataURL(n)},p=n=>{const u=n.target.files?.[0];u&&x(u)},h=n=>{n.preventDefault(),f(!0)},w=n=>{n.preventDefault(),f(!1)},S=n=>{n.preventDefault(),f(!1);const u=n.dataTransfer.files[0];u&&x(u)},P=async()=>{await d(l,c)},C=()=>{o(null),a(null),N(""),s()};return e.jsx(T,{open:t,onOpenChange:n=>!n&&C(),children:e.jsxs($,{className:"max-w-2xl bg-white",children:[e.jsx(_,{children:e.jsx(I,{className:"text-2xl font-semibold",children:"Photo Confirmation for Secure Drop-Offs"})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{onDragOver:h,onDragLeave:w,onDrop:S,onClick:()=>b.current?.click(),className:`
              border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-all
              ${y?"border-primary bg-blue-50":"border-gray-300 hover:border-gray-400"}
              ${m?"p-4":"p-8"}
            `,children:m?e.jsxs("div",{className:"space-y-4",children:[e.jsx("img",{src:m,alt:"Proof of delivery preview",className:"mx-auto max-h-64 rounded-lg"}),e.jsx(g,{variant:"outline",size:"sm",onClick:n=>{n.stopPropagation(),o(null),a(null)},className:"mx-auto",children:"Remove Image"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(W,{className:"w-12 h-12 mx-auto text-gray-400"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-gray-600",children:["Drag & drop media or"," ",e.jsx("span",{className:"text-primary font-medium",children:"click here"})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Maximum file size: 5MB â€¢ Supported formats: JPG, PNG, GIF"})]})]})}),e.jsx("input",{ref:b,type:"file",accept:"image/*",onChange:p,className:"hidden"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Message (optional)"}),e.jsx("textarea",{value:c,onChange:n=>N(n.target.value),placeholder:"Type Message Here",className:"w-full p-3 border border-gray-300 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent",rows:4})]}),e.jsxs(B,{children:[e.jsx(g,{variant:"outline",onClick:C,disabled:i,className:"px-8",children:"Cancel"}),e.jsx(g,{type:"button",variant:"default",onClick:P,disabled:i||!l,className:"px-8 text-white hover:text-white",children:i?"Submitting...":"Mark Delivered"})]})]})})},X=({order:t,orderSummary:s,showHelpBtn:d,refetch:i})=>{const{user:l}=F(),[o,m]=v.useState(!1),[a,c]=v.useState(!1),N=async()=>{if(t?._id){m(!0);try{await k.updateOrderStatus(t._id,"Out for Delivery"),j.success("Delivery started successfully!"),i?.()}catch(x){console.error("Failed to start delivery:",x);const p=x?.response?.data?.message||"Failed to start delivery. Please try again.";j.error(p)}finally{m(!1)}}},y=async()=>{if(!t?._id)return;const x=window.prompt("Please provide a reason for cancellation:");if(x){m(!0);try{await k.cancelOrder(t._id,x),j.success("Order cancelled successfully!"),i?.()}catch(p){console.error("Failed to cancel order:",p);const h=p?.response?.data?.message||"Failed to cancel order. Please try again.";j.error(h)}finally{m(!1)}}},f=()=>{c(!0)},b=async(x,p)=>{if(console.log("order",t),!!t?._id){m(!0);try{let h="";x&&(h=(await L.uploadFile(x)).data.url),await k.markAsDelivered(t._id,h,p),j.success("Order marked as delivered successfully!"),c(!1),i?.()}catch(h){console.error("Failed to mark order as delivered:",h);const w=h?.response?.data?.message||"Failed to mark order as delivered. Please try again.";j.error(w)}finally{m(!1)}}};return console.log("order?.status",t?.status),e.jsxs(O,{className:"w-full p-4 gap-3 border-gray-200 shadow-none",children:[l?.role==="driver"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Pick Up Location"}),e.jsx("div",{className:"space-y-2",children:s.pickupAddress?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-base text-gray-600",children:[s.pickupAddress.name,", ",s.pickupAddress.phone]}),e.jsx("p",{className:"text-sm text-gray-500 leading-relaxed",children:s.formattedPickupAddress||`${s.pickupAddress.address}, ${s.pickupAddress.city}, ${s.pickupAddress.state}, ${s.pickupAddress.country}, ${s.pickupAddress.zip}`})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-base text-gray-600",children:"Judy Nguyen, +1 972 234 5678"}),e.jsx("p",{className:"text-sm text-gray-500 leading-relaxed",children:"SCO 50-51, Sub. City Center, 2nd Floor Sector 34A, Sector 34, Chandigarh, 160022, punjab, India"})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Drop Address"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-base text-gray-600",children:[s.shippingAddress.name||"Yousef Alaoui",","," ",s.shippingAddress.phone||"+1 786 234 5678"]}),e.jsx("p",{className:"text-sm text-gray-500 leading-relaxed",children:s.formattedShippingAddress||`${s.shippingAddress.address}, ${s.shippingAddress.city}, ${s.shippingAddress.state}, ${s.shippingAddress.country}, ${s.shippingAddress.zip}`})]})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Shipping Address"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-base  text-gray-600",children:[s.shippingAddress.name,", ",s.shippingAddress.phone]}),e.jsx("p",{className:"text-sm text-gray-500 leading-relaxed",children:s.formattedShippingAddress||`${s.shippingAddress.address}, ${s.shippingAddress.city}, ${s.shippingAddress.state}, ${s.shippingAddress.country}, ${s.shippingAddress.zip}`})]})]}),s.proofOfDelivery&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Proof of Delivery"}),d&&e.jsx("div",{className:"flex justify-end",children:e.jsx(g,{className:"h-[40px] text-white",children:"Help"})})]}),e.jsx("div",{className:"rounded-lg w-48 h-48 overflow-hidden border border-gray-200",children:e.jsx("img",{src:s.proofOfDelivery,alt:"Proof of delivery",className:" w-full h-full object-cover"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Order Summary"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-[#98a2b3]",children:"Sub total"}),e.jsx("span",{className:"text-base font-medium text-gray-900",children:D(Number(s.subTotal))})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-[#98a2b3]",children:"Shipping fee"}),e.jsx("span",{className:"text-base font-medium text-gray-900",children:D(Number(s.shippingFee))})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-[#98a2b3]",children:"Marketplace Fee"}),e.jsx("span",{className:"text-base font-medium text-gray-900",children:D(Number(s.marketplaceFee))})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-[#98a2b3]",children:"Taxes"}),e.jsx("span",{className:"text-base font-medium text-gray-900",children:D(Number(s.taxes))})]}),e.jsx("div",{className:"border-t border-gray-200 pt-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-base font-semibold text-gray-900",children:"Total you'll receive"}),e.jsx("span",{className:"text-lg font-bold text-primary",children:D(Number(s.total))})]})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Payment"}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-[#98a2b3] uppercase tracking-wide",children:s.paymentMethod?.type}),e.jsx("p",{className:"text-base font-medium text-gray-900",children:s.paymentMethod?.cardNumber})]}),e.jsx("div",{className:"text-lg font-bold text-primary italic",children:s.paymentMethod?.cardType})]})})]}),(t?.status==="Processing"||t?.status==="In Transit")&&l?.role==="driver"&&e.jsxs("div",{className:"space-y-2 flex justify-end gap-2",children:[e.jsx(g,{variant:"outline",className:"border-gray-300 text-gray-700 hover:bg-gray-50 w-[124px]",onClick:y,disabled:o,children:"Cancel"}),e.jsx(g,{type:"button",className:"w-[124px] text-white hover:text-white",onClick:N,disabled:o,children:o?"Starting...":"Start"})]}),t?.status==="Out for Delivery"&&l?.role==="driver"&&e.jsxs("div",{className:"space-y-2 flex justify-end gap-2",children:[e.jsx(g,{variant:"outline",className:"border-gray-300 text-gray-700 hover:bg-gray-50 w-[124px]",onClick:y,disabled:o,children:"Cancel"}),e.jsx(g,{className:"w-[180px] text-white hover:text-white",onClick:f,disabled:o,children:o?"Marking...":"Mark as Delivered"})]}),e.jsx(K,{isOpen:a,onClose:()=>c(!1),onSubmit:b,isSubmitting:o})]})},Q=()=>e.jsxs("div",{className:"py-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(r,{className:"h-4 w-16"}),e.jsx(r,{className:"h-4 w-2"}),e.jsx(r,{className:"h-4 w-24"})]}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsx("div",{className:"lg:w-1/3",children:e.jsx(r,{className:"w-full h-48 rounded-lg"})}),e.jsxs("div",{className:"lg:w-2/3 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(r,{className:"h-6 w-32"}),e.jsx(r,{className:"h-8 w-20 rounded-full"})]}),e.jsx(r,{className:"h-5 w-48"}),e.jsx(r,{className:"h-4 w-64"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(r,{className:"h-6 w-24"}),e.jsxs("div",{className:"space-y-2 text-right",children:[e.jsx(r,{className:"h-4 w-20"}),e.jsx(r,{className:"h-4 w-16"}),e.jsx(r,{className:"h-4 w-18"})]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx(r,{className:"h-6 w-32 mb-4"}),e.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[e.jsx(r,{className:"w-12 h-12 rounded-full"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{className:"h-4 w-24"}),e.jsx(r,{className:"h-3 w-32"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{className:"h-4 w-full"}),e.jsx(r,{className:"h-4 w-3/4"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx(r,{className:"h-6 w-24 mb-4"}),e.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[e.jsx(r,{className:"w-12 h-12 rounded-full"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{className:"h-4 w-24"}),e.jsx(r,{className:"h-3 w-32"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx(r,{className:"h-6 w-28 mb-4"}),e.jsx("div",{className:"space-y-4",children:Array.from({length:4}).map((t,s)=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(r,{className:"w-8 h-8 rounded-full"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{className:"h-4 w-32"}),e.jsx(r,{className:"h-3 w-20"})]})]},s))})]})]}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx(r,{className:"h-6 w-32 mb-6"}),e.jsxs("div",{className:"mb-6",children:[e.jsx(r,{className:"h-5 w-28 mb-3"}),e.jsx(r,{className:"h-4 w-full"}),e.jsx(r,{className:"h-4 w-3/4"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx(r,{className:"h-5 w-32 mb-3"}),e.jsx(r,{className:"h-4 w-48"})]}),e.jsxs("div",{className:"space-y-3 border-t pt-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(r,{className:"h-4 w-20"}),e.jsx(r,{className:"h-4 w-16"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(r,{className:"h-4 w-24"}),e.jsx(r,{className:"h-4 w-16"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(r,{className:"h-4 w-28"}),e.jsx(r,{className:"h-4 w-16"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(r,{className:"h-4 w-16"}),e.jsx(r,{className:"h-4 w-16"})]}),e.jsxs("div",{className:"flex justify-between border-t pt-3",children:[e.jsx(r,{className:"h-5 w-20"}),e.jsx(r,{className:"h-5 w-20"})]})]})]})})]})]}),de=()=>{const{user:t}=F(),{id:s}=z(),d=U(),{data:i,isLoading:l,isError:o,refetch:m}=V(s||"");if(l)return e.jsx(Q,{});if(o||!i?.data)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Order Not Found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"The order you're looking for doesn't exist."}),e.jsx(g,{className:"text-white hover:text-white",onClick:()=>d(`/${t?.role}/orders`),children:"Back to Orders"})]})});const a=i.data,c={_id:a._id,id:a.orderNumber||a._id,seller:{id:a.seller?.userRef?._id||"",displayName:a.seller?.userRef?.displayName||"Seller",email:a.seller?.userRef?.email||"",avatar:a.seller?.userRef?.avatar||"",rating:a.seller?.reviewRef?.rating,review:a.seller?.reviewRef?.review},customer:{id:a.customer?.userRef?._id||"",displayName:a.customer?.userRef?.displayName||"Customer",email:a.customer?.userRef?.email||"",avatar:a.customer?.userRef?.avatar||"",rating:a.customer?.reviewRef?.rating,review:a.customer?.reviewRef?.review},driver:a.driver?{id:a.driver?.userRef?._id||"",displayName:a.driver?.userRef?.displayName||"Driver",email:a.driver?.userRef?.email||"",avatar:a.driver?.userRef?.avatar||"",rating:a.driver?.reviewRef?.rating,review:a.driver?.reviewRef?.review}:void 0,products:a.products,date:a.date,amount:a.amount,status:a.status,orderSummary:a.orderSummary?{shippingAddress:a.orderSummary.shippingAddress,pickupAddress:a.orderSummary.pickupAddress||null,proofOfDelivery:a.orderSummary.proofOfDelivery||"",paymentMethod:{type:a.orderSummary.paymentMethod.type,cardType:a.orderSummary.paymentMethod.cardType||"",cardNumber:a.orderSummary.paymentMethod.cardNumber||""},subTotal:a.orderSummary.subTotal,shippingFee:a.orderSummary.shippingFee,marketplaceFee:a.orderSummary.marketplaceFee,taxes:a.orderSummary.taxes,total:a.orderSummary.total}:void 0},N=[{label:"Orders",href:t?.role==="buyer"?"/buying":`/${t?.role}/orders`},{label:"Order Details",isCurrentPage:!0}],y=()=>{m()},f=({slug:w})=>{console.log("Viewing item..."),d(`/${t?.role}/products/${w}`)},b=c.customer?.rating&&c.customer.rating>0,x=c.driver?.rating&&c.driver.rating>0,p=!b&&!x,h=!!(c.status==="Delivered"&&p);return e.jsxs("div",{className:"py-4 md:p-6 space-y-6",children:[t?.role!="admin"&&e.jsx(E,{items:N}),e.jsx(H,{order:c,onViewItem:f,onWriteReview:y}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:" space-y-4",children:[c?.seller&&t?.role==="driver"&&e.jsx(A,{customerDetails:c.seller,title:"Vendor Details",reviewTitle:"Reviews & Rating From Vendor"}),e.jsx(A,{customerDetails:c.customer,title:"Customer Details",reviewTitle:"Reviews & Rating From Customer"}),c?.driver&&t?.role==="seller"&&e.jsx(A,{customerDetails:c.driver,title:"Assign To",reviewTitle:"Reviews & Rating From Driver"}),p&&e.jsx(J,{order:c})]}),e.jsx("div",{className:"lg:col-span-2",children:e.jsx(X,{refetch:m,order:c,showHelpBtn:h,orderSummary:c.orderSummary})})]})]})};export{de as default};
