import{u as d,E as c,l as g,w as l,z as n,G as m}from"./index-CUSVstqU.js";function p(){const a=d();return c({mutationFn:s=>l.signup(s),onSuccess:async s=>{if(s?.data?.user?.email){sessionStorage.setItem("signup_email",s.data.user.email);try{await l.createOtp({email:s.data.user.email,type:"UR"}),localStorage.setItem("otp_resend_timestamp",Date.now().toString()),n.success("OTP sent to your email successfully!")}catch(o){console.error("Failed to send OTP:",o)}}a("/auth/verify-otp")},onError:s=>{let o="Failed to create account. Please try again.";s.response?o=s.response.data?.message||s.response.data?.error?.message||o:s.request?o="No response from server. Please check your connection.":s.message&&(o=s.message),n.error(o),console.error("Signup error:",s)}})}function y(){const a=d(),{setUser:s,setIsAuthenticated:o}=g();return c({mutationFn:t=>l.verifyOtp(t),onSuccess:async t=>{if(console.log("response.data",t.data),t?.data?.tokens){const i=t.data.tokens.accessToken,r=t.data.tokens.refreshToken;i&&r&&(localStorage.setItem("access_token",i),localStorage.setItem("refresh_token",r))}const e=t?.data?.user;if(console.log("profile",e),!e){a("/auth/login");return}if(e){const i={...e,id:e.id||e._id||"",email:e.email,displayName:e.displayName||`${e.firstName||""} ${e.lastName||""}`.trim()||e.email,role:e.role,isVerified:!0,firstName:e.firstName||"",lastName:e.lastName||"",company:e.businessName||"",region:"",address:e.businessAddress||"",description:"",phone:e.phone||"",createdAt:e.createdAt||new Date().toISOString()};if(sessionStorage.removeItem("signup_email"),localStorage.removeItem("otp_resend_timestamp"),e.role==="driver"){const r=e.vehicles?.length>0,u=e.isLicense||!1;console.log("hasVehicles",r),console.log("hasLicense",u),s(i),o(!0),localStorage.setItem("user",JSON.stringify(i)),n.success(t.message||"Email verified successfully!"),setTimeout(()=>{a(r?u?"/driver/dashboard":"/auth/driver-license":"/auth/vehicle-information")},100),m.invalidateQueries({queryKey:["user"]})}else s(i),o(!0),localStorage.setItem("user",JSON.stringify(i)),n.success(t.message||"Email verified successfully!"),setTimeout(()=>{a(e.role==="seller"?"/seller/dashboard":"/")},100),m.invalidateQueries({queryKey:["user"]})}},onError:t=>{let e="Invalid OTP. Please try again.";t.response?e=t.response.data?.message||t.response.data?.error?.message||e:t.request?e="No response from server. Please check your connection.":t.message&&(e=t.message),n.error(e),console.error("OTP verification error:",t)}})}function h(){return c({mutationFn:a=>l.resendOtp(a),onSuccess:a=>{n.success(a.message||"OTP resent successfully!")},onError:a=>{let s="Failed to resend OTP. Please try again.";a.response?s=a.response.data?.message||a.response.data?.error?.message||s:a.request?s="No response from server. Please check your connection.":a.message&&(s=a.message),n.error(s),console.error("Resend OTP error:",a)}})}export{y as a,h as b,p as u};
