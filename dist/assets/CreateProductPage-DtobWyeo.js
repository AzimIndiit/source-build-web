import{u as fe,r as u,ao as ve,ap as ye,o as be,p as xe,I as p,j as n,F as we,a1 as Pe,B as G,aT as Te,aU as ke,au as Ve,E as y,A as l,_ as X,ai as N,$ as E}from"./index-BCiIUrXb.js";import{v as O,P as _,a as Fe}from"./imageValidation-C4rbLUvl.js";import{b as Se,c as Ce}from"./useProductMutations-BwEQtzFr.js";import"./FormSelect-prL940lU.js";import"./index-BdQq_4o_.js";import"./badge-C6OOTzUs.js";import"./PickupHoursSelector-BvNq3gU7.js";import"./upload-Brfr3HgH.js";import"./trash-2-Ct1NlBzh.js";import"./calendar-D77CX2lA.js";const Ae=y({color:l().trim().min(1,"Color is required").regex(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,"Please enter a valid HEX color code"),quantity:l().trim().min(1,"Quantity is required").regex(/^\d+$/,"Quantity must be a whole number").refine(t=>parseInt(t)>0,"Quantity must be at least 1"),price:l().trim().min(1,"Price is required").regex(/^\d+(\.\d{1,2})?$/,"Price must be a valid number").refine(t=>parseFloat(t)>0,"Price must be greater than 0"),discount:y({discountType:X(["none","flat","percentage"]),discountValue:l().optional()}).refine(t=>t.discountType!=="none"?t.discountValue&&t.discountValue.trim().length>0:!0,{message:"Discount value is required when discount type is selected",path:["discountValue"]}).refine(t=>{if(t.discountType==="percentage"&&t.discountValue){const o=parseFloat(t.discountValue);return!isNaN(o)&&o>=0&&o<=100}return!0},{message:"Percentage discount must be between 0 and 100",path:["discountValue"]}).refine(t=>{if(t.discountType==="flat"&&t.discountValue){const o=parseFloat(t.discountValue);return!isNaN(o)&&o>=0}return!0},{message:"Flat discount must be a positive number",path:["discountValue"]})}),qe=y({title:l().trim().min(3,"Title must be at least 3 characters").max(100,"Title must not exceed 100 characters"),price:l().trim().min(1,"Price is required").regex(/^\d+(\.\d{1,2})?$/,"Price must be a valid number with up to 2 decimal places").refine(t=>parseFloat(t)>0,"Price must be greater than 0").refine(t=>parseFloat(t)<=999999.99,"Price must not exceed 999,999.99"),description:l().trim().min(10,"Description must be at least 10 characters").max(2e3,"Description must not exceed 2000 characters"),category:l().trim().min(1,"Category is required").max(50,"Category must not exceed 50 characters"),subCategory:l().trim().min(1,"Sub category is required").max(50,"Sub category must not exceed 50 characters"),quantity:l().trim().min(1,"Quantity is required").regex(/^\d+$/,"Quantity must be a whole number").refine(t=>parseInt(t)>0,"Quantity must be at least 1").refine(t=>parseInt(t)<=99999,"Quantity must not exceed 99,999"),brand:l().trim().min(2,"Brand must be at least 2 characters").max(50,"Brand must not exceed 50 characters").regex(/^[a-zA-Z0-9\s\-&.]+$/,"Brand can only contain letters, numbers, spaces, hyphens, ampersands, and periods"),color:l().trim().min(1,"Color is required").regex(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,"Please enter a valid HEX color code (e.g., #FF0000)"),locationIds:E(l()).min(1,"At least one location is required").max(10,"Maximum 10 locations allowed"),productTag:E(l().trim().min(2,"Each tag must be at least 2 characters").max(30,"Each tag must not exceed 30 characters").regex(/^[a-zA-Z0-9\s\-#]+$/,"Tags can only contain letters, numbers, spaces, hyphens, and hashtags")).min(1,"At least one product tag is required").max(10,"Maximum 10 tags allowed"),variants:E(Ae).max(5,"Maximum 5 variants allowed").optional(),marketplaceOptions:y({pickup:N().optional(),shipping:N().optional(),delivery:N().optional()}).required().refine(t=>t.pickup||t.shipping||t.delivery,{message:"At least one marketplace option (Pickup, Shipping, or Delivery) must be selected"}),pickupHours:l().trim().max(100,"Pickup hours must not exceed 100 characters").optional(),shippingPrice:l().trim().optional(),readyByDate:l().min(1,"Date is required"),readyByTime:l().min(1,"Time is required"),dimensions:y({width:l().optional(),length:l().optional(),height:l().optional()}).optional(),discount:y({discountType:X(["none","flat","percentage"]),discountValue:l().optional()}).refine(t=>t.discountType!=="none"?t.discountValue&&t.discountValue.trim().length>0:!0,{message:"Discount value is required when discount type is selected",path:["discountValue"]}).refine(t=>{if(t.discountType==="percentage"&&t.discountValue){const o=parseFloat(t.discountValue);return!isNaN(o)&&o>=0&&o<=100}return!0},{message:"Percentage discount must be between 0 and 100",path:["discountValue"]}).refine(t=>{if(t.discountType==="flat"&&t.discountValue){const o=parseFloat(t.discountValue);return!isNaN(o)&&o>=0}return!0},{message:"Flat discount must be a positive number",path:["discountValue"]})}).refine(t=>!(t.marketplaceOptions?.pickup&&!t.pickupHours?.trim()),{message:"Pickup hours are required when pickup option is selected",path:["pickupHours"]}).refine(t=>!(t.marketplaceOptions?.shipping&&!t.shippingPrice?.trim()),{message:"Shipping price is required when shipping option is selected",path:["shippingPrice"]}).refine(t=>{if(t.marketplaceOptions?.shipping&&t.shippingPrice?.trim()){if(!/^\d+(\.\d{1,2})?$/.test(t.shippingPrice))return!1;const g=parseFloat(t.shippingPrice);if(isNaN(g)||g<0)return!1}return!0},{message:"Shipping price must be a valid positive number",path:["shippingPrice"]}).superRefine((t,o)=>{t.marketplaceOptions?.pickup&&!t.pickupHours?.trim()&&o.addIssue({code:"custom",path:["pickupHours"],message:"Pickup hours are required when pickup option is selected"}),t.marketplaceOptions?.shipping&&(t.shippingPrice?.trim()?/^\d+(\.\d{1,2})?$/.test(t.shippingPrice)?parseFloat(t.shippingPrice)<0&&o.addIssue({code:"custom",path:["shippingPrice"],message:"Shipping price must be greater than or equal to 0"}):o.addIssue({code:"custom",path:["shippingPrice"],message:"Shipping price must be a valid number with up to 2 decimals"}):o.addIssue({code:"custom",path:["shippingPrice"],message:"Shipping price is required when shipping option is selected"}))}),$=[{value:"electronics",label:"Electronics"},{value:"clothing",label:"Clothing"},{value:"home",label:"Home & Garden"},{value:"sports",label:"Sports & Outdoors"},{value:"accessories",label:"Accessories"},{value:"commercial",label:"Commercial"},{value:"commercial doors",label:"Commercial Doors"}],W={electronics:[{value:"phones",label:"Phones"},{value:"laptops",label:"Laptops"},{value:"tablets",label:"Tablets"},{value:"headphones",label:"Headphones"},{value:"cameras",label:"Cameras"},{value:"accessories",label:"Accessories"}],clothing:[{value:"mens",label:"Men's Clothing"},{value:"womens",label:"Women's Clothing"},{value:"kids",label:"Kids' Clothing"},{value:"shoes",label:"Shoes"},{value:"accessories",label:"Accessories"}],home:[{value:"furniture",label:"Furniture"},{value:"decor",label:"Decor"},{value:"kitchen",label:"Kitchen"},{value:"bathroom",label:"Bathroom"},{value:"garden",label:"Garden"}],sports:[{value:"fitness",label:"Fitness Equipment"},{value:"outdoor",label:"Outdoor Gear"},{value:"sportswear",label:"Sportswear"},{value:"accessories",label:"Accessories"}],accessories:[{value:"jewelry",label:"Jewelry"},{value:"bags",label:"Bags"},{value:"watches",label:"Watches"},{value:"belts",label:"Belts"},{value:"other",label:"Other"}],commercial:[{value:"equipment",label:"Equipment"},{value:"supplies",label:"Supplies"},{value:"furniture",label:"Furniture"},{value:"tools",label:"Tools"}],"commercial doors":[{value:"doors",label:"Doors"},{value:"windows",label:"Windows"},{value:"glass doors",label:"Glass Doors"},{value:"frames",label:"Frames"},{value:"hardware",label:"Hardware"}]},M=[{value:"casing",label:"Casing"},{value:"trim",label:"Trim"},{value:"molding",label:"Molding"},{value:"hardware",label:"Hardware"},{value:"doors",label:"Doors"},{value:"windows",label:"Windows"},{value:"glass",label:"Glass"},{value:"locks",label:"Locks"},{value:"hinges",label:"Hinges"},{value:"frames",label:"Frames"},{value:"panels",label:"Panels"},{value:"handles",label:"Handles"}],H=5;function ze(){const t=fe(),[o,g]=u.useState([]),[L,k]=u.useState(!1),[U,h]=u.useState(!1),[c,x]=u.useState([]),[K,V]=u.useState(!1),[Z,F]=u.useState(null),[w,Q]=u.useState(!1),[R,S]=u.useState(!1),{data:P,refetch:J}=ve(),z=ye(),C=Se(),A=Ce(),T=Array.isArray(P?.data)?P.data:P?.data?[P.data]:[],q=T.map(e=>({value:e.id||e._id||"",label:`${e.name} , ${e.formattedAddress}`||""})),v=be({resolver:xe(qe),mode:"onChange",reValidateMode:"onChange",defaultValues:{title:"",price:"",description:"",category:"",subCategory:"",quantity:"",brand:"",color:"#000000",locationIds:[],productTag:[],variants:[],marketplaceOptions:{pickup:!1,shipping:!1,delivery:!1},pickupHours:"",shippingPrice:"",readyByDate:"",readyByTime:"",dimensions:{width:"",length:"",height:""},discount:{discountType:"none",discountValue:""}}}),{handleSubmit:Y,watch:ee,getValues:te,setValue:b,setFocus:D,clearErrors:De,setError:j,formState:{errors:je}}=v,f=ee(),I=f.category?W[f.category]||[]:[];u.useEffect(()=>{if(f.category){const e=f.subCategory;!(W[f.category]||[]).some(a=>a.value===e)&&e&&v.setValue("subCategory","")}else v.setValue("subCategory","")},[f.category,v]);const se=u.useCallback(e=>{e.preventDefault(),e.stopPropagation(),e.type==="dragenter"||e.type==="dragover"?k(!0):e.type==="dragleave"&&k(!1)},[]),ae=u.useCallback(async e=>{if(e.preventDefault(),e.stopPropagation(),k(!1),e.dataTransfer.files&&e.dataTransfer.files[0]){const i=Array.from(e.dataTransfer.files),{validFiles:r,errors:a}=await O(i,H,o.length);r.length>0&&(g(s=>[...s,...r]),h(!1)),a.forEach(s=>p.error(s))}},[o]),ie=async e=>{if(e.target.files){const i=Array.from(e.target.files),{validFiles:r,errors:a}=await O(i,H,o.length);r.length>0&&(g(s=>[...s,...r]),h(!1)),a.forEach(s=>p.error(s)),e.target.value=""}},re=e=>{g(i=>i.filter((r,a)=>a!==e))},oe=async e=>{if(o.length<2){h(!0),p.error("Please upload at least 2 product images"),window.scrollTo({top:0,behavior:"smooth"});return}h(!1);const i=c.map((s,d)=>({variant:s,index:d})).filter(({variant:s})=>s.images.length>0).map(({variant:s,index:d})=>({variantId:s.id,variantIndex:d,files:s.images}));console.log("Variants from form:",e.variants),console.log("Variant files to upload:",i);let r;if(e.readyByDate){const s=e.readyByTime||"00:00";r=new Date(`${e.readyByDate}T${s}:00`).toISOString()}const a={title:e.title,price:parseFloat(e.price),description:e.description,category:e.category,subCategory:e.subCategory,quantity:parseInt(e.quantity),brand:e.brand,color:e.color,locationIds:e.locationIds,productTag:e.productTag,marketplaceOptions:e.marketplaceOptions,pickupHours:e.pickupHours,shippingPrice:e.shippingPrice?parseFloat(e.shippingPrice):void 0,readyByDate:r,readyByTime:e.readyByTime,dimensions:e.dimensions&&(e.dimensions.width||e.dimensions.length||e.dimensions.height)?{width:e.dimensions.width?parseFloat(e.dimensions.width):void 0,length:e.dimensions.length?parseFloat(e.dimensions.length):void 0,height:e.dimensions.height?parseFloat(e.dimensions.height):void 0}:void 0,discount:{discountType:e.discount.discountType,discountValue:e.discount.discountValue?parseFloat(e.discount.discountValue):void 0},variants:e.variants?.map(s=>({color:s.color,quantity:parseInt(s.quantity),price:parseFloat(s.price),discount:{discountType:s.discount.discountType,discountValue:s.discount.discountValue?parseFloat(s.discount.discountValue):void 0}})),imageFiles:o,variantFiles:i.length>0?i:void 0};try{await C.mutateAsync(a),t("/seller/products")}catch(s){console.error("Failed to create product:",s)}},ne=async()=>{const e=te();if(!e.title||e.title.trim().length===0){p.error("Title is required to save as draft"),D("title"),j("title",{message:"Title is required to save as draft"});return}if(!e.category||e.category.trim().length===0){p.error("Category is required to save as draft"),D("category"),j("category",{message:"Category is required to save as draft"});return}if(!e.price||e.price.trim().length===0){p.error("Price is required to save as draft"),D("price"),j("price",{message:"Price is required to save as draft"});return}if(o.length<2){h(!0),p.error("At least 2 images are required to save as draft"),window.scrollTo({top:0,behavior:"smooth"});return}h(!1);const i=c.map((s,d)=>({variant:s,index:d})).filter(({variant:s})=>s.images.length>0).map(({variant:s,index:d})=>({variantId:s.id,variantIndex:d,files:s.images}));let r;if(e.readyByDate){const s=e.readyByTime||"00:00";r=new Date(`${e.readyByDate}T${s}:00`).toISOString()}const a={title:e.title,imageFiles:o};e.price&&e.price.trim()&&(a.price=e.price),e.description&&e.description.trim()&&(a.description=e.description),e.category&&e.category.trim()&&(a.category=e.category),e.subCategory&&e.subCategory.trim()&&(a.subCategory=e.subCategory),e.quantity&&e.quantity.trim()&&(a.quantity=e.quantity),e.brand&&e.brand.trim()&&(a.brand=e.brand),e.color&&e.color.trim()&&(a.color=e.color),e.locationIds&&e.locationIds.length>0&&(a.locationIds=e.locationIds),e.productTag&&e.productTag.length>0&&(a.productTag=e.productTag),e.marketplaceOptions&&(e.marketplaceOptions.pickup||e.marketplaceOptions.shipping||e.marketplaceOptions.delivery)&&(a.marketplaceOptions=e.marketplaceOptions),e.pickupHours&&e.pickupHours.trim()&&(a.pickupHours=e.pickupHours),e.shippingPrice&&e.shippingPrice.trim()&&(a.shippingPrice=e.shippingPrice),r&&(a.readyByDate=r,a.readyByTime=e.readyByTime),e.dimensions&&(e.dimensions.width||e.dimensions.length||e.dimensions.height)&&(a.dimensions=e.dimensions),e.discount&&e.discount.discountType!=="none"&&(a.discount={discountType:e.discount.discountType,discountValue:e.discount.discountValue||""}),e.variants&&e.variants.length>0&&(a.variants=e.variants.map(s=>({...s,discount:{discountType:s.discount.discountType,discountValue:s.discount.discountValue||""}}))),i.length>0&&(a.variantFiles=i);try{await A.mutateAsync(a),t("/seller/products")}catch(s){console.error("Failed to save draft:",s)}},le=e=>{if(console.log("Form errors:",e),o.length<2){h(!0),p.error("Please upload at least 2 product images"),setTimeout(()=>{const r=document.getElementById("photos");if(r){const a=r.closest(".overflow-y-auto");if(a){const s=r.getBoundingClientRect(),d=a.getBoundingClientRect();a.scrollTop+=s.top-d.top-100}else r.scrollIntoView({behavior:"smooth",block:"start"})}},100);return}const i=Object.keys(e)[0];if(i){const r=e[i];r?.message&&p.error(r.message),setTimeout(()=>{const a=document.querySelector(`[name="${i}"]`);if(a){const s=a.closest(".overflow-y-auto");if(s){const d=a.getBoundingClientRect(),m=s.getBoundingClientRect(),he=s.scrollTop+d.top-m.top-100;s.scrollTo({top:he,behavior:"smooth"}),setTimeout(()=>{a.focus()},500)}else a.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{a.focus()},500)}},100)}},ce=async e=>{try{await z.mutateAsync(e),await J(),S(!1)}catch(i){console.error("Failed to add address:",i),p.error("Failed to add address")}},ue=()=>{if(c.length>=5){p.error("Maximum 5 variants allowed");return}const e={id:Date.now().toString(),images:[]};x([...c,e]),V(!0);const i=c.length;b(`variants.${i}.color`,"#000000"),b(`variants.${i}.discount.discountType`,"none"),b(`variants.${i}.quantity`,""),b(`variants.${i}.price`,""),b(`variants.${i}.discount.discountValue`,"")},de=e=>{const i=c.findIndex(r=>r.id===e);x(c.filter(r=>r.id!==e)),i!==-1&&v.clearErrors(`variants.${i}`),c.length<=1&&V(!1)},B=u.useCallback(async(e,i)=>{const r=c.find(m=>m.id===e);if(!r)return;const a=5,{validFiles:s,errors:d}=await O(i,a,r.images.length);s.length>0&&x(c.map(m=>m.id===e?{...m,images:[...m.images,...s]}:m)),d.forEach(m=>p.error(m))},[c]),pe=(e,i)=>{x(c.map(r=>r.id===e?{...r,images:r.images.filter((a,s)=>s!==i)}:r))},me=u.useCallback((e,i)=>{e.preventDefault(),e.stopPropagation(),e.type==="dragenter"||e.type==="dragover"?F(i):e.type==="dragleave"&&F(null)},[]),ge=u.useCallback((e,i)=>{if(e.preventDefault(),e.stopPropagation(),F(null),e.dataTransfer.files&&e.dataTransfer.files[0]){const r=Array.from(e.dataTransfer.files);B(i,r)}},[B]);return n.jsxs(we,{...v,children:[n.jsxs("div",{className:"h-screen bg-gray-50 fixed top-0 w-full z-50 left-0 flex flex-col  ",children:[n.jsx("div",{className:"bg-primary px-4 py-3",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[n.jsx("button",{onClick:()=>t(-1),className:"text-white hover:bg-white  hover:text-black p-1 rounded cursor-pointer",children:n.jsx(Pe,{className:"h-5 w-5 sm:h-6 sm:w-6"})}),n.jsxs("div",{children:[n.jsx("div",{className:"text-xs text-blue-100",children:"Marketplace"}),n.jsx("div",{className:"text-white text-sm sm:text-base font-medium",children:"Item for sale"})]})]}),n.jsx("div",{className:"flex items-center gap-2",children:n.jsx(G,{type:"button",onClick:ne,variant:"ghost",className:"text-white hover:bg-white border border-white h-[40px] sm:h-[48px] text-sm sm:text-base hover:text-primary px-3 sm:px-4",disabled:C.isPending||A.isPending,children:A.isPending?"Saving...":"Save Draft"})})]})}),n.jsx("div",{className:"lg:hidden fixed bottom-4 right-4 z-50",children:!w&&n.jsx(G,{type:"button",onClick:()=>Q(!w),className:"bg-primary text-white  p-3 shadow-sm hover:bg-primary/90  rounded-sm flex gap-3 w-fit h-10",children:w?n.jsxs(n.Fragment,{children:[n.jsx("span",{children:"Hide Preview "})," ",n.jsx(Te,{className:"h-6 w-6"})]}):n.jsxs(n.Fragment,{children:[n.jsx("span",{children:"Show Preview "})," ",n.jsx(ke,{className:"h-6 w-6"})]})})}),w&&n.jsx("div",{className:"lg:hidden fixed inset-0 z-[100] bg-white overflow-y-auto",children:n.jsx("div",{className:"min-h-screen",children:n.jsx(_,{handleBackClick:()=>Q(!1),formValues:f,uploadedPhotos:o,addressOptions:q,savedAddresses:T,variants:c,categoryOptions:$,subCategoryOptions:I,tagOptions:M})})}),n.jsxs("form",{id:"product-form",onSubmit:Y(oe,le),className:"flex-1 flex flex-col lg:flex-row gap-4 p-4 mx-auto overflow-hidden min-h-0  w-full",children:[n.jsx("div",{className:"w-full lg:max-w-[450px] h-full",children:n.jsx(Fe,{methods:v,uploadedPhotos:o,setUploadedPhotos:g,imageError:U,setImageError:h,addressOptions:q,showAddAddressModal:R,setShowAddAddressModal:S,variants:c,showVariants:K,setShowVariants:V,handleDrag:se,handleDrop:ae,handleFileChange:ie,removePhoto:re,addVariant:ue,removeVariant:de,handleVariantImageUpload:B,removeVariantImage:pe,handleVariantDrag:me,handleVariantDrop:ge,dragActive:L,variantDragActive:Z,MAX_IMAGES:H,categoryOptions:$,subCategoryOptions:I,tagOptions:M,isLoading:C.isPending})}),n.jsx("div",{className:"w-full lg:flex-1 hidden lg:block h-full",children:n.jsx(_,{formValues:f,uploadedPhotos:o,addressOptions:q,savedAddresses:T,variants:c,categoryOptions:$,subCategoryOptions:I,tagOptions:M})})]})]}),n.jsx(Ve,{isOpen:R,onClose:()=>S(!1),onSubmit:ce,isSubmitting:z.isPending,totalAddress:T.length!==0})]})}export{ze as default};
