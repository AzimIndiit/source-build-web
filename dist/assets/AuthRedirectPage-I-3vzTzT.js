import{c as u,a as h,u as d,r as m,j as o,x as p,m as g,y as x}from"./index-BiCr9dd_.js";const j=()=>{const e=u(),c=h(),{setUser:n}=d();return m.useEffect(()=>{(async()=>{try{const t=new URLSearchParams(c.search);console.log("URL params:",t.toString());const a=t.get("accessToken"),l=t.get("refreshToken"),i=t.get("needsAdditionalInfo");if(console.log("accessToken",a),!a){console.error("No access token found in URL"),e("/auth/login",{replace:!0});return}if(localStorage.setItem("access_token",a),l&&localStorage.setItem("refresh_token",l),i==="true"){e("/auth/complete-profile",{replace:!0});return}let r=null;try{const s=await g.getProfile();s.data&&s.data.user&&(r=x(s.data.user),r&&n(r))}catch(s){throw console.error("Failed to fetch user profile:",s),s}if(!r)return;if(r?.role==="seller")e("/seller/dashboard",{replace:!0});else if(r?.role==="driver"){const s=r?.profile?.isVehicles,f=r?.profile?.isLicense;s?f?e("/driver/dashboard",{replace:!0}):e("/auth/driver-license",{replace:!0}):e("/auth/vehicle-information",{replace:!0})}else r?.role==="buyer"?e("/",{replace:!0}):e("/",{replace:!0})}catch(t){console.error("Error fetching profile:",t),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),e("/auth/login",{replace:!0})}})()},[c.search,e,n]),o.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:o.jsxs("div",{className:"flex flex-col items-center gap-4",children:[o.jsx(p,{className:"w-10 h-10 animate-spin"}),o.jsx("p",{className:"text-muted-foreground",children:"Completing authentication..."})]})})};export{j as default};
