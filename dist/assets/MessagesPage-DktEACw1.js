import{j as e,K as _,a6 as A,a7 as L,a8 as O,a9 as E,S as M,g as k,bX as U,u as z,r as y,c3 as F}from"./index-CUSVstqU.js";import{B as R}from"./badge-c_xwgsXg.js";import{E as Y}from"./EmptyState-CH6fPGhV.js";import{c as B}from"./constructNow-CYnDNQGr.js";import{t as j,n as X,g as I,b as H,e as P,d as T,f as b}from"./en-US-CPLesiGp.js";import{e as $,d as G}from"./endOfMonth-B0jjArdg.js";function w(s,t){const r=+j(s)-+j(t);return r<0?-1:r>0?1:r}function K(s){return t=>{const l=(s?Math[s]:Math.trunc)(t);return l===0?0:l}}function Q(s,t){return+j(s)-+j(t)}function q(s,t){const r=j(s,t?.in);return r.setHours(23,59,59,999),r}function J(s,t){const r=j(s,t?.in);return+q(r,t)==+$(r,t)}function V(s,t,r){const[l,a,u]=X(r?.in,s,s,t),d=w(a,u),n=Math.abs(G(a,u));if(n<1)return 0;a.getMonth()===1&&a.getDate()>27&&a.setDate(30),a.setMonth(a.getMonth()-d*n);let m=w(a,u)===-d;J(l)&&n===1&&w(l,u)===1&&(m=!1);const h=d*(n-+m);return h===0?0:h}function W(s,t,r){const l=Q(s,t)/1e3;return K(r?.roundingMethod)(l)}function Z(s,t,r){const l=H(),a=r?.locale??l.locale??P,u=2520,d=w(s,t);if(isNaN(d))throw new RangeError("Invalid time value");const n=Object.assign({},r,{addSuffix:r?.addSuffix,comparison:d}),[m,h]=X(r?.in,...d>0?[t,s]:[s,t]),x=W(h,m),D=(I(h)-I(m))/1e3,o=Math.round((x-D)/60);let i;if(o<2)return r?.includeSeconds?x<5?a.formatDistance("lessThanXSeconds",5,n):x<10?a.formatDistance("lessThanXSeconds",10,n):x<20?a.formatDistance("lessThanXSeconds",20,n):x<40?a.formatDistance("halfAMinute",0,n):x<60?a.formatDistance("lessThanXMinutes",1,n):a.formatDistance("xMinutes",1,n):o===0?a.formatDistance("lessThanXMinutes",1,n):a.formatDistance("xMinutes",o,n);if(o<45)return a.formatDistance("xMinutes",o,n);if(o<90)return a.formatDistance("aboutXHours",1,n);if(o<T){const c=Math.round(o/60);return a.formatDistance("aboutXHours",c,n)}else{if(o<u)return a.formatDistance("xDays",1,n);if(o<b){const c=Math.round(o/T);return a.formatDistance("xDays",c,n)}else if(o<b*2)return i=Math.round(o/b),a.formatDistance("aboutXMonths",i,n)}if(i=V(h,m),i<12){const c=Math.round(o/b);return a.formatDistance("xMonths",c,n)}else{const c=i%12,f=Math.trunc(i/12);return c<3?a.formatDistance("aboutXYears",f,n):c<9?a.formatDistance("overXYears",f,n):a.formatDistance("almostXYears",f+1,n)}}function ee(s,t){return Z(s,B(s),t)}const se="/assets/chatNotification-ByTemvyG.svg",te=({id:s,displayName:t,avatar:r,lastMessage:l,timestamp:a,unreadCount:u=0,onClick:d})=>e.jsxs(_,{onClick:d,className:"relative p-2 bg-white border-gray-200 cursor-pointer hover:bg-gray-50 transition-colors  justify-center",children:[u>0&&e.jsx("div",{className:"absolute bottom-1 right-1",children:e.jsx(R,{className:"h-6 w-6 rounded-full p-0 flex items-center justify-center bg-red-500 hover:bg-red-500 text-white",children:u>9?"9+":u})}),e.jsxs("div",{className:"flex  gap-3 items-stretch",children:[e.jsxs(A,{className:"h-16 w-16",children:[e.jsx(L,{src:r||"",alt:t}),e.jsx(O,{className:"bg-gray-200 text-gray-700 font-semibold text-xl",children:e.jsx("div",{className:"mt-1",children:E(t||"U")})})]}),e.jsxs("div",{className:"flex-1 min-w-0 py-2 flex flex-col justify-center my-auto",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("h6",{className:"font-semibold text-gray-900 capitalize truncate",children:t}),e.jsx("span",{className:"text-sm text-gray-500 ml-2 whitespace-nowrap",children:a})]}),e.jsx("p",{className:"text-gray-600 text-sm line-clamp-2",children:l})]})]})]},s),ae=()=>e.jsx("div",{className:"py-4 md:p-6 space-y-6",children:e.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((s,t)=>e.jsxs("div",{className:"flex items-center space-x-4 p-4 rounded-lg",children:[e.jsx(M,{className:"w-12 h-12 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(M,{className:"h-4 w-32"}),e.jsx(M,{className:"h-3 w-16"})]}),e.jsx(M,{className:"h-3 w-3/4"})]}),e.jsx(M,{className:"w-6 h-6 rounded-full"})]},t))})}),ne=()=>{const{user:s}=k(),{on:t}=U(),r=z(),[l,a]=y.useState(1),[u,d]=y.useState(10),{data:n,isLoading:m,error:h,refetch:x}=F({page:l,limit:u}),[D,o]=y.useState([]);return y.useEffect(()=>{x()},[]),y.useEffect(()=>{n?.data&&o(n.data)},[n]),y.useEffect(()=>{const c=t("update_unread_count",f=>{console.log("data",f),o(p=>{const N=p.findIndex(g=>g.id===f.id);if(N!==-1){const g=[...p];return g[N]={...g[N],...f},g}return p})});return()=>{c()}},[t]),e.jsxs("div",{className:"py-4 md:p-6 space-y-6",children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-gray-900",children:"Messages"}),e.jsx("div",{className:"space-y-3",children:D?.length>0?D?.map(i=>{const c=i?.lastMessage,f=c?.messageType==="text"?c.content:c?.messageType==="file"||c?.messageType==="mix"?"Sent a file":"",p=i?.participants?.find(S=>S?.id!==s?.id),N=c?.sentAt?ee(new Date(c.sentAt),{addSuffix:!0}):"",g=s?.id&&i.unreadCounts&&i.unreadCounts[s.id]||0;return e.jsx(te,{id:i.id||"",displayName:p?.displayName||"Unknown User",avatar:p?.avatar,lastMessage:f,timestamp:N,unreadCount:g,onClick:()=>{o(S=>S.map(v=>{if(v.id===i.id){const C={...v.unreadCounts,[s?.id||""]:0};return console.log("unreadCounts",C),{...v,unreadCounts:C}}return v})),r(s?.role==="buyer"?`/messages/${i._id}`:`/${s?.role}/messages/${i._id}`,{state:i})}},i.id)}):m?e.jsx(ae,{}):h?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("p",{className:"text-red-500",children:"Failed to load messages. Please try again."})}):e.jsx(Y,{title:"No Messages Found",description:"Start a conversation to see your messages here",icon:e.jsx("img",{src:se,alt:"Chat empty",className:"w-48 h-48 "}),className:"h-96"})})]})};function de(){return e.jsx(ne,{})}export{de as default};
