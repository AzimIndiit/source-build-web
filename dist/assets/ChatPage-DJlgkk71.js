import{A as H,a1 as Ke,j as e,aq as Ve,ar as Ge,bL as qe,B as S,X as q,ay as Qe,az as Je,C as ve,a9 as De,S as c,b as Ie,c as Xe,D as es,u as ss,bM as ts,r as f,bN as as,bO as ns,bP as rs,bQ as is,Y as he,Z as xe,$ as fe,a0 as ge,aj as ls,ak as cs,am as os,ao as ds,x as pe,O as $,bR as Ne,bS as je,bT as k,bm as ms,ap as us,bk as hs,z as P,M as xs}from"./index-BiCr9dd_.js";import{R as fs}from"./ReadMore-DMY4alUQ.js";import{B as Ce}from"./breadcrumb-wrapper-448K_ANJ.js";import{T as gs}from"./trash-2-BSx2CMeK.js";import{c as Q,t as ye,m as ke,a as Me}from"./en-US-CPLesiGp.js";import{c as Se}from"./constructNow-CYnDNQGr.js";import{i as _e,a as ps}from"./isSameDay-CeY-boyx.js";import{f as V}from"./format-Byp0gi1d.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]],we=H("check-check",Ns);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],ys=H("ellipsis-vertical",js);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ws=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],bs=H("paperclip",ws);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],Ds=H("send",vs);function Is(s,t){return _e(Q(s,s),Se(s))}function Cs(s,t,a){return ps(s,-1,a)}function ks(s,t){return _e(Q(s,s),Cs(Se(s)))}function be(s,t){const a=()=>Q(t?.in,NaN),i=Ts(s);let x;if(i.date){const p=Us(i.date,2);x=zs(p.restDateString,p.year)}if(!x||isNaN(+x))return a();const b=+x;let D=0,h;if(i.time&&(D=Es(i.time),isNaN(D)))return a();if(i.timezone){if(h=Fs(i.timezone),isNaN(h))return a()}else{const p=new Date(b+D),_=ye(0,t?.in);return _.setFullYear(p.getUTCFullYear(),p.getUTCMonth(),p.getUTCDate()),_.setHours(p.getUTCHours(),p.getUTCMinutes(),p.getUTCSeconds(),p.getUTCMilliseconds()),_}return ye(b+D+h,t?.in)}const B={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},Ms=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,Ss=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,_s=/^([+-])(\d{2})(?::?(\d{2}))?$/;function Ts(s){const t={},a=s.split(B.dateTimeDelimiter);let n;if(a.length>2)return t;if(/:/.test(a[0])?n=a[0]:(t.date=a[0],n=a[1],B.timeZoneDelimiter.test(t.date)&&(t.date=s.split(B.timeZoneDelimiter)[0],n=s.substr(t.date.length,s.length))),n){const i=B.timezone.exec(n);i?(t.time=n.replace(i[1],""),t.timezone=i[1]):t.time=n}return t}function Us(s,t){const a=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),n=s.match(a);if(!n)return{year:NaN,restDateString:""};const i=n[1]?parseInt(n[1]):null,x=n[2]?parseInt(n[2]):null;return{year:x===null?i:x*100,restDateString:s.slice((n[1]||n[2]).length)}}function zs(s,t){if(t===null)return new Date(NaN);const a=s.match(Ms);if(!a)return new Date(NaN);const n=!!a[4],i=R(a[1]),x=R(a[2])-1,b=R(a[3]),D=R(a[4]),h=R(a[5])-1;if(n)return $s(t,D,h)?Ls(t,D,h):new Date(NaN);{const p=new Date(0);return!Os(t,x,b)||!As(t,i)?new Date(NaN):(p.setUTCFullYear(t,x,Math.max(i,b)),p)}}function R(s){return s?parseInt(s):1}function Es(s){const t=s.match(Ss);if(!t)return NaN;const a=G(t[1]),n=G(t[2]),i=G(t[3]);return Ps(a,n,i)?a*ke+n*Me+i*1e3:NaN}function G(s){return s&&parseFloat(s.replace(",","."))||0}function Fs(s){if(s==="Z")return 0;const t=s.match(_s);if(!t)return 0;const a=t[1]==="+"?-1:1,n=parseInt(t[2]),i=t[3]&&parseInt(t[3])||0;return Bs(n,i)?a*(n*ke+i*Me):NaN}function Ls(s,t,a){const n=new Date(0);n.setUTCFullYear(s,0,4);const i=n.getUTCDay()||7,x=(t-1)*7+a+1-i;return n.setUTCDate(n.getUTCDate()+x),n}const Rs=[31,null,31,30,31,30,31,31,30,31,30,31];function Te(s){return s%400===0||s%4===0&&s%100!==0}function Os(s,t,a){return t>=0&&t<=11&&a>=1&&a<=(Rs[t]||(Te(s)?29:28))}function As(s,t){return t>=1&&t<=(Te(s)?366:365)}function $s(s,t,a){return t>=1&&t<=53&&a>=0&&a<=6}function Ps(s,t,a){return s===24?t===0&&a===0:a>=0&&a<60&&t>=0&&t<60&&s>=0&&s<25}function Bs(s,t){return t>=0&&t<=59}const Hs=({images:s=[],open:t,onClose:a,currentIndex:n,setCurrentIndex:i})=>{const x=()=>{i(h=>h===0?s.length-1:h-1)},b=()=>{i(h=>h===s.length-1?0:h+1)},D=()=>{a?.(),i(0)};return Ke.useEffect(()=>{const h=p=>{t&&(p.key==="ArrowLeft"?x():p.key==="ArrowRight"&&b())};return window.addEventListener("keydown",h),()=>window.removeEventListener("keydown",h)},[t,n,s.length]),e.jsx(Ve,{open:t,onOpenChange:D,children:e.jsx(Ge,{className:"max-w-7xl h-[90vh] p-0 bg-black border-none",children:e.jsxs("div",{className:"relative w-full h-full flex items-center justify-center",children:[e.jsx(qe,{className:"absolute top-4 right-4 z-50 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:e.jsxs(S,{variant:"ghost",size:"icon",className:"h-8 w-8 p-0 text-white hover:bg-white",children:[e.jsx(q,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Close"})]})}),s.length>1&&e.jsxs(e.Fragment,{children:[e.jsxs(S,{variant:"ghost",size:"icon",className:"absolute left-4 top-1/2 -translate-y-1/2 z-40 h-12 w-12 rounded-full bg-black/50 text-white hover:bg-black/70 transition-all",onClick:x,children:[e.jsx(Qe,{className:"h-8 w-8"}),e.jsx("span",{className:"sr-only",children:"Previous image"})]}),e.jsxs(S,{variant:"ghost",size:"icon",className:"absolute right-4 top-1/2 -translate-y-1/2 z-40 h-12 w-12 rounded-full bg-black/50 text-white hover:bg-black/70 transition-all",onClick:b,children:[e.jsx(Je,{className:"h-8 w-8"}),e.jsx("span",{className:"sr-only",children:"Next image"})]})]}),s[n]&&e.jsx("img",{src:s[n],alt:`Preview ${n+1}`,className:"max-h-[85vh] max-w-[90vw] object-contain select-none pointer-events-none",draggable:!1}),s.length>1&&e.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 z-40 px-3 py-1.5 bg-black/70 rounded-full text-white text-sm font-medium backdrop-blur-sm",children:[n+1," / ",s.length]})]})})})},Ys=()=>{const s=[{label:"Messages",href:"/seller/messages"},{label:"Chat Details",isCurrentPage:!0}];return e.jsxs("div",{className:"py-4 md:p-6 space-y-6",children:[e.jsx(Ce,{items:s}),e.jsxs(ve,{className:"h-[calc(100vh-200px)] flex flex-col overflow-hidden border-gray-200",children:[e.jsxs(De,{className:"flex flex-row items-center justify-between p-4 border-b border-gray-200 bg-white flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(c,{className:"h-10 w-10 rounded-full"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{className:"h-5 w-32"}),e.jsx(c,{className:"h-3 w-12"})]})]}),e.jsx(c,{className:"h-8 w-8 rounded"})]}),e.jsxs(Ie,{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-white",children:[e.jsx("div",{className:"flex items-center justify-center my-4",children:e.jsx(c,{className:"h-6 w-20 rounded-full"})}),e.jsxs("div",{className:"flex items-start gap-2 justify-start",children:[e.jsx(c,{className:"h-10 w-10 rounded-full"}),e.jsxs("div",{className:"flex flex-col max-w-[70%] items-start space-y-2",children:[e.jsx(c,{className:"h-3 w-20"}),e.jsx(c,{className:"h-20 w-64 rounded-2xl"}),e.jsx(c,{className:"h-3 w-16"})]})]}),e.jsx("div",{className:"flex items-start gap-2 justify-end",children:e.jsxs("div",{className:"flex flex-col max-w-[70%] items-end space-y-2",children:[e.jsx(c,{className:"h-16 w-48 rounded-2xl"}),e.jsx(c,{className:"h-3 w-16"})]})}),e.jsxs("div",{className:"flex items-start gap-2 justify-start",children:[e.jsx(c,{className:"h-10 w-10 rounded-full"}),e.jsxs("div",{className:"flex flex-col max-w-[70%] items-start space-y-2",children:[e.jsx(c,{className:"h-3 w-20"}),e.jsx(c,{className:"h-12 w-56 rounded-2xl"}),e.jsx(c,{className:"h-3 w-16"})]})]}),e.jsx("div",{className:"flex items-start gap-2 justify-end",children:e.jsxs("div",{className:"flex flex-col max-w-[70%] items-end space-y-2",children:[e.jsx(c,{className:"h-48 w-48 rounded-2xl"}),e.jsx(c,{className:"h-3 w-16"})]})}),e.jsxs("div",{className:"flex items-start gap-2 justify-start",children:[e.jsx(c,{className:"h-10 w-10 rounded-full"}),e.jsxs("div",{className:"flex flex-col max-w-[70%] items-start space-y-2",children:[e.jsx(c,{className:"h-3 w-20"}),e.jsx(c,{className:"h-10 w-40 rounded-2xl"}),e.jsx(c,{className:"h-3 w-16"})]})]})]}),e.jsx("div",{className:"border-t bg-white p-4 border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"relative",children:[e.jsx(c,{className:"h-12 w-full rounded-md"}),e.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1",children:[e.jsx(c,{className:"h-12 w-16 rounded"}),e.jsx(c,{className:"h-12 w-16 rounded"})]})]})})]})]})},Ws=()=>{const s=Xe(),a=es().id,{user:n}=ss(),{emit:i,on:x,isConnected:b,off:D}=ts(),[h,p]=f.useState(1),[_]=f.useState(20),[J,X]=f.useState(!0),[Y,W]=f.useState(!1),{data:Z,isLoading:Ue}=as(a),{data:U,isLoading:ee,error:se}=ns({chatId:a,page:h,limit:_}),{mutate:te}=rs(),{mutate:ze}=is(),[z,I]=f.useState([]),[O,ae]=f.useState(""),[y,K]=f.useState(null),[ne,re]=f.useState([]),[Ee,ie]=f.useState(0),[Fe,le]=f.useState(!1),C=f.useRef(null),T=f.useRef(null),[w,ce]=f.useState(null),oe=f.useRef(0),E=f.useRef(!1);f.useEffect(()=>{if(Z?.data?.participants&&n?.id){const r=Z.data.participants.find(d=>d?.id!==n.id||d?._id!==n.id);console.log("Setting otherUser:",r),ce(r||null)}},[Z,n?.id]),f.useEffect(()=>{h===1&&z.length>0&&de()},[z.length,h]),f.useEffect(()=>{if(U?.data){if(h===1)I(U.data);else if(I(r=>[...U.data,...r]),C.current){const d=C.current.scrollHeight-oe.current;C.current.scrollTop=d}X(U.data.length===_),W(!1)}},[U,h,_]),f.useEffect(()=>{a&&n?.id&&te(a)},[a,n?.id,te]),f.useEffect(()=>{p(1),X(!0),W(!1),I([])},[a]),f.useEffect(()=>{E.current&&z.length>0&&setTimeout(()=>{de(),E.current=!1},50)},[z]),f.useEffect(()=>{if(!a)return;const r=o=>{if(console.log("Frontend: Received new_message event:",o),o.chat&&o.chat.toString()!==a){console.log("Frontend: Message is for different chat, ignoring");return}I(N=>{if(o.tempId){const g=N.findIndex(A=>A._id===o.tempId);if(g!==-1){console.log("Frontend: Replacing temp message with real message");const A=[...N];return A[g]={...o,senderId:o.sender||o.senderId,status:k.DELIVERED},i("mark_as_delivered",{messageId:o._id}),(o.sender===n?.id||o.senderId===n?.id)&&(E.current=!0),A}}const v=N.findIndex(g=>g._id===o._id);if(v!==-1){console.log("Frontend: Updating existing message");const g=[...N];return g[v]={...o,senderId:o.sender||o.senderId},g}return console.log("Frontend: Adding new message to chat"),E.current=!0,[...N,{...o,senderId:o.sender||o.senderId}]})},d=o=>{I(N=>{const v=N.findIndex(g=>g._id===o._id);if(v!==-1){const g=[...N];return g[v]={...g[v],...o,status:k.READ,senderId:o.sender||g[v].senderId},g}return N})},j=()=>{console.log("Frontend: Joining chat room with ID:",a),i("join_chat",{roomId:a})};b()&&j();const u=x("connect",j);console.log("Frontend: Setting up new_message listener for chat:",a);const l=x("new_message",r),M=x("message_delivered",o=>{I(N=>{const v=N.findIndex(g=>g._id===o._id);if(v!==-1){const g=[...N];return g[v]={...g[v],...o,status:k.DELIVERED,senderId:o.sender||g[v].senderId},g}return N})}),F=o=>{ce(N=>N?.id===o.userId?{...N,isOnline:o.is_online}:N)},L=x("message_read",d),Ze=x("is_online",F);return()=>{b()&&i("leave_chat",{roomId:a}),u(),l(),M(),L(),Ze()}},[a,i,x,D,b,n?.id]);const de=()=>{C.current&&(C.current.scrollTop=C.current.scrollHeight)},Le=()=>{!C.current||Y||!J||C.current.scrollTop===0&&Re()},Re=async()=>{Y||!J||(W(!0),C.current&&(oe.current=C.current.scrollHeight),p(r=>r+1))},me=async()=>{if(!O.trim()&&!y||!n?.id||!a)return;const r=Date.now().toString(),d=O.trim(),j=y;if(ae(""),K(null),E.current=!0,j){const u={_id:r,messageType:"file",content:d,sentAt:new Date().toISOString(),senderId:n.id,status:k.SENDING,attachments:[{_id:r+"_file",id:r+"_file",originalName:j.name,mimeType:j.type,mimetype:j.type,url:URL.createObjectURL(j),size:j.size,uploading:!0}]};I(l=>[...l,u]),xs.uploadFile(j).then(l=>{if(l.status==="success"){const m={_id:l.data.id,id:l.data.id,originalName:l.data.originalName,mimeType:l.data.mimeType,url:l.data.url,size:l.data.size,bestImageUrl:l.data.bestImageUrl||"",bestMediaUrl:l.data.bestMediaUrl||"",thumbnailUrl:l.data.thumbnailUrl||"",streamingUrl:l.data.streamingUrl||null,isImage:l.data.isImage||!1,isVideo:l.data.isVideo||!1},M={_id:r,messageType:"file",content:d,sentAt:u.sentAt,senderId:n.id,status:k.SENT,chatId:a,attachments:[{_id:m.id}]};i("send_message",M),I(F=>F.map(L=>L._id===r?{...L,attachments:[m]}:L))}else P.error("Failed to upload file"),I(m=>m.filter(M=>M._id!==r))}).catch(l=>{console.error("File upload error:",l),P.error("Failed to upload file"),I(m=>m.filter(M=>M._id!==r))})}else{const u={_id:r,messageType:"text",content:d,sentAt:new Date().toISOString(),senderId:n.id,status:k.SENDING,attachments:void 0};I(m=>[...m,u]);const l={...u,chatId:a,attachments:[]};i("send_message",l)}},Oe=r=>{r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),me())},Ae=r=>{const d=r.target.files?.[0];if(d){if(d.size>5*1024*1024){P.error("File size must be less than 5MB");return}K(d),T.current&&(T.current.value="")}},ue=()=>{K(null),T.current&&(T.current.value="")},$e=()=>{a&&ze(a,{onSuccess:()=>{P.success("Chat deleted successfully"),s(`/${n?.role}/messages`)}})},Pe=r=>{re([r]),ie(0)},Be=r=>r.reduce((d,j)=>{const u=V(be(j.sentAt),"yyyy-MM-dd");return d[u]||(d[u]=[]),d[u].push(j),d},{}),He=r=>{const d=new Date(r);return Is(d)?"Today":ks(d)?"Yesterday":V(d,"MMM dd, yyyy")},Ye=r=>r===k.SENDING?e.jsx("p",{className:"text-[10px] text-gray-500",children:"sending..."}):r===k.DELIVERED?e.jsx(we,{className:"w-4 h-4 text-gray-400"}):r===k.READ?e.jsx(we,{className:"w-4 h-4 text-primary"}):e.jsx(hs,{className:"w-4 h-4 text-gray-400"}),We=[{label:"Messages",href:n?.role==="buyer"?"/messages":`/${n?.role}/messages`},{label:"Chat Details",isCurrentPage:!0}];return Ue?e.jsx(Ys,{}):e.jsxs("div",{className:"py-4 md:p-6 space-y-6",children:[e.jsx(Ce,{items:We}),e.jsxs(ve,{className:"h-[calc(100vh-200px)] flex flex-col overflow-hidden border-gray-200",children:[e.jsxs(De,{className:"flex flex-row items-center justify-between p-4 border-b border-gray-200 bg-white flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(he,{className:"h-10 w-10",children:[e.jsx(xe,{src:w?.avatar,alt:w?.displayName}),e.jsx(fe,{className:"bg-gray-200",children:w?ge(w.displayName):"?"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 capitalize",children:w?.displayName||"Loading..."}),e.jsx("p",{className:`xtext-sm mt-1 ${w?.isOnline?"text-green-500":"text-red-500"}`,children:w?.isOnline?"Online":"Offline"})]})]}),e.jsxs(ls,{children:[e.jsx(cs,{asChild:!0,children:e.jsx(S,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(ys,{className:"h-4 w-4"})})}),e.jsx(os,{align:"end",children:e.jsxs(ds,{className:"text-red-600 cursor-pointer",onClick:()=>le(!0),children:[e.jsx(gs,{className:"w-4 h-4 mr-2"}),"Delete Chat"]})})]})]}),e.jsxs(Ie,{ref:C,className:"flex-1 overflow-y-auto p-4 space-y-2 bg-white",onScroll:Le,children:[ee&&h===1&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center justify-center my-4",children:e.jsx(c,{className:"h-6 w-20 rounded-full"})}),[...Array(5)].map((r,d)=>e.jsx("div",{className:"space-y-4",children:d%2===0?e.jsxs("div",{className:"flex items-start gap-2 justify-start",children:[e.jsx(c,{className:"h-10 w-10 rounded-full"}),e.jsxs("div",{className:"flex flex-col max-w-[70%] items-start space-y-2",children:[e.jsx(c,{className:"h-3 w-20"}),e.jsx(c,{className:"h-16 w-56 rounded-2xl"}),e.jsx(c,{className:"h-3 w-16"})]})]}):e.jsx("div",{className:"flex items-start gap-2 justify-end",children:e.jsxs("div",{className:"flex flex-col max-w-[70%] items-end space-y-2",children:[e.jsx(c,{className:"h-12 w-48 rounded-2xl"}),e.jsx(c,{className:"h-3 w-16"})]})})},d))]}),se&&e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("p",{className:"text-red-500",children:"Failed to load messages"})}),(!ee||h>1)&&!se&&e.jsxs(e.Fragment,{children:[Y&&e.jsxs("div",{className:"flex items-center justify-center py-2",children:[e.jsx(pe,{className:"h-5 w-5 animate-spin text-gray-400 mr-2"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Loading previous messages..."})]}),Object.entries(Be(z)).map(([r,d],j)=>e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-center my-4",children:e.jsx("div",{className:"bg-gray-100 px-3 py-1 rounded-full",children:e.jsx("span",{className:"text-xs text-gray-600 font-medium",children:He(r)})})}),d.map(u=>{const l=u.senderId===n?.id||u?.sender?.id===n?.id;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:$("flex items-start gap-2",l?"justify-end":"justify-start"),children:[!l&&e.jsxs(he,{className:"h-10 w-10 mt-1",children:[e.jsx(xe,{src:w?.avatar,alt:w?.displayName}),e.jsx(fe,{className:"bg-gray-200 text-sm",children:w?ge(w.displayName):"?"})]}),e.jsxs("div",{className:$("flex flex-col max-w-[70%]",l?"items-end":"items-start"),children:[!l&&w&&e.jsx("span",{className:"text-xs text-gray-500 mb-1 px-1",children:w.displayName}),e.jsxs("div",{className:$("px-4 py-2 rounded-2xl break-words",l?"bg-primary text-white":"bg-gray-200 border border-gray-200"),children:[u.attachments&&u.attachments.length>0&&u.attachments.map((m,M)=>{const F=m.mimeType?.startsWith("image/")||m.mimetype?.startsWith("image/")||m.url?.includes("image/upload")||m.url?.match(/\.(jpg|jpeg|png|gif|webp|svg)$/i);return e.jsxs("div",{className:"mb-2 relative",children:[m.uploading&&e.jsxs("div",{className:"absolute inset-0 bg-black/50 rounded-lg flex flex-col items-center justify-center z-10",children:[e.jsx(pe,{className:"h-8 w-8 text-white animate-spin mb-2"}),e.jsx("span",{className:"text-white text-sm font-medium",children:"Uploading..."})]}),F?e.jsx("img",{src:m.url||m.bestImageUrl||m.thumbnailUrl,alt:m.originalName||"attachment",className:"rounded-lg max-w-full cursor-pointer object-cover",style:{height:"200px",width:"200px"},onClick:()=>!m.uploading&&Pe(m.url||m.bestImageUrl||"")}):e.jsx("div",{className:"flex items-center gap-2 flex-col justify-center h-full w-full bg-gray-100 rounded-sm cursor-pointer",style:{height:"200px",width:"200px"},children:e.jsxs("a",{href:m.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 flex-col",children:[e.jsx(Ne,{className:"h-5 w-5 text-gray-500"}),e.jsx("div",{className:"",children:e.jsx("p",{className:"text-xs font-medium text-gray-700 truncate",title:m.originalName||"attachment",children:je(m.originalName||"attachment",10)})})]})})]},M)}),u.content&&e.jsx(fs,{text:u.content,maxLength:1e3,className:` ${l?"text-white hover:text-white":"text-gray-700"}  `,buttonClassName:`${l?"text-white hover:text-white":"text-gray-700"} !text-sm`})]}),e.jsxs("div",{className:$("flex items-center gap-1 mt-1 px-1",l?"justify-end":"justify-start"),children:[e.jsx("span",{className:"text-xs text-gray-500",children:u.status!==k.SENDING&&V(be(u.sentAt),"h:mm a")}),l&&Ye(u.status)]})]})]}),u._id==="2"&&e.jsx("div",{className:"flex justify-end",children:e.jsx(S,{variant:"default",size:"sm",className:"bg-primary hover:bg-blue-700 text-white",children:"Hi!"})})]},u._id)})]},j))]})]}),e.jsxs("div",{className:"border-t bg-white p-4 border-gray-200 flex-shrink-0",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ms,{type:"text",placeholder:"Type a message",value:O,onChange:r=>ae(r.target.value),onKeyDown:Oe,className:"w-full pr-32 bg-gray-50"}),e.jsx("input",{type:"file",ref:T,className:"hidden",accept:"image/*,application/pdf,.doc,.docx",onChange:Ae}),e.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1",children:[e.jsx(S,{variant:"ghost",size:"icon",className:"h-12 w-16 bg-gray-100 hover:bg-gray-200",onClick:()=>T.current?.click(),children:e.jsx(bs,{className:"h-4 w-4 text-gray-500"})}),e.jsx(S,{size:"icon",onClick:me,disabled:!O.trim()&&!y,className:"h-12 w-16 bg-primary hover:bg-primary/80",children:e.jsx(Ds,{className:"h-4 w-4 text-white"})})]})]}),y&&e.jsx("div",{className:"mt-2 inline-block",children:e.jsx("div",{className:"relative group bg-gray-100 rounded-lg inline-block",children:y.type.startsWith("image/")?e.jsxs("div",{className:"relative w-20 h-20",children:[e.jsx("img",{src:URL.createObjectURL(y),alt:y.name,className:"w-full h-full object-cover rounded-sm"}),e.jsx(S,{variant:"ghost",size:"icon",className:"absolute top-[-5px] right-[-5px] h-6 w-6 bg-red-500 hover:bg-red-600 transition-opacity rounded-full",onClick:ue,children:e.jsx(q,{className:"h-3 w-3 text-white"})})]}):e.jsxs("div",{className:"flex relative flex-col items-center gap-2 p-2 h-20 w-20",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-col justify-center",children:[e.jsx(Ne,{className:"h-5 w-5 text-gray-500"}),e.jsxs("div",{className:"",children:[e.jsx("p",{className:"text-xs font-medium text-gray-700 truncate",title:y.name,children:je(y.name,10)}),e.jsx("p",{className:"text-xs text-gray-500",children:y.size<1024?`${y.size} B`:y.size<1024*1024?`${(y.size/1024).toFixed(1)} KB`:`${(y.size/(1024*1024)).toFixed(1)} MB`})]})]}),e.jsx(S,{variant:"ghost",size:"icon",className:"absolute top-[-5px] right-[-5px] h-6 w-6 bg-red-500 hover:bg-red-600 transition-opacity rounded-full",onClick:ue,children:e.jsx(q,{className:"h-3 w-3 text-white"})})]})})})]})]}),e.jsx(Hs,{images:ne,open:ne.length>0,onClose:()=>re([]),currentIndex:Ee,setCurrentIndex:ie}),e.jsx(us,{isOpen:Fe,onClose:()=>le(!1),onConfirm:$e,title:"Delete Chat",description:"Are you sure you want to delete this chat? This action cannot be undone.",confirmText:"Delete",cancelText:"Cancel"})]})},et=()=>e.jsx(Ws,{});export{et as default};
