import{E as D,A as M,$ as A,a0 as $,Z as C,I as d,H as P,u as _,r as p,o as k,p as U,j as e,F as B,x as T,a1 as O,B as z,L as w}from"./index-BCiIUrXb.js";import{A as R}from"./AuthWrapper-zmeuqRTi.js";import{v as X}from"./vehicleService-DaKKc3jd.js";import{U as L}from"./upload-Brfr3HgH.js";const Z=5*1024*1024,Y=["image/jpeg","image/jpg","image/png","image/webp"],q=D({licenceImages:A($(File).refine(i=>i.size<=Z,{message:"Max file size is 5MB"}).refine(i=>Y.includes(i.type),{message:"Only .jpg, .jpeg, .png, .webp and .gif formats are supported"})).optional(),licenseNumber:M().min(5,"License number must be at least 5 characters").max(20,"License number must not exceed 20 characters").regex(/^[A-Z0-9-]+$/i,"License number can only contain letters, numbers, and hyphens")}),G=["license"];function K(){return C({mutationFn:async i=>{const r=await X.uploadVehicleImages(i.licenseImageFiles);if(r.length===0)throw new Error("Failed to upload license images. Please try again.");const u={licenseNumber:i.licenseNumber,licenseImages:r};return new Promise(h=>{setTimeout(()=>{h({success:!0,message:"License information submitted successfully!",data:u})},1e3)})},onSuccess:i=>{P.invalidateQueries({queryKey:G}),d.success(i.message||"License information submitted successfully!")},onError:i=>{const r=i.response?.data?.message||i.message||"Failed to submit license information";d.error(r),console.error("Error submitting license information:",i)}})}const n=2,Q=5*1024*1024;function ee(){const i=_(),[r,u]=p.useState([]),[h,x]=p.useState(!1),[v,b]=p.useState(!1),f=K(),y=k({resolver:U(q),defaultValues:{licenseNumber:""}}),{handleSubmit:I}=y,j=s=>s.type.startsWith("image/")?s.size>Q?{valid:!1,error:"Maximum size is 5MB allowed"}:{valid:!0}:{valid:!1,error:`"${s.name}" is not an image file`},g=p.useCallback(s=>{s.preventDefault(),s.stopPropagation(),s.type==="dragenter"||s.type==="dragover"?x(!0):s.type==="dragleave"&&x(!1)},[]),N=p.useCallback(s=>{if(s.preventDefault(),s.stopPropagation(),x(!1),s.dataTransfer.files&&s.dataTransfer.files[0]){const a=Array.from(s.dataTransfer.files);if(r.length>=n){d.error(`Maximum ${n} images allowed`);return}const o=n-r.length,l=[],c=[];for(let t=0;t<Math.min(a.length,o);t++){const m=j(a[t]);m.valid?l.push(a[t]):m.error&&c.push(m.error)}a.length>o&&c.push(`Only ${o} more image(s) can be added (max ${n} total)`),l.length>0&&(u(t=>[...t,...l]),b(!1)),c.forEach(t=>d.error(t))}},[r]),E=s=>{if(s.target.files){const a=Array.from(s.target.files);if(r.length>=n){d.error(`Maximum ${n} images allowed`),s.target.value="";return}const o=n-r.length,l=[],c=[];for(let t=0;t<Math.min(a.length,o);t++){const m=j(a[t]);m.valid?l.push(a[t]):m.error&&c.push(m.error)}a.length>o&&c.push(`Only ${o} more image(s) can be added (max ${n} total)`),l.length>0&&(u(t=>[...t,...l]),b(!1)),c.forEach(t=>d.error(t)),s.target.value=""}},F=s=>{u(a=>a.filter((o,l)=>l!==s))},S=async s=>{if(r.length===0){b(!0),d.error("Please upload at least one driving license image"),window.scrollTo({top:0,behavior:"smooth"});return}try{(await f.mutateAsync({licenseNumber:s.licenseNumber,licenseImageFiles:r}))?.success&&i("/driver")}catch(a){console.error("Failed to submit license information:",a)}};return e.jsx(R,{children:e.jsxs("div",{className:"w-full max-w-2xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Driving License"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Upload a valid driving license to verify your eligibility for deliveries."})]}),e.jsx(B,{...y,children:e.jsxs("form",{onSubmit:I(S),className:"space-y-4",children:[e.jsx(T,{name:"licenseNumber",label:"",type:"text",disabled:f.isPending,placeholder:"Enter License number",className:"text-base px-4 border-gray-300"}),e.jsxs("div",{className:"space-y-4",children:[r.length===0?e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center bg-gray-50 ${h?"border-primary bg-blue-50":"border-gray-300"} ${v?"border-red-500":""}`,onDragEnter:g,onDragLeave:g,onDragOver:g,onDrop:N,children:[e.jsx("input",{type:"file",id:"license-photo-upload",className:"hidden",multiple:!0,accept:"image/*",onChange:E}),e.jsxs("label",{htmlFor:"license-photo-upload",className:"cursor-pointer inline-flex flex-col items-center",children:[e.jsx(L,{className:"h-12 w-12 text-gray-400 mb-3"}),e.jsx("span",{className:"text-base text-gray-700 font-medium mb-1",children:"Drag & drop images"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["or ",e.jsx("span",{className:"text-primary underline",children:"click here"})]})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-4 text-center bg-gray-50 ${h?"border-primary bg-blue-50":"border-gray-300"}`,onDragEnter:g,onDragLeave:g,onDragOver:g,onDrop:N,children:[e.jsx("input",{type:"file",id:"license-photo-upload-more",className:"hidden",multiple:!0,accept:"image/*",onChange:E,disabled:r.length>=n}),e.jsxs("label",{htmlFor:"license-photo-upload-more",className:`inline-flex items-center gap-2 ${r.length>=n?"cursor-not-allowed opacity-50":"cursor-pointer"}`,children:[e.jsx(L,{className:"h-5 w-5 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600",children:r.length>=n?"Maximum images reached":"Add more images"})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:r.map((s,a)=>e.jsxs("div",{className:"relative group border-2 border-gray-200 rounded-lg overflow-hidden bg-white shadow-sm",children:[e.jsx("img",{src:URL.createObjectURL(s),alt:`License ${a===0?"Front":"Back"}`,className:"w-full h-48 object-contain p-2"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/50 to-transparent p-2",children:e.jsx("span",{className:"text-white text-sm font-medium",children:a===0?"Front Side":"Back Side"})}),e.jsx("button",{type:"button",onClick:()=>F(a),className:"absolute top-2 right-2 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(O,{className:"h-4 w-4"})})]},`license-${a}`))}),r.length===1&&e.jsx("p",{className:"text-sm text-amber-600 text-center",children:"ℹ️ Consider uploading both front and back of your license for faster verification"})]}),v&&e.jsx("p",{className:"text-sm text-red-600 text-center",children:"Please upload at least one driving license image"})]}),e.jsx("div",{className:"flex gap-4 pt-4",children:e.jsx(z,{type:"submit",className:"flex-1 bg-primary hover:bg-primary/80 text-white",disabled:f.isPending,loading:f.isPending,children:"Continue"})}),e.jsx("div",{className:"text-center pt-2",children:e.jsxs("span",{className:"text-sm text-gray-500",children:["Back to"," ",e.jsx(w,{to:"/auth/signup",className:"text-primary hover:underline",children:"Sign Up"})," | ",e.jsx(w,{to:"/auth/login",className:"text-primary hover:underline",children:"Login"})]})})]})})]})})}export{ee as default};
