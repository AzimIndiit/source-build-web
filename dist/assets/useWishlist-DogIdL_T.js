import{n,aJ as p,E as l,aK as d}from"./index-CUSVstqU.js";class y{async getWishlist(){return(await n.get("/wishlists")).data}async addToWishlist(t){return(await n.post("/wishlists/add",t)).data}async removeFromWishlist(t){return(await n.post("/wishlists/remove",t)).data}async updateWishlistItem(t){return(await n.patch("/wishlists/update",t)).data}async clearWishlist(){return(await n.delete("/wishlists/clear")).data}async checkProductInWishlist(t){return(await n.get(`/wishlists/check/${t}`)).data}async getWishlistCount(){return(await n.get("/wishlists/count")).data}async getPopularWishlistItems(t){return(await n.get("/wishlists/popular",{params:{limit:t}})).data}async batchCheckProducts(t){return(await n.post("/wishlists/batch-check",{productIds:t})).data}}const h=new y,a=["wishlist"],u=["wishlist","count"],c=e=>["wishlist","check",e],m=()=>{const e=p();return l({mutationFn:h.addToWishlist,onMutate:async t=>{await e.cancelQueries({queryKey:a}),await e.cancelQueries({queryKey:u}),await e.cancelQueries({queryKey:c(t.productId)});const s=e.getQueryData(a),r=e.getQueryData(u),i={product:{id:t.productId,_id:t.productId,title:"",price:0,images:[],slug:""},addedAt:new Date().toISOString(),notificationEnabled:t.notificationEnabled,priceAlert:t.priceAlert};return e.setQueryData(a,o=>o?{...o,items:[...o.items,i],itemCount:o.itemCount+1}:{id:"",_id:"",user:"",items:[i],itemCount:1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),e.setQueryData(u,o=>(o||0)+1),e.setQueryData(c(t.productId),!0),{previousWishlist:s,previousCount:r}},onError:(t,s,r)=>{r?.previousWishlist&&e.setQueryData(a,r.previousWishlist),r?.previousCount!==void 0&&e.setQueryData(u,r.previousCount),e.setQueryData(c(s.productId),!1),d.error("Failed to add to wishlist")},onSuccess:t=>{e.setQueryData(a,t.data),e.invalidateQueries({queryKey:u}),e.invalidateQueries({queryKey:["products"]}),d.success("Product added to wishlist")}})},Q=()=>{const e=p();return l({mutationFn:h.removeFromWishlist,onMutate:async t=>{await e.cancelQueries({queryKey:a}),await e.cancelQueries({queryKey:u}),await e.cancelQueries({queryKey:c(t.productId)});const s=e.getQueryData(a),r=e.getQueryData(u);return e.setQueryData(a,i=>i&&{...i,items:i.items.filter(o=>o.product._id!==t.productId),itemCount:Math.max(0,i.itemCount-1)}),e.setQueryData(u,i=>Math.max(0,(i||0)-1)),e.setQueryData(c(t.productId),!1),{previousWishlist:s,previousCount:r}},onError:(t,s,r)=>{r?.previousWishlist&&e.setQueryData(a,r.previousWishlist),r?.previousCount!==void 0&&e.setQueryData(u,r.previousCount),e.setQueryData(c(s.productId),!0),d.error("Failed to remove from wishlist")},onSuccess:t=>{e.setQueryData(a,t.data),e.invalidateQueries({queryKey:u}),e.invalidateQueries({queryKey:["products"]}),d.success("Product removed from wishlist")}})};export{Q as a,m as u};
